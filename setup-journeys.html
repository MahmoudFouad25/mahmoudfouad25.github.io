<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø­Ù„Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: #f5f5f5;
            direction: rtl;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2C5530;
            text-align: center;
        }
        .btn {
            background: #2C5530;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .btn:hover {
            background: #1e3a21;
        }
        .log {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø­Ù„Ø§Øª</h1>
        <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø³ØªÙ‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø­Ù„Ø§Øª</p>
        
        <div style="text-align: center;">
            <button class="btn" onclick="setupJourneys()">Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</button>
            <button class="btn" onclick="createSampleJourney()">Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø­Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        </div>
        
        <div id="log" class="log"></div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        const db = firebase.firestore();
        const logDiv = document.getElementById('log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ar-EG');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ØªØ¹Ø±ÙŠÙ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬
        const programStructures = {
            clarity: {
                name: 'Ø¬Ù„Ø³Ø© Ø§Ù„ÙˆØ¶ÙˆØ­',
                totalSessions: 1,
                duration: 7, // Ø£ÙŠØ§Ù…
                phases: [
                    {
                        id: 'clarity_phase_1',
                        name: 'Ø§Ù„ÙˆØ¶ÙˆØ­ ÙˆØ§Ù„Ø­Ù„',
                        sessions: 1,
                        practices: ['practice_1', 'practice_2'],
                        resources: ['resource_clarity_1']
                    }
                ]
            },
            discovery: {
                name: 'Ø±Ø­Ù„Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù',
                totalSessions: 3,
                duration: 30, // Ø£ÙŠØ§Ù…
                phases: [
                    {
                        id: 'discovery_phase_1',
                        name: 'Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£ÙˆÙ„ÙŠ',
                        sessions: 1,
                        practices: ['practice_1', 'practice_2'],
                        resources: ['resource_discovery_1']
                    },
                    {
                        id: 'discovery_phase_2',
                        name: 'Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ¹ÙŠ',
                        sessions: 1,
                        practices: ['practice_2', 'practice_3'],
                        resources: ['resource_discovery_2']
                    },
                    {
                        id: 'discovery_phase_3',
                        name: 'Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„ØªØ«Ø¨ÙŠØª',
                        sessions: 1,
                        practices: ['practice_1', 'practice_3'],
                        resources: ['resource_discovery_3']
                    }
                ]
            },
            transformation: {
                name: 'Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­ÙˆÙ„',
                totalSessions: 6,
                duration: 90, // Ø£ÙŠØ§Ù…
                phases: [
                    {
                        id: 'transform_phase_1',
                        name: 'ÙƒØ´Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø·',
                        sessions: 2,
                        practices: ['practice_1', 'practice_2'],
                        resources: ['resource_transform_1', 'resource_transform_2']
                    },
                    {
                        id: 'transform_phase_2',
                        name: 'Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£Ø³Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',
                        sessions: 2,
                        practices: ['practice_2', 'practice_3'],
                        resources: ['resource_transform_3', 'resource_transform_4']
                    },
                    {
                        id: 'transform_phase_3',
                        name: 'Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù…',
                        sessions: 2,
                        practices: ['practice_1', 'practice_2', 'practice_3'],
                        resources: ['resource_transform_5', 'resource_transform_6']
                    }
                ]
            }
        };

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ù… (Milestones)
        const milestones = [
            { id: 'self_awareness', name: 'Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ø°Ø§ØªÙŠ', icon: 'ğŸ¯' },
            { id: 'goal_clarity', name: 'ÙˆØ¶ÙˆØ­ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù', icon: 'ğŸ¯' },
            { id: 'habit_formation', name: 'Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª', icon: 'ğŸ’ª' },
            { id: 'emotional_balance', name: 'Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø¹Ø§Ø·ÙÙŠ', icon: 'âš–ï¸' },
            { id: 'authentic_expression', name: 'Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø§Ù„Ø£ØµÙŠÙ„', icon: 'ğŸŒŸ' },
            { id: 'sustainable_growth', name: 'Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù…', icon: 'ğŸŒ±' }
        ];

        async function setupJourneys() {
            log('Ø¨Ø¯Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø­Ù„Ø§Øª...', 'info');
            
            try {
                // 1. Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬
                log('Ø¥Ø¶Ø§ÙØ© Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬...', 'info');
                const programsRef = db.collection('program_templates');
                
                for (const [programId, structure] of Object.entries(programStructures)) {
                    await programsRef.doc(programId).set(structure);
                    log(`âœ“ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬: ${structure.name}`, 'success');
                }
                
                // 2. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ù…
                log('Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ù…...', 'info');
                const milestonesRef = db.collection('milestones');
                
                for (const milestone of milestones) {
                    await milestonesRef.doc(milestone.id).set(milestone);
                    log(`âœ“ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…: ${milestone.name}`, 'success');
                }
                
                // 3. Ø¥Ø¶Ø§ÙØ© Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                log('Ø¥Ø¶Ø§ÙØ© Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...', 'info');
                const templatesRef = db.collection('message_templates');
                
                const messageTemplates = [
                    {
                        id: 'welcome_message',
                        type: 'welcome',
                        title: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ø±Ø­Ù„ØªÙƒ',
                        content: 'Ø£Ù‡Ù„Ø§Ù‹ {name}! Ø³Ø¹ÙŠØ¯ Ø¨Ø¨Ø¯Ø¡ Ø±Ø­Ù„ØªÙƒ Ù…Ø¹Ù†Ø§. Ù‡Ø°Ù‡ Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ù„Ù„Ù†Ù…Ùˆ ÙˆØ§Ù„ØªØ·ÙˆØ±.'
                    },
                    {
                        id: 'practice_reminder',
                        type: 'reminder',
                        title: 'ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø©',
                        content: 'Ø­Ø§Ù† ÙˆÙ‚Øª Ù…Ù…Ø§Ø±Ø³Ø© {practice_name}. Ø®Ø° {duration} Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù†ÙØ³Ùƒ.'
                    },
                    {
                        id: 'session_reminder',
                        type: 'reminder',
                        title: 'ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¬Ù„Ø³Ø©',
                        content: 'Ø¬Ù„Ø³ØªÙƒ ØºØ¯Ø§Ù‹ ÙÙŠ {time}. Ø§Ø³ØªØ¹Ø¯ Ø¨ÙƒØªØ§Ø¨Ø© Ø£Ø³Ø¦Ù„ØªÙƒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ.'
                    },
                    {
                        id: 'achievement_congrats',
                        type: 'achievement',
                        title: 'ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ğŸ‰',
                        content: 'Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø­Ù‚Ù‚Øª Ù…Ø¹Ù„Ù… {milestone_name}. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªÙ‚Ø¯Ù…!'
                    }
                ];
                
                for (const template of messageTemplates) {
                    await templatesRef.doc(template.id).set(template);
                    log(`âœ“ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨ Ø±Ø³Ø§Ù„Ø©: ${template.title}`, 'success');
                }
                
                log('ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 'success');
                
            } catch (error) {
                log(`Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        async function createSampleJourney() {
            log('Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø­Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'info');
            
            try {
                // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù…
                const usersSnapshot = await db.collection('users').limit(1).get();
                if (usersSnapshot.empty) {
                    log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†. Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹.', 'error');
                    return;
                }
                
                const user = usersSnapshot.docs[0];
                const userId = user.id;
                const userData = user.data();
                
                // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø­Ø¬Ø² Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const bookingsSnapshot = await db.collection('bookings')
                    .where('email', '==', userData.email)
                    .limit(1)
                    .get();
                    
                if (bookingsSnapshot.empty) {
                    log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….', 'error');
                    return;
                }
                
                const booking = bookingsSnapshot.docs[0];
                const bookingData = booking.data();
                const program = bookingData.program || 'discovery';
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø­Ù„Ø©
                const journeyData = {
                    userId: userId,
                    bookingId: booking.id,
                    program: program,
                    status: 'active',
                    startDate: firebase.firestore.FieldValue.serverTimestamp(),
                    expectedEndDate: new Date(Date.now() + (programStructures[program].duration * 24 * 60 * 60 * 1000)),
                    
                    phases: programStructures[program].phases.map((phase, index) => ({
                        ...phase,
                        status: index === 0 ? 'in_progress' : 'pending',
                        startDate: index === 0 ? new Date() : null,
                        completedDate: null
                    })),
                    
                    progress: {
                        overallProgress: 0,
                        sessionsCompleted: 0,
                        totalSessions: programStructures[program].totalSessions,
                        practicesCompleted: 0,
                        milestonesAchieved: []
                    },
                    
                    assignedPractices: [],
                    assignedResources: [],
                    communications: [
                        {
                            type: 'message',
                            from: 'system',
                            content: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø±Ø­Ù„ØªÙƒ! Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ ØªØ¬Ø±Ø¨Ø© Ù…Ø«Ù…Ø±Ø©.',
                            date: new Date(),
                            read: false
                        }
                    ],
                    assessments: [],
                    
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const journeyRef = await db.collection('journeys').add(journeyData);
                log(`âœ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø­Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userData.name || userData.email}`, 'success');
                log(`Ù…Ø¹Ø±Ù Ø§Ù„Ø±Ø­Ù„Ø©: ${journeyRef.id}`, 'info');
                
            } catch (error) {
                log(`Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
