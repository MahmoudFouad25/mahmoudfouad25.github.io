<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª - Ù…Ø­Ù…ÙˆØ¯ ÙØ¤Ø§Ø¯</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
:root {
--primary: #2C5530;
--secondary: #8B9467;
--accent: #D4AF37;
--light: #F5F2E8;
--dark: #1A1A1A;
--gradient: linear-gradient(135deg, #2C5530 0%, #8B9467 100%);
--success: #28a745;
--danger: #dc3545;
--warning: #ffc107;
--info: #17a2b8;
}
body {
font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
background: #f5f5f5;
color: var(--dark);
min-height: 100vh;
}
/* Loading Overlay */
.loading-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.7);
display: none;
justify-content: center;
align-items: center;
z-index: 9999;
}
.loading-spinner {
width: 50px;
height: 50px;
border: 5px solid #f3f3f3;
border-top: 5px solid var(--primary);
border-radius: 50%;
animation: spin 1s linear infinite;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
/* Login Check Container */
.auth-check {
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
background: var(--gradient);
}
.auth-message {
background: white;
padding: 3rem;
border-radius: 15px;
box-shadow: 0 10px 40px rgba(0,0,0,0.2);
text-align: center;
}
.auth-message h2 {
color: var(--primary);
margin-bottom: 1rem;
}
.auth-message p {
color: #666;
margin-bottom: 2rem;
}
.auth-message button {
padding: 1rem 2rem;
background: var(--gradient);
color: white;
border: none;
border-radius: 8px;
font-size: 1rem;
font-weight: bold;
cursor: pointer;
}
/* Navigation */
.admin-nav {
background: white;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
padding: 1rem 2rem;
position: sticky;
top: 0;
z-index: 1000;
}
.nav-container {
max-width: 1400px;
margin: 0 auto;
display: flex;
justify-content: space-between;
align-items: center;
}
.nav-brand h2 {
color: var(--primary);
font-size: 1.5rem;
}
.nav-links {
display: flex;
gap: 2rem;
align-items: center;
}
.nav-links a {
color: var(--dark);
text-decoration: none;
font-weight: 500;
position: relative;
transition: color 0.3s;
}
.nav-links a:hover {
color: var(--primary);
}
.nav-links a.active {
color: var(--primary);
}
.nav-links a.active::after {
content: '';
position: absolute;
bottom: -5px;
left: 0;
right: 0;
height: 3px;
background: var(--accent);
}
.badge {
background: var(--danger);
color: white;
padding: 2px 6px;
border-radius: 10px;
font-size: 0.75rem;
margin-right: 5px;
display: inline-block;
min-width: 20px;
text-align: center;
}
/* Main Container */
.bookings-container {
max-width: 1400px;
margin: 0 auto;
padding: 2rem;
}
/* Header Section */
.page-header {
background: white;
padding: 2rem;
border-radius: 15px;
box-shadow: 0 5px 20px rgba(0,0,0,0.1);
margin-bottom: 2rem;
}
.page-header h1 {
color: var(--primary);
font-size: 2rem;
margin-bottom: 0.5rem;
}
.page-header p {
color: #666;
}
/* Stats Cards */
.stats-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 1rem;
margin-bottom: 2rem;
}
.stat-card {
background: white;
padding: 1.5rem;
border-radius: 10px;
box-shadow: 0 3px 15px rgba(0,0,0,0.1);
text-align: center;
}
.stat-card h3 {
color: #666;
font-size: 0.9rem;
margin-bottom: 0.5rem;
}
.stat-card .number {
font-size: 2rem;
font-weight: bold;
color: var(--primary);
}
/* Filters Section */
.filters-section {
background: white;
padding: 1.5rem;
border-radius: 10px;
box-shadow: 0 3px 15px rgba(0,0,0,0.1);
margin-bottom: 2rem;
}
.filters-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 1rem;
align-items: end;
}
.filter-group {
display: flex;
flex-direction: column;
gap: 0.5rem;
}
.filter-group label {
color: var(--primary);
font-weight: 500;
font-size: 0.9rem;
}
.filter-group input,
.filter-group select {
padding: 0.75rem;
border: 2px solid #ddd;
border-radius: 8px;
font-size: 1rem;
}
.filter-group input:focus,
.filter-group select:focus {
outline: none;
border-color: var(--primary);
}
.filter-actions {
display: flex;
gap: 0.5rem;
align-items: end;
}
/* Action Buttons Section */
.action-buttons {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1rem;
flex-wrap: wrap;
gap: 1rem;
}
.action-buttons-left {
display: flex;
gap: 0.5rem;
flex-wrap: wrap;
}
.action-buttons-right {
display: flex;
gap: 0.5rem;
}
/* Bookings Table */
.bookings-section {
background: white;
border-radius: 10px;
box-shadow: 0 3px 15px rgba(0,0,0,0.1);
overflow: hidden;
}
.table-header {
padding: 1.5rem;
border-bottom: 2px solid #f0f0f0;
}
.table-header h2 {
color: var(--primary);
font-size: 1.3rem;
}
.table-container {
overflow-x: auto;
}
table {
width: 100%;
border-collapse: collapse;
}
th {
background: #f8f9fa;
padding: 1rem;
text-align: right;
font-weight: 600;
color: var(--primary);
border-bottom: 2px solid #e9ecef;
white-space: nowrap;
}
td {
padding: 1rem;
border-bottom: 1px solid #f0f0f0;
}
tr:hover {
background: #f8f9fa;
}
/* Category Headers */
.category-header td {
font-weight: bold;
padding: 10px;
border: none;
}
/* Type Badges */
.type-badge {
padding: 4px 10px;
border-radius: 20px;
font-size: 0.85rem;
font-weight: 600;
display: inline-block;
}
.type-badge.challenge-work {
background: #d4edda;
color: #155724;
}
.type-badge.challenge-relationships {
background: #d1ecf1;
color: #0c5460;
}
.type-badge.challenge-self {
background: #fff3cd;
color: #856404;
}
.type-badge.challenge-decision {
background: #f8d7da;
color: #721c24;
}
.type-badge.challenge-default {
background: #e2e3e5;
color: #383d41;
}
/* Journey Badges */
.journey-badge {
padding: 4px 10px;
border-radius: 5px;
font-size: 0.85rem;
font-weight: 600;
display: inline-block;
}
.journey-badge.eshraq {
background: #fff3cd;
color: #856404;
}
.journey-badge.baseera {
background: #d1ecf1;
color: #0c5460;
}
.journey-badge.sakeena {
background: #d4edda;
color: #155724;
}
.journey-badge.eshraq-baseera,
.journey-badge.baseera-sakeena {
background: linear-gradient(45deg, #fff3cd, #d1ecf1);
color: #333;
}
.recommended-note {
display: block;
font-size: 0.75rem;
color: #6c757d;
font-style: italic;
margin-top: 2px;
}
.match-icon {
font-size: 1.2rem;
font-weight: bold;
}
.match-icon.yes {
color: #28a745;
}
.match-icon.no {
color: #ffc107;
}
.urgency-level {
padding: 4px 8px;
border-radius: 4px;
font-weight: bold;
font-size: 0.85rem;
}
.urgency-level.urgent {
background: #f8d7da;
color: #721c24;
}
.urgency-level.moderate {
background: #fff3cd;
color: #856404;
}
.urgency-level.low {
background: #d4edda;
color: #155724;
}
/* Status Badges */
.status-badge {
padding: 4px 12px;
border-radius: 5px;
font-size: 0.85rem;
font-weight: 600;
display: inline-block;
}
.status-badge.pending {
background: #fff3cd;
color: #856404;
}
.status-badge.confirming {
background: #d1ecf1;
color: #0c5460;
}
.status-badge.confirmed {
background: #d4edda;
color: #155724;
}
.status-badge.completed,
.status-badge.converted {
background: #cce5ff;
color: #004085;
}
.status-badge.cancelled {
background: #f8d7da;
color: #721c24;
}
/* Action Buttons */
.actions-cell {
display: flex;
gap: 0.5rem;
flex-wrap: wrap;
}
.btn {
padding: 0.4rem 0.8rem;
border: none;
border-radius: 6px;
font-weight: 500;
cursor: pointer;
transition: all 0.3s;
font-size: 0.85rem;
white-space: nowrap;
}
.btn:hover {
transform: translateY(-2px);
box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
.btn:disabled {
opacity: 0.5;
cursor: not-allowed;
transform: none !important;
}
.btn-primary {
background: var(--primary);
color: white;
}
.btn-success {
background: var(--success);
color: white;
}
.btn-info {
background: var(--info);
color: white;
}
.btn-warning {
background: var(--warning);
color: #212529;
}
.btn-danger {
background: var(--danger);
color: white;
}
.btn-whatsapp {
background: #25d366;
color: white;
}
.btn-secondary {
background: #6c757d;
color: white;
}
.btn-sm {
padding: 0.3rem 0.6rem;
font-size: 0.8rem;
}
/* Client Info */
.client-info {
display: flex;
flex-direction: column;
gap: 0.2rem;
}
.client-name {
font-weight: 600;
color: var(--primary);
}
.client-contact {
font-size: 0.85rem;
color: #666;
}
/* Empty State */
.empty-state {
text-align: center;
padding: 4rem 2rem;
color: #999;
}
.empty-state-icon {
font-size: 4rem;
margin-bottom: 1rem;
opacity: 0.5;
}
/* Modals */
.modal {
display: none;
position: fixed;
z-index: 2000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.5);
animation: fadeIn 0.3s;
}
@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}
.modal-content {
background-color: white;
margin: 2% auto;
padding: 2rem;
border-radius: 15px;
width: 90%;
max-width: 600px;
max-height: 90vh;
overflow-y: auto;
animation: slideIn 0.3s;
}
@keyframes slideIn {
from { transform: translateY(-50px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}
.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1.5rem;
}
.modal-header h2 {
color: var(--primary);
}
.close {
color: #aaa;
font-size: 28px;
font-weight: bold;
cursor: pointer;
transition: color 0.3s;
}
.close:hover {
color: #000;
}
.form-group {
margin-bottom: 1.5rem;
}
.form-group label {
display: block;
margin-bottom: 0.5rem;
color: var(--primary);
font-weight: 600;
}
.form-group input,
.form-group textarea,
.form-group select {
width: 100%;
padding: 0.75rem;
border: 2px solid #ddd;
border-radius: 8px;
font-size: 1rem;
}
.form-group textarea {
resize: vertical;
min-height: 100px;
}
.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
outline: none;
border-color: var(--primary);
}
.modal-actions {
display: flex;
gap: 1rem;
justify-content: flex-end;
margin-top: 2rem;
}
/* Appointment Slots */
.slots-container {
display: grid;
gap: 0.5rem;
margin: 1rem 0;
}
.slot-item {
padding: 0.75rem;
border: 2px solid #ddd;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s;
display: flex;
align-items: center;
gap: 0.5rem;
}
.slot-item:hover {
border-color: var(--primary);
background: #f8f9fa;
}
.slot-item.selected {
border-color: var(--primary);
background: var(--light);
}
.slot-item input[type="checkbox"] {
width: auto;
}
/* Info Boxes */
.info-box {
background: #f8f9fa;
padding: 1rem;
border-radius: 8px;
margin-bottom: 1rem;
border-right: 4px solid var(--primary);
}
.info-box h4 {
color: var(--primary);
margin-bottom: 0.5rem;
}
.info-box p {
color: #666;
font-size: 0.9rem;
margin: 0.3rem 0;
}
/* Journey Info */
.journey-info {
display: flex;
flex-direction: column;
gap: 0.2rem;
}
/* Notification */
.notification {
position: fixed;
top: 20px;
right: 20px;
padding: 15px 25px;
border-radius: 8px;
box-shadow: 0 5px 20px rgba(0,0,0,0.2);
z-index: 10000;
animation: slideInNotification 0.3s;
cursor: pointer;
}
@keyframes slideInNotification {
from {
transform: translateX(100%);
opacity: 0;
}
to {
transform: translateX(0);
opacity: 1;
}
}
.notification.success {
background: var(--success);
color: white;
}
.notification.error {
background: var(--danger);
color: white;
}
.notification.info {
background: var(--info);
color: white;
}
/* Responsive */
@media (max-width: 768px) {
.bookings-container {
padding: 1rem;
}
.nav-links {
gap: 1rem;
font-size: 0.9rem;
}
.stats-row {
grid-template-columns: repeat(2, 1fr);
}
.filters-grid {
grid-template-columns: 1fr;
}
.table-container {
overflow-x: scroll;
}
table {
min-width: 800px;
}
.actions-cell {
flex-direction: column;
}
.btn {
width: 100%;
}
}
</style>
</head>
<body>
<!-- Loading Overlay -->
<div class="loading-overlay">
<div class="loading-spinner"></div>
</div>
<!-- Auth Check -->
<div id="authCheck" class="auth-check" style="display: none;">
<div class="auth-message">
<h2>ØºÙŠØ± Ù…ØµØ±Ø­</h2>
<p>ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</p>
<button onclick="window.location.href='admin-dashboard.html'">
Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
</button>
</div>
</div>

<!-- Main Content -->
<div id="mainContent" style="display: none;">
<!-- Navigation -->
<nav class="admin-nav">
<div class="nav-container">
<div class="nav-brand">
<h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø­Ù…ÙˆØ¯ ÙØ¤Ø§Ø¯</h2>
</div>
<div class="nav-links">
<a href="admin-dashboard.html">
<span>ğŸ </span>
<span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</a>
<a href="admin-bookings.html" class="active">
<span>ğŸ“…</span>
<span>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span>
</a>
<a href="central-dashboard.html">
<span>ğŸš€</span>
<span>Ø§Ù„Ø±Ø­Ù„Ø§Øª</span>
</a>
<a href="admin-tools.html">
<span>ğŸ› ï¸</span>
<span>Ø§Ù„Ø£Ø¯ÙˆØ§Øª</span>
</a>
<a href="#" onclick="logout()">
<span>ğŸšª</span>
<span>Ø®Ø±ÙˆØ¬</span>
</a>
</div>
</div>
</nav>
<!-- Bookings Container -->
<div class="bookings-container">
<!-- Page Header -->
<div class="page-header">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
<p>Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¬Ø² ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ø±Ø­Ù„Ø§Øª</p>
</div>
<!-- Stats Row -->
<div class="stats-row">
<div class="stat-card">
<h3>Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
<div class="number" id="pendingCount">0</div>
</div>
<div class="stat-card">
<h3>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯</h3>
<div class="number" id="confirmingCount">0</div>
</div>
<div class="stat-card">
<h3>Ù…Ø¤ÙƒØ¯Ø©</h3>
<div class="number" id="confirmedCount">0</div>
</div>
<div class="stat-card">
<h3>Ù…ÙƒØªÙ…Ù„Ø©/Ù…Ø­ÙˆÙ„Ø©</h3>
<div class="number" id="completedCount">0</div>
</div>
</div>
<!-- Filters Section -->
<div class="filters-section">
<div class="filters-grid">
<div class="filter-group">
<label>Ø§Ù„Ø¨Ø­Ø«</label>
<input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ..."
onkeyup="applyFilters()">
</div>
<div class="filter-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©</label>
<select id="journeyFilter" onchange="applyFilters()">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø­Ù„Ø§Øª</option>
<option value="eshraq">Ø§Ù„Ø¥Ø´Ø±Ø§Ù‚Ø©</option>
<option value="baseera">Ø§Ù„Ø¨ØµÙŠØ±Ø©</option>
<option value="sakeena">Ø§Ù„Ø³ÙƒÙŠÙ†Ø©</option>
<option value="multi">Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¬Ø©</option>
</select>
</div>
<div class="filter-group">
<label>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ</label>
<select id="challengeFilter" onchange="applyFilters()">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</option>
<option value="work">ØªØ­Ø¯ÙŠ Ø§Ù„Ø¹Ù…Ù„</option>
<option value="relationships">ØªØ­Ø¯ÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª</option>
<option value="self">ØªØ­Ø¯ÙŠ Ø§Ù„Ø°Ø§Øª</option>
<option value="decision">Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±</option>
</select>
</div>
<div class="filter-group">
<label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
<select id="statusFilter" onchange="applyFilters()">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
<option value="pending">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
<option value="confirming">Ù‚ÙŠØ¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯</option>
<option value="confirmed">Ù…Ø¤ÙƒØ¯</option>
<option value="completed">Ù…ÙƒØªÙ…Ù„</option>
<option value="converted">ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„</option>
<option value="cancelled">Ù…Ù„ØºÙŠ</option>
</select>
</div>
<div class="filter-group filter-actions">
<button class="btn btn-info" onclick="resetFilters()">
Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
</button>
<button class="btn btn-success" onclick="refreshData()">
ØªØ­Ø¯ÙŠØ«
</button>
</div>
</div>
</div>

<!-- Bookings Table -->
<div class="bookings-section">
<div class="table-header">
<h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>
<div class="action-buttons">
<div class="action-buttons-left">
<button class="btn btn-secondary" onclick="showSlotsManager()">
<span>ğŸ“…</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
</button>
</div>
<div class="action-buttons-right">
<button class="btn btn-primary" onclick="exportToExcel()">
ØªØµØ¯ÙŠØ± Excel
</button>
</div>
</div>
</div>
<div class="table-container">
<table id="bookingsTable">
<thead>
<tr>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ</th>
<th>Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</th>
<th>Ø§Ù„ØªÙˆØ§ÙÙ‚</th>
<th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ù„Ø­Ø§Ø­</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="bookingsTableBody">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Modals -->
<!-- Slots Manager Modal -->
<div id="slotsModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
<span class="close" onclick="closeModal('slotsModal')">&times;</span>
</div>
<div class="form-group">
<label>Ø£Ø¶Ù Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯:</label>
<div style="display: flex; gap: 10px;">
<input type="date" id="slotDate" min="">
<input type="time" id="slotTime">
<button class="btn btn-success" onclick="addSlot()">Ø¥Ø¶Ø§ÙØ©</button>
</div>
</div>
<div class="form-group">
<label>Ø£Ø¶Ù Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ¹Ø¯Ø¯Ø©:</label>
<input type="date" id="bulkStartDate" min="" placeholder="Ù…Ù† ØªØ§Ø±ÙŠØ®">
<input type="date" id="bulkEndDate" min="" placeholder="Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®">
<select id="bulkTimes" multiple style="height: 150px; width: 100%; margin: 10px 0;">
<option value="09:00">9:00 Øµ</option>
<option value="10:00">10:00 Øµ</option>
<option value="11:00">11:00 Øµ</option>
<option value="12:00">12:00 Ù…</option>
<option value="14:00">2:00 Ù…</option>
<option value="15:00">3:00 Ù…</option>
<option value="16:00">4:00 Ù…</option>
<option value="17:00">5:00 Ù…</option>
<option value="18:00">6:00 Ù…</option>
<option value="19:00">7:00 Ù…</option>
<option value="20:00">8:00 Ù…</option>
</select>
<button class="btn btn-primary" onclick="addBulkSlots()">Ø¥Ø¶Ø§ÙØ© Ø¬Ù…Ø§Ø¹ÙŠØ©</button>
</div>
<h3>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</h3>
<div id="slotsList" style="max-height: 300px; overflow-y: auto;">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
</div>
</div>
</div>
<!-- Send Appointments Modal -->
<div id="appointmentsModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>Ø¥Ø±Ø³Ø§Ù„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ù‚ØªØ±Ø­Ø©</h2>
<span class="close" onclick="closeModal('appointmentsModal')">&times;</span>
</div>
<div class="info-box">
<h4>ØªØ¹Ù„ÙŠÙ…Ø§Øª:</h4>
<p>â€¢ Ø§Ø®ØªØ± 3-5 Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„</p>
<p>â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙÙŠ Ø¬Ø¯ÙˆÙ„Ùƒ</p>
<p>â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø´Ø®ØµÙŠØ©</p>
</div>
<div class="form-group">
<label>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©:</label>
<div class="slots-container" id="slotsContainer">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
</div>
</div>
<div class="form-group">
<label>Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØµØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
<textarea id="customMessage" placeholder="Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© Ø´Ø®ØµÙŠØ© Ù„Ù„Ø¹Ù…ÙŠÙ„..."></textarea>
</div>
<div class="modal-actions">
<button class="btn btn-secondary" onclick="closeModal('appointmentsModal')">Ø¥Ù„ØºØ§Ø¡</button>
<button class="btn btn-success" onclick="sendAppointments()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</button>
</div>
</div>
</div>
<!-- Confirm Appointment Modal -->
<div id="confirmModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯</h2>
<span class="close" onclick="closeModal('confirmModal')">&times;</span>
</div>
<div class="form-group">
<label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
<input type="date" id="appointmentDate" min="">
</div>
<div class="form-group">
<label>Ø§Ù„ÙˆÙ‚Øª:</label>
<input type="time" id="appointmentTime">
</div>
<div class="form-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù„Ø³Ø©:</label>
<select id="sessionType">
<option value="online">Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (Zoom)</option>
<option value="phone">Ù…ÙƒØ§Ù„Ù…Ø© Ù‡Ø§ØªÙÙŠØ©</option>
<option value="inperson">Ø­Ø¶ÙˆØ±ÙŠ</option>
</select>
</div>
<div class="form-group">
<label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø© (Ù„Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†):</label>
<input type="text" id="sessionLink" placeholder="https://zoom.us/j/...">
</div>
<div class="modal-actions">
<button class="btn btn-secondary" onclick="closeModal('confirmModal')">Ø¥Ù„ØºØ§Ø¡</button>
<button class="btn btn-success" onclick="confirmAppointment()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
</div>
</div>
</div>
<!-- Notes Modal -->
<div id="notesModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²</h2>
<span class="close" onclick="closeModal('notesModal')">&times;</span>
</div>
<div class="info-box" id="bookingInfoBox">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
</div>
<div class="form-group">
<label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
<textarea id="notesTextarea" rows="5" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></textarea>
</div>
<div class="modal-actions">
<button class="btn btn-secondary" onclick="closeModal('notesModal')">Ø¥Ù„ØºØ§Ø¡</button>
<button class="btn btn-primary" onclick="saveNotes()">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
</div>
</div>
</div>
<!-- Booking Details Modal -->
<div id="detailsModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²</h2>
<span class="close" onclick="closeModal('detailsModal')">&times;</span>
</div>
<div id="bookingDetailsContent">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
</div>
<div class="modal-actions">
<button class="btn btn-primary" onclick="closeModal('detailsModal')">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
</div>
</div>
<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script>
// Initialize
const auth = firebase.auth();
const db = firebase.firestore();
let allBookings = [];
let filteredBookings = [];
let currentBookingId = null;
let availableSlots = JSON.parse(localStorage.getItem('availableSlots') || '[]');
let cachedBookings = null;
let cacheTime = null;
// Helper functions - MUST BE DEFINED FIRST
function showLoading(show) {
    const loadingOverlay = document.querySelector('.loading-overlay');
    if (loadingOverlay) {
        loadingOverlay.style.display = show ? 'flex' : 'none';
    }
}

function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    notification.onclick = () => notification.remove();
    document.body.appendChild(notification);
    setTimeout(() => {
        notification.remove();
    }, 5000);
}

function openModal(modalId) {
    document.getElementById(modalId).style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function formatDate(date) {
    if (!date) return '';
    return date.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

function getStatusName(status) {
    const names = {
        pending: 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
        confirming: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯',
        confirmed: 'Ù…Ø¤ÙƒØ¯',
        completed: 'Ù…ÙƒØªÙ…Ù„',
        converted: 'ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„',
        cancelled: 'Ù…Ù„ØºÙŠ'
    };
    return names[status] || 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
}

function getJourneyDisplayName(journeyType) {
    const names = {
        'eshraq': 'Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø´Ø±Ø§Ù‚Ø©',
        'baseera': 'Ø±Ø­Ù„Ø© Ø§Ù„Ø¨ØµÙŠØ±Ø©',
        'sakeena': 'Ø±Ø­Ù„Ø© Ø§Ù„Ø³ÙƒÙŠÙ†Ø©',
        'eshraq-baseera': 'Ù…Ø³Ø§Ø± Ù…ØªØ¯Ø±Ø¬ (Ø¥Ø´Ø±Ø§Ù‚Ø© â† Ø¨ØµÙŠØ±Ø©)',
        'baseera-sakeena': 'Ù…Ø³Ø§Ø± Ù…ØªØ¯Ø±Ø¬ (Ø¨ØµÙŠØ±Ø© â† Ø³ÙƒÙŠÙ†Ø©)'
    };
    return names[journeyType] || journeyType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
}

function getChallengeDisplayName(challengeType) {
    const types = {
        'work': 'ØªØ­Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„',
        'relationships': 'ØªØ­Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª',
        'self': 'ØªØ­Ø¯ÙŠ Ù…Ø¹ Ø§Ù„Ø°Ø§Øª',
        'decision': 'Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…Ù‡Ù…',
        'emptiness': 'Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„ÙØ±Ø§Øº',
        'patterns': 'Ø£Ù†Ù…Ø§Ø· Ù…ØªÙƒØ±Ø±Ø©',
        'passion': 'ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø´ØºÙ',
        'misplaced': 'Ø¹Ø¯Ù… Ø§Ù„Ø§Ù†ØªÙ…Ø§Ø¡',
        'clear-vision': 'Ø±Ø¤ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ØªØ­ØªØ§Ø¬ ØªÙ†ÙÙŠØ°',
        'need-change': 'Ø­Ø§Ø¬Ø© Ù„ØªØºÙŠÙŠØ± Ø¬Ø°Ø±ÙŠ',
        'awakening': 'ÙŠÙ‚Ø¸Ø© Ø±ÙˆØ­ÙŠØ©',
        'enough': 'ÙˆØµÙˆÙ„ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ­ÙˆÙ„'
    };
    return types[challengeType] || challengeType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
}

function getChallengeClass(challengeType) {
    const classes = {
        'work': 'challenge-work',
        'relationships': 'challenge-relationships',
        'self': 'challenge-self',
        'decision': 'challenge-decision'
    };
    return classes[challengeType] || 'challenge-default';
}

function getSessionTypeName(type) {
    const names = {
        online: 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†',
        phone: 'Ù‡Ø§ØªÙÙŠ',
        inperson: 'Ø­Ø¶ÙˆØ±ÙŠ'
    };
    return names[type] || 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†';
}

function getExperienceText(experience) {
    const experiences = {
        'therapy': 'Ø¹Ù„Ø§Ø¬ Ù†ÙØ³ÙŠ ØªÙ‚Ù„ÙŠØ¯ÙŠ',
        'coaching': 'ÙƒÙˆØªØ´ÙŠÙ†Ø¬ Ø­ÙŠØ§Ø©',
        'workshops': 'ÙˆØ±Ø´ ØªØ·ÙˆÙŠØ± Ø°Ø§Øª',
        'meditation': 'Ù…Ù…Ø§Ø±Ø³Ø§Øª ØªØ£Ù…Ù„ÙŠØ©/ÙŠÙˆØºØ§',
        'reading': 'Ù‚Ø±Ø§Ø¡Ø§Øª ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³/Ø§Ù„ØªÙ†Ù…ÙŠØ©',
        'spiritual': 'Ø±Ø­Ù„Ø© Ø±ÙˆØ­ÙŠØ©/Ø¯ÙŠÙ†ÙŠØ© Ø¹Ù…ÙŠÙ‚Ø©',
        'none': 'Ù„Ø§ Ø´ÙŠØ¡ Ù…Ù…Ø§ Ø³Ø¨Ù‚'
    };
    return experiences[experience] || experience;
}

function getSupportText(support) {
    const supports = {
        'family': 'Ø¹Ø§Ø¦Ù„Ø© Ø¯Ø§Ø¹Ù…Ø©',
        'friends': 'Ø£ØµØ¯Ù‚Ø§Ø¡ ÙˆØ§Ø¹ÙˆÙ†',
        'spiritual': 'Ù…Ù…Ø§Ø±Ø³Ø© Ø±ÙˆØ­ÙŠØ©/Ø¯ÙŠÙ†ÙŠØ©',
        'learning': 'Ù‚Ø±Ø§Ø¡Ø© ÙˆØªØ¹Ù„Ù… Ø°Ø§ØªÙŠ',
        'physical': 'Ø±ÙŠØ§Ø¶Ø© Ø£Ùˆ Ù…Ù…Ø§Ø±Ø³Ø© Ø¬Ø³Ø¯ÙŠØ©',
        'work': 'Ø¹Ù…Ù„ ÙŠØ­Ø¨Ù‡',
        'hobby': 'Ù‡ÙˆØ§ÙŠØ© Ø£Ùˆ Ø´ØºÙ',
        'none': 'Ù„Ø§ Ø´ÙŠØ¡ Ù…Ù…Ø§ Ø³Ø¨Ù‚'
    };
    return supports[support] || support;
}

function getAnswerText(question, answer) {
    const answerTexts = {
        q1: {
            a: 'ÙŠÙˆØ§Ø¬Ù‡ ØªØ­Ø¯ÙŠØ§Ù‹ Ù…Ø­Ø¯Ø¯Ø§Ù‹ ÙŠØ±ÙŠØ¯ Ø­Ù„Ø§Ù‹ Ù„Ù‡',
            b: 'ÙŠØ´Ø¹Ø± Ø¨Ø£Ù† Ø´ÙŠØ¦Ø§Ù‹ Ù…Ø§ "Ù„ÙŠØ³ ØµØ­ÙŠØ­Ø§Ù‹" ÙÙŠ Ø­ÙŠØ§ØªÙ‡',
            c: 'ÙŠØ±ÙŠØ¯ Ø£Ù† ÙŠÙÙ‡Ù… Ù†ÙØ³Ù‡ Ø¨Ø´ÙƒÙ„ Ø£Ø¹Ù…Ù‚',
            d: 'Ù…Ø³ØªØ¹Ø¯ Ù„ØªØ­ÙˆÙ„ Ø¬Ø°Ø±ÙŠ ÙÙŠ Ø­ÙŠØ§ØªÙ‡'
        },
        q2: {
            a: '"ÙƒÙŠÙ Ø£Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø³Ø±Ø¹Ø©ØŸ"',
            b: '"Ù„Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø« Ù„ÙŠ Ù‡Ø°Ø§ Ø¯Ø§Ø¦Ù…Ø§Ù‹ØŸ"',
            c: '"Ù…Ø§ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªØ­Ù…Ù„Ù‡Ø§ Ù‡Ø°Ù‡ Ø§Ù„ØªØ¬Ø±Ø¨Ø©ØŸ"',
            d: '"Ù‡Ø°Ø§ Ø§Ù…ØªØ­Ø§Ù†/ÙØ±ØµØ© Ù„Ù„Ù†Ù…Ùˆ"'
        },
        q4: {
            a: 'Ù„Ø§ØŒ ÙƒÙ„ Ù…ÙˆÙ‚Ù Ù…Ø®ØªÙ„Ù ØªÙ…Ø§Ù…Ø§Ù‹',
            b: 'Ù†Ø¹Ù…ØŒ ÙŠÙ„Ø§Ø­Ø¸ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ´Ø§Ø¨Ù‡',
            c: 'Ù†Ø¹Ù…ØŒ Ù‡Ù†Ø§Ùƒ Ù†Ù…Ø· ÙˆØ§Ø¶Ø­ ÙŠØ±Ø§Ù‡',
            d: 'Ø§Ù„Ø¢Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„ØŒ Ø¨Ø¯Ø£ ÙŠÙ„Ø§Ø­Ø¸...'
        },
        q6: {
            a: 'Ù…Ø³ØªØ¹Ø¯ ØªÙ…Ø§Ù…Ø§Ù‹ - ÙŠØ±ÙŠØ¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù…Ù‡Ù…Ø§ ÙƒØ§Ù†Øª',
            b: 'Ù…Ø³ØªØ¹Ø¯ Ø¨Ø­Ø°Ø± - ÙŠØ±ÙŠØ¯ Ø§Ù„ØªØ¯Ø±Ø¬',
            c: 'Ù‚Ù„Ù‚ Ù„ÙƒÙ† Ù…Ø³ØªØ¹Ø¯ - ÙŠØ­ØªØ§Ø¬ Ø¯Ø¹Ù…Ø§Ù‹ ÙƒØ¨ÙŠØ±Ø§Ù‹',
            d: 'ØºÙŠØ± Ù…ØªØ£ÙƒØ¯ - ÙŠØ±ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ù‡Ø¯ÙˆØ¡'
        },
        q8: {
            a: 'Ø£Ù†Ù‡ Ù„ÙŠØ³ Ø¨Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ØªÙŠ ÙŠØ¸Ù†Ù‡Ø§',
            b: 'Ø£Ù†Ù‡ Ø§Ù„Ø³Ø¨Ø¨ ÙÙŠ Ù…Ø¹Ø¸Ù… Ù…Ø´Ø§ÙƒÙ„Ù‡',
            c: 'Ø£Ù†Ù‡ ÙŠØ­ØªØ§Ø¬ ØªØºÙŠÙŠØ±Ø§Ù‹ Ø¬Ø°Ø±ÙŠØ§Ù‹',
            d: 'Ø£Ù†Ù‡ Ø¨Ø®ÙŠØ± ÙƒÙ…Ø§ Ù‡Ùˆ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ ÙƒÙ„ Ù‡Ø°Ø§',
            e: 'ÙŠÙØ¶Ù„ Ø¹Ø¯Ù… Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ù‡Ø°Ø§'
        },
        q9: {
            a: 'Ù…Ø­Ø¯ÙˆØ¯ Ø¬Ø¯Ø§Ù‹ - Ø³Ø§Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ø£Ùˆ Ø£Ù‚Ù„',
            b: 'Ù…ØªÙˆØ³Ø· - 2-3 Ø³Ø§Ø¹Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹',
            c: 'Ø¬ÙŠØ¯ - 3-5 Ø³Ø§Ø¹Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹',
            d: 'Ù…Ù„ØªØ²Ù… ØªÙ…Ø§Ù…Ø§Ù‹ - Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø³Ø§Ø¹Ø§Øª'
        }
    };
    return answerTexts[question]?.[answer] || answer;
}

function getSubAnswerText(question, mainAnswer, subAnswer) {
    const subAnswerTexts = {
        q1: {
            a: {
                'work': 'Ø§Ù„ØªØ­Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„/Ø§Ù„Ù…Ù‡Ù†Ø©',
                'relationships': 'Ø§Ù„ØªØ­Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª',
                'self': 'Ø§Ù„ØªØ­Ø¯ÙŠ Ù…Ø¹ Ù†ÙØ³Ù‡',
                'decision': 'Ø§Ù„ØªØ­Ø¯ÙŠ ÙÙŠ Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…Ù‡Ù…'
            },
            b: {
                'emptiness': 'Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„ÙØ±Ø§Øº Ø±ØºÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª',
                'patterns': 'ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¤Ù„Ù…Ø©',
                'passion': 'ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø´ØºÙ ÙˆØ§Ù„Ù…Ø¹Ù†Ù‰',
                'misplaced': 'Ø¥Ø­Ø³Ø§Ø³ Ø¨Ø£Ù†Ù‡ Ù„ÙŠØ³ ÙÙŠ Ù…ÙƒØ§Ù†Ù‡ Ø§Ù„ØµØ­ÙŠØ­'
            },
            c: {
                'why-behavior': 'Ù„Ù…Ø§Ø°Ø§ ÙŠØªØµØ±Ù Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙŠ ÙŠØªØµØ±Ù Ø¨Ù‡Ø§ØŸ',
                'true-self': 'Ù…Ù† Ù‡Ùˆ Ø­Ù‚Ø§Ù‹ Ø®Ù„Ù ÙƒÙ„ Ø§Ù„Ø£Ù‚Ù†Ø¹Ø©ØŸ',
                'life-role': 'Ù…Ø§ Ù‡Ùˆ Ø¯ÙˆØ±Ù‡ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø©ØŸ',
                'potential': 'ÙƒÙŠÙ ÙŠØ­Ù‚Ù‚ Ø¥Ù…ÙƒØ§Ù†ÙŠØ§ØªÙ‡ Ø§Ù„ÙƒØ§Ù…Ù†Ø©ØŸ'
            },
            d: {
                'clear-vision': 'Ù„Ø¯ÙŠÙ‡ Ø±Ø¤ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙŠØ­ØªØ§Ø¬ Ø¯Ø¹Ù…Ø§Ù‹ Ù„Ù„ØªÙ†ÙÙŠØ°',
                'need-change': 'ÙŠØ¹Ø±Ù Ø£Ù†Ù‡ ÙŠØ­ØªØ§Ø¬ ØªØºÙŠÙŠØ±Ø§Ù‹ Ø¬Ø°Ø±ÙŠØ§Ù‹ Ù„ÙƒÙ† Ù„Ø§ ÙŠØ¹Ø±Ù ÙƒÙŠÙ',
                'awakening': 'Ù…Ø± Ø¨ØªØ¬Ø±Ø¨Ø© Ø£ÙŠÙ‚Ø¸ØªÙ‡ ÙˆÙŠØ±ÙŠØ¯ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¹Ù„ÙŠÙ‡Ø§',
                'enough': 'ÙˆØµÙ„ Ù„Ù…Ø±Ø­Ù„Ø© "ÙƒÙÙ‰" ÙˆÙŠØ±ÙŠØ¯ Ø­ÙŠØ§Ø© Ù…Ø®ØªÙ„ÙØ©'
            }
        }
    };
    return subAnswerTexts[question]?.[mainAnswer]?.[subAnswer] || subAnswer;
}

function getPatternText(pattern) {
    const patterns = {
        'people': 'Ù†ÙØ³ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø´Ø®Ø§Øµ ÙŠØ³Ø¨Ø¨ Ù„Ù‡ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„',
        'mistakes': 'ÙŠÙƒØ±Ø± Ù†ÙØ³ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡',
        'situations': 'ÙŠØ¬Ø¯ Ù†ÙØ³Ù‡ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ§Ù‚Ù',
        'reactions': 'Ø±Ø¯ÙˆØ¯ Ø£ÙØ¹Ø§Ù„Ù‡ Ù…ØªØ´Ø§Ø¨Ù‡Ø©'
    };
    return patterns[pattern] || pattern;
}
    
// Check authentication on load
window.onload = function() {
checkAuth();
setMinDates();
};

// Check authentication
function checkAuth() {
const authToken = sessionStorage.getItem('adminAuth');
const authTime = sessionStorage.getItem('authTime');
const oneHour = 60 * 60 * 1000;
if (authToken === 'true' && authTime && (Date.now() - parseInt(authTime) < oneHour)) {
document.getElementById('authCheck').style.display = 'none';
document.getElementById('mainContent').style.display = 'block';
loadBookings();
// Refresh every 30 seconds
setInterval(() => loadBookings(true), 30000);
} else {
document.getElementById('authCheck').style.display = 'flex';
document.getElementById('mainContent').style.display = 'none';
}
}

// Logout
function logout() {
if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
sessionStorage.clear();
window.location.href = 'admin-dashboard.html';
}
}

// Set minimum dates for date inputs
function setMinDates() {
const today = new Date().toISOString().split('T')[0];
document.querySelectorAll('input[type="date"]').forEach(input => {
input.min = today;
});
}



async function loadBookings(forceRefresh = false) {
    // Check cache first
    if (!forceRefresh && cachedBookings && cacheTime &&
        (Date.now() - cacheTime < 5 * 60 * 1000)) {
        allBookings = cachedBookings;
        filteredBookings = allBookings;
        displayBookingsByCategory();
        updateStats();
        return;
    }
    
    showLoading(true);
    try {
        // Get all bookings without filter
        const snapshot = await db.collection('bookings')
            .orderBy('createdAt', 'desc')
            .get();
        
        allBookings = [];
        
        snapshot.forEach(doc => {
            const data = doc.data();
            const booking = {
                id: doc.id,
                ...data,
                // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                name: data.name || data.basicInfo?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                email: data.email || data.basicInfo?.email || '',
                phone: data.phone || data.basicInfo?.phone || '',
                journeyType: data.journeyType || data.selectedJourney || '',
                createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date()
            };
            allBookings.push(booking);
        });
        
        // Cache the data
        cachedBookings = allBookings;
        cacheTime = Date.now();
        
        // Update stats
        updateStats();
        
        // Apply filters
        applyFilters();
        
        showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allBookings.length} Ø­Ø¬Ø²`, 'success');
    } catch (error) {
        console.error('Error loading bookings:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const tbody = document.getElementById('bookingsTableBody');
        if (tbody) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 50px;">
                        <div class="empty-state">
                            <div class="empty-state-icon">âš ï¸</div>
                            <h3>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                            <p style="color: #666; margin: 10px 0;">ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</p>
                            <button class="btn btn-primary" onclick="loadBookings(true)">
                                Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }
    } finally {
        showLoading(false);
    }
}

// Update stats
function updateStats() {
const stats = {
pending: 0,
confirming: 0,
confirmed: 0,
completed: 0,
converted: 0,
cancelled: 0
};
allBookings.forEach(booking => {
const status = booking.status || 'pending';
if (stats.hasOwnProperty(status)) {
stats[status]++;
}
});
document.getElementById('pendingCount').textContent = stats.pending;
document.getElementById('confirmingCount').textContent = stats.confirming;
document.getElementById('confirmedCount').textContent = stats.confirmed;
document.getElementById('completedCount').textContent = stats.completed + stats.converted;
}

// Apply filters
function applyFilters() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const journeyFilter = document.getElementById('journeyFilter').value;
    const challengeFilter = document.getElementById('challengeFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;
    
    filteredBookings = allBookings.filter(booking => {
        // Search filter
        if (searchTerm) {
            const searchableText = [
                booking.name,
                booking.email,
                booking.phone,
                booking.message
            ].filter(Boolean).join(' ').toLowerCase();
            
            if (!searchableText.includes(searchTerm)) {
                return false;
            }
        }
        
        // Journey filter - ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        if (journeyFilter) {
            const bookingJourney = booking.selectedJourney || booking.journeyType;
            if (journeyFilter === 'multi') {
                if (!bookingJourney || !bookingJourney.includes('-')) {
                    return false;
                }
            } else if (!bookingJourney || bookingJourney !== journeyFilter) {
                return false;
            }
        }
        
        // Challenge filter
        if (challengeFilter && booking.challengeType !== challengeFilter) {
            return false;
        }
        
        // Status filter
        if (statusFilter && (booking.status || 'pending') !== statusFilter) {
            return false;
        }
        
        return true;
    });
    
    displayBookingsByCategory();
}

// Display bookings by category
function displayBookingsByCategory() {
const tbody = document.getElementById('bookingsTableBody');
let html = '';
// Categorize filtered bookings
const newBookings = [];
const processingBookings = [];
const completedBookings = [];
const cancelledBookings = [];
filteredBookings.forEach(booking => {
switch(booking.status) {
case 'pending':
newBookings.push(booking);
break;
case 'confirming':
case 'confirmed':
processingBookings.push(booking);
break;
case 'completed':
case 'converted':
completedBookings.push(booking);
break;
case 'cancelled':
cancelledBookings.push(booking);
break;
default:
newBookings.push(booking);
}
});
// Sort by urgency level
newBookings.sort((a, b) => (b.urgencyLevel || 0) - (a.urgencyLevel || 0));
// Display new bookings first
if (newBookings.length > 0) {
html += `
<tr class="category-header">
<td colspan="8" style="background: #fff3cd; color: #856404; font-weight: bold; padding: 10px;">
Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© (${newBookings.length})
</td>
</tr>
`;
newBookings.forEach(booking => {
html += generateBookingRow(booking);
});
}
// Display processing bookings
if (processingBookings.length > 0) {
html += `
<tr class="category-header">
<td colspan="8" style="background: #d1ecf1; color: #0c5460; font-weight: bold; padding: 10px;">
Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (${processingBookings.length})
</td>
</tr>
`;
processingBookings.forEach(booking => {
html += generateBookingRow(booking);
});
}
// Display completed bookings
if (completedBookings.length > 0) {
html += `
<tr class="category-header">
<td colspan="8" style="background: #d4edda; color: #155724; font-weight: bold; padding: 10px;">
Ù…ÙƒØªÙ…Ù„Ø©/Ù…Ø­ÙˆÙ„Ø© (${completedBookings.length})
</td>
</tr>
`;
completedBookings.forEach(booking => {
html += generateBookingRow(booking);
});
}
// Display cancelled bookings
if (cancelledBookings.length > 0) {
html += `
<tr class="category-header">
<td colspan="8" style="background: #f8d7da; color: #721c24; font-weight: bold; padding: 10px;">
Ù…Ù„ØºÙŠØ© (${cancelledBookings.length})
</td>
</tr>
`;
cancelledBookings.forEach(booking => {
html += generateBookingRow(booking);
});
}
if (html === '') {
html = `
<tr>
<td colspan="8" class="empty-state">
<div class="empty-state-icon">ğŸ“­</div>
<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª</p>
</td>
</tr>
`;
}
tbody.innerHTML = html;
}

// Generate booking row
function generateBookingRow(booking) {
    const date = booking.createdAt;
    const journeyName = getJourneyDisplayName(booking.selectedJourney || booking.journeyType);
    const recommendedName = getJourneyDisplayName(booking.recommendedJourney);
    const isMatched = booking.matchedRecommendation;
    const urgencyClass = booking.urgencyLevel >= 8 ? 'urgent' : 
                        booking.urgencyLevel >= 5 ? 'moderate' : 'low';
    
    return `
        <tr>
            <td>${formatDate(date)}</td>
            <td>
                <div class="client-info">
                    <span class="client-name">${booking.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    <span class="client-contact">${booking.email || ''}</span>
                    <span class="client-contact">${booking.phone || ''}</span>
                </div>
            </td>
            <td>
                <span class="type-badge ${getChallengeClass(booking.challengeType)}">
                    ${getChallengeDisplayName(booking.challengeType)}
                </span>
            </td>
            <td>
                <div class="journey-info">
                    <span class="journey-badge ${booking.selectedJourney || booking.journeyType || ''}">
                        ${journeyName}
                    </span>
                    ${booking.selectedJourney !== booking.recommendedJourney ? 
                        `<small class="recommended-note">
                            (Ù…ÙˆØµÙ‰ Ø¨Ù‡: ${recommendedName})
                        </small>` : ''}
                </div>
            </td>
            <td>
                ${isMatched ? 
                    '<span class="match-icon yes">âœ“</span>' : 
                    '<span class="match-icon no">âœ—</span>'}
            </td>
            <td>
                <span class="urgency-level ${urgencyClass}">
                    ${booking.urgencyLevel || '-'}/10
                </span>
            </td>
            <td>
                <span class="status-badge ${booking.status || 'pending'}">
                    ${getStatusName(booking.status)}
                </span>
            </td>
            <td>
                <div class="actions-cell">
                    ${generateActions(booking)}
                </div>
            </td>
        </tr>
    `;
}

// Generate action buttons
function generateActions(booking) {
// ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ booking.id
if (!booking || !booking.id) {
console.error('Booking ID is missing:', booking);
return '<span style="color: red;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>';
}
// ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
const phone = booking.phone || '';
const name = booking.name || 'Ø¹Ù…ÙŠÙ„';
let html = '';
// Ø²Ø± WhatsApp - Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù‡Ø§ØªÙ
if (phone) {
html += `<button class="btn btn-whatsapp" onclick="openWhatsApp('${phone}', '${name}')">ÙˆØ§ØªØ³Ø§Ø¨</button>`;
} else {
html += `<button class="btn btn-whatsapp" disabled title="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ">ÙˆØ§ØªØ³Ø§Ø¨</button>`;
}
// Ø²Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
html += `<button class="btn btn-info" onclick="showNotes('${booking.id}')">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>`;
// Send login credentials button for users with accounts
if (booking.accountCreated && booking.userId) {
html += `<button class="btn btn-success" onclick="sendLoginCredentials('${booking.id}')">Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</button>`;
}
// Status-specific actions
const status = booking.status || 'pending';
if (status === 'pending') {
html += `<button class="btn btn-primary" onclick="showAppointmentsModal('${booking.id}')">Ø¥Ø±Ø³Ø§Ù„ Ù…ÙˆØ§Ø¹ÙŠØ¯</button>`;
} else if (status === 'confirming') {
html += `<button class="btn btn-success" onclick="showConfirmModal('${booking.id}')">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯</button>`;
} else if (status === 'confirmed') {
html += `<button class="btn btn-warning" onclick="convertToJourney('${booking.id}')">ØªØ­ÙˆÙŠÙ„ Ù„Ø±Ø­Ù„Ø©</button>`;
}
// Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²
if (status !== 'cancelled' && status !== 'completed' && status !== 'converted') {
html += `<button class="btn btn-danger btn-sm" onclick="cancelBooking('${booking.id}')">Ø¥Ù„ØºØ§Ø¡</button>`;
}
// View details - always show
html += `<button class="btn btn-secondary" onclick="viewDetails('${booking.id}')">ØªÙØ§ØµÙŠÙ„</button>`;
return html;
}



// Reset filters
function resetFilters() {
document.getElementById('searchInput').value = '';
document.getElementById('journeyFilter').value = '';
document.getElementById('challengeFilter').value = '';
document.getElementById('statusFilter').value = '';
applyFilters();
}

// Refresh data
function refreshData() {
loadBookings(true);
}

// Open WhatsApp
function openWhatsApp(phone, name, customMessage = null) {
// ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
if (!phone || phone === 'undefined' || phone === undefined) {
console.error('Phone number is missing:', phone);
alert('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
return;
}
// ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
const phoneStr = String(phone);
const cleanPhone = phoneStr.replace(/\D/g, '');
if (!cleanPhone) {
alert('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­');
return;
}
const fullPhone = cleanPhone.startsWith('2') ? cleanPhone : '2' + cleanPhone;
// Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
const message = customMessage || `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name || 'Ø¹Ù…ÙŠÙ„Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²'}ØŒ Ù…Ø¹Ùƒ Ù…Ø­Ù…ÙˆØ¯ ÙØ¤Ø§Ø¯...`;
const whatsappUrl = `https://wa.me/${fullPhone}?text=${encodeURIComponent(message)}`;
window.open(whatsappUrl, '_blank');
}

// Show notes modal
async function showNotes(bookingId) {
currentBookingId = bookingId;
const booking = allBookings.find(b => b.id === bookingId);
if (!booking) return;
// Update info box
document.getElementById('bookingInfoBox').innerHTML = `
<h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø²:</h4>
<p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${booking.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
<p><strong>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:</strong> ${getJourneyDisplayName(booking.journeyType)}</p>
<p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(booking.createdAt)}</p>
`;
// Load existing notes
document.getElementById('notesTextarea').value = booking.notes || '';
openModal('notesModal');
}

// Save notes
async function saveNotes() {
const notes = document.getElementById('notesTextarea').value;
if (!currentBookingId) return;
showLoading(true);
try {
await db.collection('bookings').doc(currentBookingId).update({
notes: notes,
notesUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
});
showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
closeModal('notesModal');
loadBookings(true);
} catch (error) {
console.error('Error saving notes:', error);
showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª', 'error');
} finally {
showLoading(false);
}
}

// Send login credentials
function sendLoginCredentials(bookingId) {
const booking = allBookings.find(b => b.id === bookingId);
if (!booking) return;
if (!booking.accountCreated) {
showNotification('Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯', 'error');
return;
}
let message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${booking.name}!\n\n`;
message += `ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰\n\n`;
message += `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©:\n`;
message += `Ø§Ù„Ø¨Ø±ÙŠØ¯: ${booking.email}\n`;
if (booking.authProvider === 'google') {
message += `ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google\n\n`;
} else if (booking.temporaryPassword) {
message += `ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ù‚ØªØ©: ${booking.temporaryPassword}\n`;
message += `ÙŠÙÙ†ØµØ­ Ø¨ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„\n\n`;
} else {
message += `ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„\n\n`;
}
message += `Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„:\n`;
message += `https://mahmoudfouad25.github.io/portal.html\n\n`;
message += `Ù†ØµÙŠØ­Ø©: Ø§Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„ÙŠÙ‡Ø§\n`;
message += `Ø¥Ø°Ø§ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ Ù…Ù† ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„`;
// Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± WhatsApp
openWhatsApp(booking.phone, booking.name, message);
showNotification('ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„', 'success');
}

// Slots Management Functions
function showSlotsManager() {
updateSlotsList();
document.getElementById('slotsModal').style.display = 'block';
}

function updateSlotsList() {
const list = document.getElementById('slotsList');
list.innerHTML = '';
if (availableSlots.length === 0) {
list.innerHTML = '<p style="color: #999; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø­ÙÙˆØ¸Ø©</p>';
} else {
availableSlots.forEach((slot, i) => {
list.innerHTML += `
<div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f0f0f0; margin: 5px 0; border-radius: 5px;">
<span>${slot}</span>
<button class="btn btn-danger btn-sm" onclick="removeSlot(${i})">Ø­Ø°Ù</button>
</div>
`;
});
}
}

function addSlot() {
const date = document.getElementById('slotDate').value;
const time = document.getElementById('slotTime').value;
if (!date || !time) {
showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª', 'error');
return;
}
const dateObj = new Date(date);
const dateStr = dateObj.toLocaleDateString('ar-EG', {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
});
const slotStr = `${dateStr} - ${time}`;
if (availableSlots.includes(slotStr)) {
showNotification('Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
return;
}
availableSlots.push(slotStr);
availableSlots.sort();
localStorage.setItem('availableSlots', JSON.stringify(availableSlots));
document.getElementById('slotDate').value = '';
document.getElementById('slotTime').value = '';
showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
updateSlotsList();
}

function addBulkSlots() {
const startDate = document.getElementById('bulkStartDate').value;
const endDate = document.getElementById('bulkEndDate').value;
const times = Array.from(document.getElementById('bulkTimes').selectedOptions).map(o => o.value);
if (!startDate || !endDate || times.length === 0) {
showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
return;
}
const start = new Date(startDate);
const end = new Date(endDate);
let count = 0;
for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
const dateStr = new Date(d).toLocaleDateString('ar-EG', {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
});
times.forEach(time => {
const slotStr = `${dateStr} - ${time}`;
if (!availableSlots.includes(slotStr)) {
availableSlots.push(slotStr);
count++;
}
});
}
availableSlots.sort();
localStorage.setItem('availableSlots', JSON.stringify(availableSlots));
showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${count} Ù…ÙˆØ¹Ø¯`, 'success');
updateSlotsList();
// Clear form
document.getElementById('bulkStartDate').value = '';
document.getElementById('bulkEndDate').value = '';
document.getElementById('bulkTimes').selectedIndex = -1;
}

function removeSlot(index) {
if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ')) {
availableSlots.splice(index, 1);
localStorage.setItem('availableSlots', JSON.stringify(availableSlots));
showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¹Ø¯', 'success');
updateSlotsList();
}
}

// Show appointments modal
function showAppointmentsModal(bookingId) {
currentBookingId = bookingId;
const container = document.getElementById('slotsContainer');
// Display available slots
let html = '';
if (availableSlots.length === 0) {
html = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ù† "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"</p>';
} else {
availableSlots.forEach((slot, index) => {
html += `
<div class="slot-item" onclick="toggleSlot(this, ${index})">
<input type="checkbox" id="slot_${index}" value="${index}">
<label for="slot_${index}">
${slot}
</label>
</div>
`;
});
}
container.innerHTML = html;
document.getElementById('customMessage').value = '';
openModal('appointmentsModal');
}

// Toggle slot selection
function toggleSlot(element, index) {
element.classList.toggle('selected');
const checkbox = element.querySelector('input[type="checkbox"]');
checkbox.checked = !checkbox.checked;
}

// Send appointments
async function sendAppointments() {
const selectedSlots = [];
document.querySelectorAll('#slotsContainer input[type="checkbox"]:checked').forEach(input => {
const index = parseInt(input.value);
selectedSlots.push(availableSlots[index]);
});
if (selectedSlots.length === 0) {
showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ù…ÙˆØ¹Ø¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
return;
}
if (selectedSlots.length > 5) {
showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± 5 Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰', 'error');
return;
}
const booking = allBookings.find(b => b.id === currentBookingId);
if (!booking) return;
const customMessage = document.getElementById('customMessage').value;
// Ø¨Ù†Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© WhatsApp
let message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${booking.name}ØŒ\n\n`;
if (customMessage) {
message += customMessage + '\n\n';
}
message += 'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ø¬Ù„Ø³ØªÙƒ:\n\n';
selectedSlots.forEach((slot, index) => {
message += `${index + 1}. ${slot}\n`;
});
message += '\nÙ…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ Ø¨Ø§Ù„Ø±Ù‚Ù….';
// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ø¨Ø± WhatsApp
openWhatsApp(booking.phone, booking.name, message);
// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø²
try {
await db.collection('bookings').doc(currentBookingId).update({
status: 'confirming',
proposedSlots: selectedSlots,
lastContactAt: firebase.firestore.FieldValue.serverTimestamp()
});
showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
closeModal('appointmentsModal');
loadBookings(true);
} catch (error) {
console.error('Error updating booking:', error);
showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø²', 'error');
}
}

// Show confirm modal
function showConfirmModal(bookingId) {
currentBookingId = bookingId;
const booking = allBookings.find(b => b.id === bookingId);
if (!booking) return;
// Pre-fill if editing
if (booking.appointmentDate) {
const date = booking.appointmentDate.toDate ?
booking.appointmentDate.toDate() : new Date(booking.appointmentDate);
document.getElementById('appointmentDate').value = date.toISOString().split('T')[0];
}
document.getElementById('appointmentTime').value = booking.appointmentTime || '';
document.getElementById('sessionType').value = booking.sessionType || 'online';
document.getElementById('sessionLink').value = booking.sessionLink || '';
openModal('confirmModal');
}

// Confirm appointment
async function confirmAppointment() {
const date = document.getElementById('appointmentDate').value;
const time = document.getElementById('appointmentTime').value;
const sessionType = document.getElementById('sessionType').value;
const sessionLink = document.getElementById('sessionLink').value;
if (!date || !time) {
showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª', 'error');
return;
}
if (sessionType === 'online' && !sessionLink) {
showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†', 'error');
return;
}
showLoading(true);
try {
await db.collection('bookings').doc(currentBookingId).update({
status: 'confirmed',
appointmentDate: new Date(date),
appointmentTime: time,
sessionType: sessionType,
sessionLink: sessionLink,
confirmedAt: firebase.firestore.FieldValue.serverTimestamp()
});
// Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
const booking = allBookings.find(b => b.id === currentBookingId);
if (booking) {
const dateObj = new Date(date);
const dateStr = dateObj.toLocaleDateString('ar-EG', {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
});
let message = `ØªØ£ÙƒÙŠØ¯ Ù…ÙˆØ¹Ø¯ Ø¬Ù„Ø³ØªÙƒ\n\n`;
message += `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateStr}\n`;
message += `Ø§Ù„ÙˆÙ‚Øª: ${time}\n`;
message += `Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù„Ø³Ø©: ${getSessionTypeName(sessionType)}\n`;
if (sessionType === 'online' && sessionLink) {
message += `Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø©: ${sessionLink}\n`;
}
message += '\nØ£Ø±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡.';
// Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©
navigator.clipboard.writeText(message).then(() => {
showNotification('ØªÙ… Ù†Ø³Ø® Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯', 'success');
});
// Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± WhatsApp
openWhatsApp(booking.phone, booking.name, message);
}
showNotification('ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
closeModal('confirmModal');
loadBookings(true);
} catch (error) {
console.error('Error confirming appointment:', error);
showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯', 'error');
} finally {
showLoading(false);
}
}

// Convert to journey
async function convertToJourney(bookingId) {
const booking = allBookings.find(b => b.id === bookingId);
if (!booking) return;
// Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø©
let journeyType = booking.journeyType;
let isMultiPath = false;
if (journeyType === 'eshraq-baseera' || journeyType === 'baseera-sakeena') {
isMultiPath = true;
// Ù„Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ØŒ Ù†Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
journeyType = journeyType.split('-')[0];
}
try {
showLoading(true);
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ø­Ù„Ø© Ù†Ø´Ø·Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„
const existingJourney = await db.collection('journeys')
.where('clientEmail', '==', booking.email)
.where('status', '==', 'active')
.limit(1)
.get();
if (!existingJourney.empty) {
// Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø¯ÙŠÙ‡ Ø±Ø­Ù„Ø© Ù†Ø´Ø·Ø©
const journeyId = existingJourney.docs[0].id;
if (confirm(`${booking.name} Ù„Ø¯ÙŠÙ‡ Ø±Ø­Ù„Ø© Ù†Ø´Ø·Ø© Ø¨Ø§Ù„ÙØ¹Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©ØŸ`)) {
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
await addSessionToJourney(journeyId, booking);
// ÙØªØ­ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø­Ù„Ø©
window.location.href = `admin-journey-management.html?clientId=${booking.userId}&journeyId=${journeyId}&bookingId=${booking.id}`;
}
} else {
// Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
const newJourney = await createNewJourney(booking);
// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ø¨Ø§Ø´Ø±Ø©
await db.collection('sessions').add({
journeyId: newJourney.id,
sessionNumber: 1,
type: booking.sessionType,
status: 'scheduled',
scheduledDate: booking.appointmentDate,
scheduledTime: booking.appointmentTime || '10:00 AM',
duration: 90,
clientName: booking.name,
clientPhone: booking.phone,
phase: 1,
createdAt: firebase.firestore.FieldValue.serverTimestamp()
});
// ÙØªØ­ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
window.location.href = `admin-journey-management.html?clientId=${booking.userId}&journeyId=${newJourney.id}&bookingId=${booking.id}`;
}
} catch (error) {
console.error('Error converting to journey:', error);
showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² Ù„Ø±Ø­Ù„Ø©', 'error');
} finally {
showLoading(false);
}
}

// Create new journey
async function createNewJourney(booking) {
// Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø±Ø­Ù„Ø§Øª
let journeyType = booking.journeyType;
let isMultiPath = false;
let nextJourneyType = null;
if (journeyType === 'eshraq-baseera' || journeyType === 'baseera-sakeena') {
isMultiPath = true;
const parts = journeyType.split('-');
journeyType = parts[0];
nextJourneyType = parts[1];
}
const journeyData = {
// Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
clientName: booking.name,
clientEmail: booking.email,
clientPhone: booking.phone,
userId: booking.userId || booking.id,
clientId: booking.userId || booking.id,
// Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©
program: getJourneyDisplayName(booking.journeyType),
journeyType: journeyType,
fullJourneyPath: booking.journeyType, // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„
isMultiPath: isMultiPath,
nextJourneyType: nextJourneyType,
// Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
challengeType: booking.challengeType,
awarenessLevel: booking.awarenessLevel,
urgencyLevel: booking.urgencyLevel,
matchedRecommendation: booking.matchedRecommendation,
recommendedJourney: booking.recommendedJourney,
journeyJustification: booking.journeyJustification,
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
status: 'active',
startDate: firebase.firestore.FieldValue.serverTimestamp(),
currentPhase: 1,
totalPhases: getProgramPhases(journeyType),
progress: 0,
completedSessions: 0,
totalSessions: getProgramSessions(journeyType),
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø£Ù„ÙˆÙ„ÙŠØ©
engagementScore: 80,
assignedTools: [],
practicesCompleted: 0,
practicesAssigned: 0,
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·
lastActivityDate: firebase.firestore.FieldValue.serverTimestamp(),
// Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ø­Ø¬Ø²
goals: booking.goals || booking.message || '',
challenges: booking.challenges || '',
notes: booking.notes || '',
// Metadata
lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
createdAt: firebase.firestore.FieldValue.serverTimestamp()
};
// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©
const journeyRef = await db.collection('journeys').add(journeyData);
// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
const phases = getDefaultPhases(journeyType);
const batch = db.batch();
phases.forEach((phase, index) => {
const phaseRef = journeyRef.collection('phases').doc();
batch.set(phaseRef, {
...phase,
order: index + 1,
status: index === 0 ? 'in_progress' : 'pending',
startDate: index === 0 ? firebase.firestore.FieldValue.serverTimestamp() : null
});
});
await batch.commit();
// Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
await db.collection('activities').add({
journeyId: journeyRef.id,
clientId: booking.userId,
clientName: booking.name,
type: 'milestone',
description: `Ø¨Ø¯Ø£ ${booking.name} ${getJourneyDisplayName(booking.journeyType)}`,
timestamp: firebase.firestore.FieldValue.serverTimestamp()
});
// Ø±Ø¨Ø· Ø§Ù„Ø­Ø¬Ø² Ø¨Ø§Ù„Ø±Ø­Ù„Ø©
await db.collection('bookings').doc(booking.id).update({
status: 'converted',
journeyId: journeyRef.id,
convertedAt: firebase.firestore.FieldValue.serverTimestamp()
});
// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù† ÙˆØ¬Ø¯
if (booking.userId) {
await db.collection('users').doc(booking.userId).update({
activeJourneyId: journeyRef.id,
currentProgram: getJourneyDisplayName(booking.journeyType),
journeyStartDate: firebase.firestore.FieldValue.serverTimestamp()
});
}
showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
return {
id: journeyRef.id,
...journeyData
};
}

// Add session to existing journey
async function addSessionToJourney(journeyId, booking) {
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø²
await db.collection('bookings').doc(booking.id).update({
status: 'converted',
journeyId: journeyId,
convertedAt: firebase.firestore.FieldValue.serverTimestamp()
});
showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©', 'success');
}

// Get program phases
function getProgramPhases(program) {
const phases = {
'eshraq': 1,
'baseera': 3,
'sakeena': 3
};
return phases[program] || 1;
}

// Get program sessions
function getProgramSessions(program) {
const sessions = {
'eshraq': 3,
'baseera': 12,
'sakeena': 24
};
return sessions[program] || 3;
}

// Get default phases
function getDefaultPhases(program) {
const phases = {
'eshraq': [
{ name: 'Ø¬Ù„Ø³Ø© Ø§Ù„Ø¥Ø´Ø±Ø§Ù‚Ø©', description: 'Ø¬Ù„Ø³Ø§Øª Ù…ÙƒØ«ÙØ© Ù„Ù„ÙˆØ¶ÙˆØ­ ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©' }
],
'baseera': [
{ name: 'Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø°Ø§Øª', description: 'ÙÙ‡Ù… Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙˆØ§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' },
{ name: 'Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ¹ÙŠ', description: 'ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„ÙØ±Øµ' },
{ name: 'Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„', description: 'Ø±Ø³Ù… Ø®Ø§Ø±Ø·Ø© Ø§Ù„ØªØºÙŠÙŠØ±' }
],
'sakeena': [
{ name: 'Ø§Ù„Ø¥Ù†Ø¨Ø§Øª', description: 'ÙƒØ´Ù Ø§Ù„Ø¬Ø°ÙˆØ± ÙˆØ¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ­ÙˆÙ„' },
{ name: 'Ø§Ù„Ù†Ù…Ùˆ', description: 'Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' },
{ name: 'Ø§Ù„Ø§Ø²Ø¯Ù‡Ø§Ø±', description: 'Ø¯Ù…Ø¬ Ø§Ù„ØªØºÙŠÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©' }
]
};
return phases[program] || phases['eshraq'];
}

// Get session type name

// Cancel booking
async function cancelBooking(bookingId) {
const booking = allBookings.find(b => b.id === bookingId);
if (!booking) return;
const confirmCancel = confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø² ${booking.name}ØŸ`);
if (!confirmCancel) return;
showLoading(true);
try {
await db.collection('bookings').doc(bookingId).update({
status: 'cancelled',
cancelledAt: firebase.firestore.FieldValue.serverTimestamp(),
cancelReason: prompt('Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):') || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'
});
// Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„
const message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${booking.name},\n\nÙ†Ø£Ø³Ù Ù„Ø¥Ø¨Ù„Ø§ØºÙƒ Ø£Ù†Ù‡ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø²Ùƒ Ù„Ù€${getJourneyDisplayName(booking.journeyType)}.\n\nØ¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±ØŒ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§.\n\nÙ…Ø¹ ØªØ­ÙŠØ§ØªÙŠØŒ\nÙ…Ø­Ù…ÙˆØ¯ ÙØ¤Ø§Ø¯`;
if (booking.phone) {
openWhatsApp(booking.phone, booking.name, message);
}
showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²', 'success');
loadBookings(true);
} catch (error) {
console.error('Error cancelling booking:', error);
showNotification('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²', 'error');
} finally {
showLoading(false);
}
}

// View booking details
// Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© viewDetails Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
async function viewDetails(bookingId) {
    // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ bookingId
    if (!bookingId) {
        console.error('No booking ID provided');
        showNotification('Ø®Ø·Ø£: Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù„Ù„Ø­Ø¬Ø²', 'error');
        return;
    }
    
    // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ø¬Ø²
    const booking = allBookings.find(b => b.id === bookingId);
    
    // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ø¬Ø²
    if (!booking) {
        console.error('Booking not found:', bookingId);
        showNotification('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø²', 'error');
        return;
    }
    
    let detailsHTML = `
        <div class="info-box">
            <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:</h4>
            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${booking.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
            <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${booking.email || ''}</p>
            <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${booking.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
            <p><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${booking.age || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
            <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²:</strong> ${booking.bookingNumber || ''}</p>
            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²:</strong> ${formatDate(booking.createdAt)}</p>
        </div>`;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª
    detailsHTML += `
        <div class="info-box">
            <h4>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª:</h4>
            <p><strong>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ:</strong> ${getChallengeDisplayName(booking.challengeType)}</p>
            <p><strong>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ù„Ø­Ø§Ø­:</strong> ${booking.urgencyLevel || '-'}/10</p>
            <p><strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ§Ø­:</strong> ${booking.timeAvailable || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
        </div>`;
    
    // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ø­Ù„Ø©
    detailsHTML += `
        <div class="info-box">
            <h4>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ø­Ù„Ø©:</h4>
            <p><strong>Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</strong> ${getJourneyDisplayName(booking.selectedJourney || booking.journeyType)}</p>
            <p><strong>Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§:</strong> ${getJourneyDisplayName(booking.recommendedJourney)}</p>
            <p><strong>ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„ØªÙˆØµÙŠØ©:</strong> ${booking.matchedRecommendation ? 
                '<span style="color: green;">Ù†Ø¹Ù… âœ“</span>' : 
                '<span style="color: orange;">Ù„Ø§ - Ø§Ø®ØªØ§Ø± Ù…Ø³Ø§Ø±Ø§Ù‹ Ù…Ø®ØªÙ„ÙØ§Ù‹</span>'}</p>
            ${booking.justificationForChoice ? 
                `<p><strong>ØªØ¨Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±:</strong></p>
                <div style="background: #f5f5f5; padding: 10px; border-radius: 5px; margin-top: 5px;">
                    "${booking.justificationForChoice}"
                </div>` : ''}
        </div>`;
    
    // Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    detailsHTML += `
        <div class="info-box" style="background: #e8f4f8; border-right: 4px solid #2C5530;">
            <h4>Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</h4>`;
    
    // Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ù„Ù…
    if (booking.mainPainPoint) {
        detailsHTML += `
            <div style="margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                <strong>Ø£ÙƒØ«Ø± Ù…Ø§ ÙŠØ¤Ù„Ù…Ù‡ ÙÙŠ Ø­ÙŠØ§ØªÙ‡:</strong>
                <p style="margin: 10px 20px; padding: 10px; background: #f9f9f9; border-right: 3px solid #2C5530; border-radius: 3px;">
                    "${booking.mainPainPoint}"
                </p>
            </div>`;
    }
    
    // Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©
    if (booking.futureVision) {
        detailsHTML += `
            <div style="margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                <strong>Ø±Ø¤ÙŠØªÙ‡ Ø¨Ø¹Ø¯ Ø¹Ø§Ù… Ù…Ù† Ø§Ù„Ø¢Ù†:</strong>
                <p style="margin: 10px 20px; padding: 10px; background: #f9f9f9; border-right: 3px solid #8B9467; border-radius: 3px;">
                    "${booking.futureVision}"
                </p>
            </div>`;
    }
    
    // Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø°Ø§ØªÙŠØ©
    detailsHTML += `
        <div style="margin: 15px 0; padding: 15px; background: white; border-radius: 5px;">
            <strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø°Ø§ØªÙŠØ©:</strong>
            <div style="display: grid; gap: 10px; margin-top: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Ø¥Ù„Ø­Ø§Ø­ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ø¯Ø¹Ù…:</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 150px; height: 8px; background: #e0e0e0; border-radius: 4px; position: relative;">
                            <div style="width: ${(booking.urgencyLevel || 0) * 10}%; height: 100%; 
                                background: ${booking.urgencyLevel >= 7 ? '#dc3545' : booking.urgencyLevel >= 4 ? '#ffc107' : '#28a745'}; 
                                border-radius: 4px;"></div>
                        </div>
                        <strong>${booking.urgencyLevel || 0}/10</strong>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 150px; height: 8px; background: #e0e0e0; border-radius: 4px; position: relative;">
                            <div style="width: ${(parseInt(booking.investmentLevel) || 0) * 10}%; height: 100%; 
                                background: ${parseInt(booking.investmentLevel) >= 7 ? '#28a745' : parseInt(booking.investmentLevel) >= 4 ? '#ffc107' : '#dc3545'}; 
                                border-radius: 4px;"></div>
                        </div>
                        <strong>${booking.investmentLevel || 0}/10</strong>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Ø§Ù„Ø«Ù‚Ø© ÙÙŠ Ø§Ù„ØªØºÙŠÙŠØ±:</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 150px; height: 8px; background: #e0e0e0; border-radius: 4px; position: relative;">
                            <div style="width: ${(parseInt(booking.confidenceLevel) || 0) * 10}%; height: 100%; 
                                background: ${parseInt(booking.confidenceLevel) >= 7 ? '#28a745' : parseInt(booking.confidenceLevel) >= 4 ? '#ffc107' : '#dc3545'}; 
                                border-radius: 4px;"></div>
                        </div>
                        <strong>${booking.confidenceLevel || 0}/10</strong>
                    </div>
                </div>
            </div>
        </div>`;
    
    // Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ¬ÙˆØ¯
    if (booking.previousExperience && Array.isArray(booking.previousExperience) && booking.previousExperience.length > 0) {
        detailsHTML += `
            <div style="margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                <strong>Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</strong>
                <p style="margin: 5px 0 0 20px; color: #333;">
                    ${booking.previousExperience.map(e => getExperienceText(e)).join('ØŒ ')}
                </p>
            </div>`;
    }
    
    // Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¯Ø¹Ù… - Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ¬ÙˆØ¯
    if (booking.supportSystems && Array.isArray(booking.supportSystems) && booking.supportSystems.length > 0) {
        detailsHTML += `
            <div style="margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                <strong>Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¯Ø¹Ù… ÙÙŠ Ø­ÙŠØ§ØªÙ‡:</strong>
                <p style="margin: 5px 0 0 20px; color: #333;">
                    ${booking.supportSystems.map(s => getSupportText(s)).join('ØŒ ')}
                </p>
            </div>`;
    }
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    if (booking.additionalInfo && booking.additionalInfo !== 'Ù„Ø§') {
        detailsHTML += `
            <div style="margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</strong>
                <p style="margin: 10px 20px; padding: 10px; background: #f9f9f9; border-radius: 3px;">
                    "${booking.additionalInfo}"
                </p>
            </div>`;
    }
    
    detailsHTML += `</div>`;
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
    if (booking.accountCreated) {
        detailsHTML += `
        <div class="info-box">
            <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:</h4>
            <p><strong>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨:</strong> Ù†Ø¹Ù…</p>
            <p><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${booking.authProvider === 'google' ? 'Google' : 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'}</p>
            <p><strong>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${booking.userId || ''}</p>
        </div>`;
    }
    
    // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    if (booking.notes) {
        detailsHTML += `
        <div class="info-box">
            <h4>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h4>
            <p>${booking.notes}</p>
        </div>`;
    }
    
    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯
    if (booking.status === 'confirmed' && booking.appointmentDate) {
        const date = booking.appointmentDate.toDate ?
            booking.appointmentDate.toDate() : new Date(booking.appointmentDate);
        detailsHTML += `
        <div class="info-box">
            <h4>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯:</h4>
            <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${date.toLocaleDateString('ar-EG')}</p>
            <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${booking.appointmentTime || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
            <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> ${getSessionTypeName(booking.sessionType)}</p>
            ${booking.sessionLink ? `<p><strong>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> <a href="${booking.sessionLink}" target="_blank">${booking.sessionLink}</a></p>` : ''}
        </div>`;
    }
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    detailsHTML += `
    <div class="info-box">
        <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:</h4>
        <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²:</strong> ${booking.bookingNumber || ''}</p>
        <p><strong>Ù…Ø¹Ø±Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${booking.assessmentId || ''}</p>
        <p><strong>Ø§Ù„Ù…ØµØ¯Ø±:</strong> ${booking.source || ''}</p>
        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="status-badge ${booking.status || 'pending'}">${getStatusName(booking.status)}</span></p>
    </div>`;
    
    // Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
    detailsHTML += `
    <div class="info-box">
        <h4>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©:</h4>
        <div class="actions-cell" style="margin-top: 10px;">
            ${generateActions(booking)}
        </div>
    </div>`;
    
    document.getElementById('bookingDetailsContent').innerHTML = detailsHTML;
    openModal('detailsModal');
}


// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© getChallengeDisplayName Ù„ØªØ´Ù…Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
function getChallengeDisplayName(challengeType) {
    const types = {
        'work': 'ØªØ­Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„',
        'relationships': 'ØªØ­Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª',
        'self': 'ØªØ­Ø¯ÙŠ Ù…Ø¹ Ø§Ù„Ø°Ø§Øª',
        'decision': 'Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…Ù‡Ù…',
        'emptiness': 'Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„ÙØ±Ø§Øº',
        'patterns': 'Ø£Ù†Ù…Ø§Ø· Ù…ØªÙƒØ±Ø±Ø©',
        'passion': 'ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø´ØºÙ',
        'misplaced': 'Ø¹Ø¯Ù… Ø§Ù„Ø§Ù†ØªÙ…Ø§Ø¡',
        'clear-vision': 'Ø±Ø¤ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ØªØ­ØªØ§Ø¬ ØªÙ†ÙÙŠØ°',
        'need-change': 'Ø­Ø§Ø¬Ø© Ù„ØªØºÙŠÙŠØ± Ø¬Ø°Ø±ÙŠ',
        'awakening': 'ÙŠÙ‚Ø¸Ø© Ø±ÙˆØ­ÙŠØ©',
        'enough': 'ÙˆØµÙˆÙ„ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ­ÙˆÙ„'
    };
    return types[challengeType] || challengeType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
}


// Export to Excel
function exportToExcel() {
let csv = '\ufeff'; // UTF-8 BOM
// Headers
const headers = [
'Ø§Ù„ØªØ§Ø±ÙŠØ®',
'Ø§Ù„Ø§Ø³Ù…',
'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
'Ø§Ù„Ù‡Ø§ØªÙ',
'Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ',
'Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©',
'Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§',
'Ø§Ù„ØªØ·Ø§Ø¨Ù‚',
'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ù„Ø­Ø§Ø­',
'Ø§Ù„Ø­Ø§Ù„Ø©',
'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª'
];
csv += headers.join(',') + '\n';
// Data
filteredBookings.forEach(booking => {
const row = [
formatDate(booking.createdAt),
booking.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
booking.email,
booking.phone,
getChallengeDisplayName(booking.challengeType),
getJourneyDisplayName(booking.journeyType),
getJourneyDisplayName(booking.recommendedJourney),
booking.matchedRecommendation ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
booking.urgencyLevel || '-',
getStatusName(booking.status),
(booking.notes || '').replace(/,/g, ';').replace(/\n/g, ' ')
];
csv += row.map(cell => `"${cell}"`).join(',') + '\n';
});
// Download
const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
const link = document.createElement('a');
const url = URL.createObjectURL(blob);
link.setAttribute('href', url);
link.setAttribute('download', `Ø­Ø¬ÙˆØ²Ø§Øª_${new Date().toLocaleDateString('en-GB').replace(/\//g, '-')}.csv`);
link.style.visibility = 'hidden';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
}



</script>
</body>
</html>
