<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© - Ù…Ø­Ù…ÙˆØ¯ ÙØ¤Ø§Ø¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2C5530;
            --secondary: #8B9467;
            --accent: #D4AF37;
            --light: #F5F2E8;
            --dark: #1A1A1A;
            --gradient: linear-gradient(135deg, #2C5530 0%, #8B9467 100%);
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --shadow: 0 5px 20px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
            
            /* Program Colors */
            --clarity-color: #3498db;
            --discovery-color: #e74c3c;
            --transformation-color: #f39c12;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: #f0f2f5;
            color: var(--dark);
            min-height: 100vh;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Navigation */
        .admin-nav {
            background: white;
            box-shadow: var(--shadow);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand h2 {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-links a.active {
            color: var(--primary);
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent);
        }

        /* Main Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        /* Date Range Selector */
        .date-range {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: white;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            width: fit-content;
            margin-top: 1rem;
        }

        .date-range select {
            padding: 0.5rem 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: var(--gradient);
            opacity: 0.1;
            border-radius: 50%;
            transform: translate(20px, -20px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: rgba(44, 85, 48, 0.1);
            color: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.85rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
        }

        .trend-up {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .trend-down {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .stat-footer {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
            font-size: 0.85rem;
            color: #999;
        }

        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }

        /* Live Activity Feed */
        .activity-section {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        .activity-filters {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.4rem 0.8rem;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: white;
            border-color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .activity-feed {
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .activity-item:hover {
            background: #f8f9fa;
            transform: translateX(-5px);
        }

        .activity-avatar {
            width: 45px;
            height: 45px;
            background: var(--gradient);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.25rem;
        }

        .activity-title {
            font-weight: 600;
            color: var(--dark);
        }

        .activity-time {
            font-size: 0.8rem;
            color: #999;
        }

        .activity-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .activity-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .activity-action {
            font-size: 0.85rem;
            color: var(--primary);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .activity-action:hover {
            background: rgba(44, 85, 48, 0.1);
        }

        /* Alerts Panel */
        .alerts-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .alert-card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }

        .alert-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #fff3cd;
            border-radius: 10px;
            border-right: 4px solid var(--warning);
        }

        .alert-item.danger {
            background: #f8d7da;
            border-color: var(--danger);
        }

        .alert-item.info {
            background: #d1ecf1;
            border-color: var(--info);
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }

        .alert-desc {
            font-size: 0.85rem;
            color: #666;
        }

        .alert-action {
            padding: 0.4rem 0.8rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .alert-action:hover {
            background: var(--secondary);
        }

        /* Journeys Kanban */
        .journeys-section {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
            background: #f0f0f0;
            padding: 0.25rem;
            border-radius: 8px;
            width: fit-content;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .view-btn.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .kanban-column {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1rem;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: white;
            border-radius: 8px;
        }

        .column-title {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .column-count {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .kanban-cards {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            min-height: 200px;
        }

        .journey-card {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .journey-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .journey-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--clarity-color);
            border-radius: 0 10px 10px 0;
        }

        .journey-card.discovery::before {
            background: var(--discovery-color);
        }

        .journey-card.transformation::before {
            background: var(--transformation-color);
        }

        .journey-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .client-name {
            font-weight: 600;
            color: var(--dark);
        }

        .journey-phase {
            font-size: 0.8rem;
            color: #666;
            background: #f0f0f0;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
        }

        .journey-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: #666;
        }

        .journey-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Progress Overview */
        .progress-section {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .progress-card {
            text-align: center;
        }

        .circular-progress {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 1rem;
        }

        .circular-progress svg {
            transform: rotate(-90deg);
        }

        .progress-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .progress-label {
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .progress-desc {
            font-size: 0.9rem;
            color: #666;
        }

        /* Quick Actions FAB */
        .fab-container {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            z-index: 100;
        }

        .fab {
            width: 60px;
            height: 60px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s;
            position: relative;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .fab-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            padding: 0.5rem;
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s;
        }

        .fab-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .fab-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--dark);
        }

        .fab-item:hover {
            background: #f8f9fa;
            color: var(--primary);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s;
            max-width: 400px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-right: 4px solid var(--success);
        }

        .notification.error {
            border-right: 4px solid var(--danger);
        }

        .notification-icon {
            font-size: 1.5rem;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .notification-message {
            font-size: 0.9rem;
            color: #666;
        }

        .notification-close {
            background: none;
            border: none;
            cursor: pointer;
            color: #999;
            font-size: 1.2rem;
            padding: 0.25rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .alerts-panel {
                order: -1;
                flex-direction: row;
                overflow-x: auto;
            }

            .alert-card {
                min-width: 300px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .kanban-board {
                grid-template-columns: 1fr;
            }

            .nav-links {
                gap: 1rem;
                font-size: 0.9rem;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .fab-container {
                bottom: 1rem;
                left: 1rem;
            }
        }

        /* Loading States */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 16px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .skeleton-card {
            height: 120px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Navigation -->
    <nav class="admin-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø­Ù…ÙˆØ¯ ÙØ¤Ø§Ø¯</h2>
            </div>
            <div class="nav-links">
                <a href="admin-dashboard.html">
                    <span>ğŸ </span>
                    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                                    </a>
                <a href="admin-bookings.html">
                    <span>ğŸ“…</span>
                    <span>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span>
                </a>
                <a href="central-dashboard.html" class="active">
                    <span>ğŸš€</span>
                    <span>Ø§Ù„Ø±Ø­Ù„Ø§Øª</span>
                </a>
                <a href="admin-tools.html">
                    <span>ğŸ› ï¸</span>
                    <span>Ø§Ù„Ø£Ø¯ÙˆØ§Øª</span>

                </a>
                <a href="#" onclick="logout()">
                    <span>ğŸšª</span>
                    <span>Ø®Ø±ÙˆØ¬</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h1>
            <p class="page-subtitle">Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø­Ù„Ø§Øª ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø©</p>
            <div class="date-range">
                <span>ğŸ“Š</span>
                <select id="dateRange" onchange="updateDateRange()">
                    <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
                    <option value="week" selected>Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                    <option value="month">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
                    <option value="quarter">Ø¢Ø®Ø± 3 Ø´Ù‡ÙˆØ±</option>
                </select>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸš€</div>
                    <div class="stat-trend trend-up">
                        <span>â†‘</span>
                        <span>12%</span>
                    </div>
                </div>
                <div class="stat-value" id="activeJourneysCount">15</div>
                <div class="stat-label">Ø±Ø­Ù„Ø© Ù†Ø´Ø·Ø©</div>
                <div class="stat-footer">
                    <span>3 Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ“…</div>
                    <div class="stat-trend trend-up">
                        <span>â†‘</span>
                        <span>8%</span>
                    </div>
                </div>
                <div class="stat-value" id="upcomingSessionsCount">24</div>
                <div class="stat-label">Ø¬Ù„Ø³Ø© Ù‚Ø§Ø¯Ù…Ø©</div>
                <div class="stat-footer">
                    <span>5 Ø¬Ù„Ø³Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ“ˆ</div>
                    <div class="stat-trend trend-up">
                        <span>â†‘</span>
                        <span>15%</span>
                    </div>
                </div>
                <div class="stat-value" id="avgEngagement">87%</div>
                <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</div>
                <div class="stat-footer">
                    <span>Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">âš¡</div>
                    <div class="stat-trend trend-down">
                        <span>â†“</span>
                        <span>5%</span>
                    </div>
                </div>
                <div class="stat-value" id="practicesCompletion">92%</div>
                <div class="stat-label">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª</div>
                <div class="stat-footer">
                    <span>ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</span>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Live Activity Feed -->
            <div class="activity-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <span class="live-indicator"></span>
                        <span>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</span>
                    </h3>
                    <div class="activity-filters">
                        <button class="filter-btn active" onclick="filterActivity('all')">Ø§Ù„ÙƒÙ„</button>
                        <button class="filter-btn" onclick="filterActivity('sessions')">Ø¬Ù„Ø³Ø§Øª</button>
                        <button class="filter-btn" onclick="filterActivity('practices')">Ù…Ù…Ø§Ø±Ø³Ø§Øª</button>
                        <button class="filter-btn" onclick="filterActivity('messages')">Ø±Ø³Ø§Ø¦Ù„</button>
                    </div>
                </div>
                <div class="activity-feed" id="activityFeed">
                    <!-- Activity items will be loaded here -->
                </div>
            </div>

            <!-- Alerts Panel -->
            <div class="alerts-panel">
                <!-- Smart Alerts -->
                <div class="alert-card">
                    <div class="section-header">
                        <h3 class="section-title">
                            <span>âš ï¸</span>
                            <span>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø°ÙƒÙŠØ©</span>
                        </h3>
                    </div>
                    <div class="alert-list" id="alertsList">
                        <!-- Alerts will be loaded here -->
                    </div>
                </div>

                <!-- Upcoming Sessions -->
                <div class="alert-card">
                    <div class="section-header">
                        <h3 class="section-title">
                            <span>ğŸ“…</span>
                            <span>Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>
                        </h3>
                    </div>
                    <div id="upcomingSessions">
                        <!-- Sessions will be loaded here -->
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="alert-card">
                    <div class="section-header">
                        <h3 class="section-title">
                            <span>ğŸ“Š</span>
                            <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</span>
                        </h3>
                    </div>
                    <div id="quickStats">
                        <!-- Quick stats will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Journeys Kanban -->
        <div class="journeys-section">
            <div class="section-header">
                <h3 class="section-title">
                    <span>ğŸ¯</span>
                    <span>Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</span>
                </h3>
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('kanban')">ÙƒØ§Ù†Ø¨Ø§Ù†</button>
                    <button class="view-btn" onclick="switchView('table')">Ø¬Ø¯ÙˆÙ„</button>
                    <button class="view-btn" onclick="switchView('calendar')">ØªÙ‚ÙˆÙŠÙ…</button>
                </div>
            </div>
            <div class="kanban-board" id="kanbanBoard">
                <!-- Kanban columns will be loaded here -->
            </div>
        </div>

        <!-- Progress Overview -->
        <div class="progress-section">
            <div class="section-header">
                <h3 class="section-title">
                    <span>ğŸ“ˆ</span>
                    <span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                </h3>
            </div>
            <div class="progress-grid">
                <div class="progress-card">
                    <div class="circular-progress">
                        <svg width="150" height="150">
                            <circle cx="75" cy="75" r="65" fill="none" stroke="#e9ecef" stroke-width="15"/>
                            <circle cx="75" cy="75" r="65" fill="none" stroke="#2C5530" stroke-width="15"
                                    stroke-dasharray="408" stroke-dashoffset="102" stroke-linecap="round"/>
                        </svg>
                        <div class="progress-value">75%</div>
                    </div>
                    <h4 class="progress-label">Ù…Ø¹Ø¯Ù„ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</h4>
                    <p class="progress-desc">12 Ù…Ù† 16 Ø¹Ù…ÙŠÙ„ Ø£ÙƒÙ…Ù„ÙˆØ§ Ù…Ø±Ø­Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</p>
                </div>

                <div class="progress-card">
                    <div class="circular-progress">
                        <svg width="150" height="150">
                            <circle cx="75" cy="75" r="65" fill="none" stroke="#e9ecef" stroke-width="15"/>
                            <circle cx="75" cy="75" r="65" fill="none" stroke="#f39c12" stroke-width="15"
                                    stroke-dasharray="408" stroke-dashoffset="163" stroke-linecap="round"/>
                        </svg>
                        <div class="progress-value">60%</div>
                    </div>
                    <h4 class="progress-label">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª</h4>
                    <p class="progress-desc">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©</p>
                </div>

                <div class="progress-card">
                    <div class="circular-progress">
                        <svg width="150" height="150">
                            <circle cx="75" cy="75" r="65" fill="none" stroke="#e9ecef" stroke-width="15"/>
                            <circle cx="75" cy="75" r="65" fill="none" stroke="#e74c3c" stroke-width="15"
                                    stroke-dasharray="408" stroke-dashoffset="41" stroke-linecap="round"/>
                        </svg>
                        <div class="progress-value">90%</div>
                    </div>
                    <h4 class="progress-label">Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h4>
                    <p class="progress-desc">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„ØªÙØ§Ø¹Ù„</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab" onclick="toggleFabMenu()">
            <span>âš¡</span>
        </button>
        <div class="fab-menu" id="fabMenu">
            <div class="fab-item" onclick="quickAction('broadcast')">
                <span>ğŸ“¢</span>
                <span>Ø±Ø³Ø§Ù„Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©</span>
            </div>
            <div class="fab-item" onclick="quickAction('report')">
                <span>ğŸ“Š</span>
                <span>ØªÙ‚Ø±ÙŠØ± Ø³Ø±ÙŠØ¹</span>
            </div>
            <div class="fab-item" onclick="quickAction('challenge')">
                <span>ğŸ¯</span>
                <span>ØªØ­Ø¯ÙŠ Ø¬Ù…Ø§Ø¹ÙŠ</span>
            </div>
            <div class="fab-item" onclick="quickAction('meeting')">
                <span>ğŸ‘¥</span>
                <span>Ø¬Ù„Ø³Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©</span>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
        // Initialize Firebase
        const auth = firebase.auth();
        const db = firebase.firestore();

        // State
        let journeys = [];
        let activities = [];
        let alerts = [];
        let currentFilter = 'all';
        let currentView = 'kanban';
        let dateRange = 'week';

        // Initialize
document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    ensureSampleData().then(() => {
        loadDashboardData();
        setupRealtimeUpdates();
        startActivitySimulation();
    });
});
        // Check authentication
        function checkAuth() {
            const authToken = sessionStorage.getItem('adminAuth');
            if (!authToken) {
                window.location.href = 'admin-dashboard.html';
                return;
            }
        }
// Create sample data if none exists
async function ensureSampleData() {
    try {
        const snapshot = await db.collection('journeys')
            .where('status', '==', 'active')
            .limit(1)
            .get();
        
        if (snapshot.empty) {
            // Create sample journey
            await db.collection('journeys').add({
                clientName: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯',
                clientEmail: 'mohamed@email.com',
                clientPhone: '01234567890',
                program: 'discovery',
                status: 'active',
                currentPhase: 2,
                progress: 65,
                completedSessions: 2,
                totalSessions: 3,
                engagementScore: 85,
                assignedTools: [],
                startDate: firebase.firestore.FieldValue.serverTimestamp(),
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            console.log('Sample journey created');
        }
    } catch (error) {
        console.error('Error creating sample data:', error);
    }
}
// Load dashboard data
async function loadDashboardData() {
    showLoading(true);
    try {
        // Load journeys first
        await loadJourneys();
        
        // Then load other data
        await Promise.all([
            loadStats(),
            loadActivities(),
            loadAlerts(),
            loadUpcomingSessions(),
            loadRealData() // ğŸ†• Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
        ]);
        
        // Initialize charts if needed
        if (typeof Chart !== 'undefined') {
            setTimeout(initializeCharts, 100);
        }
        
    } catch (error) {
        console.error('Error loading dashboard:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
    } finally {
        showLoading(false);
    }
}
// Load journeys
async function loadJourneys() {
    try {
        const snapshot = await db.collection('journeys')
            .where('status', '==', 'active')
            .get();

        journeys = [];
        snapshot.forEach(doc => {
            journeys.push({
                id: doc.id,
                ...doc.data()
            });
        });

        // Update UI
        document.getElementById('activeJourneysCount').textContent = journeys.length;
        updateKanbanBoard();
        updateStats();
        
    } catch (error) {
        console.error('Error loading journeys:', error);
        // Don't show error notification here, handled by loadDashboardData
    }
}
        // Load stats
// Load stats
async function loadStats() {
    try {
        // Get active journeys count
        document.getElementById('activeJourneysCount').textContent = journeys.length;
        
        // Get upcoming sessions
        const upcomingSnapshot = await db.collection('bookings')
            .where('status', '==', 'pending')
            .get();
        document.getElementById('upcomingSessionsCount').textContent = upcomingSnapshot.size;

        // Calculate other stats
        if (journeys.length === 0) {
            document.getElementById('avgEngagement').textContent = '0%';
            document.getElementById('practicesCompletion').textContent = '0%';
            return;
        }

        let totalEngagement = 0;
        let totalPractices = 0;
        let completedPractices = 0;

        journeys.forEach(journey => {
            totalEngagement += journey.engagementScore || 85;
            
            if (journey.assignedTools) {
                journey.assignedTools.forEach(tool => {
                    totalPractices += 7; // Weekly practices
                    completedPractices += tool.completedCount || 5;
                });
            }
        });

        // Update UI
        const avgEngagement = Math.round(totalEngagement / journeys.length);
        document.getElementById('avgEngagement').textContent = avgEngagement + '%';

        const practicesRate = totalPractices > 0 ? 
            Math.round((completedPractices / totalPractices) * 100) : 92; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© 92%
        document.getElementById('practicesCompletion').textContent = practicesRate + '%';
        
    } catch (error) {
        console.error('Error loading stats:', error);
        // Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        document.getElementById('avgEngagement').textContent = '0%';
        document.getElementById('practicesCompletion').textContent = '0%';
        document.getElementById('upcomingSessionsCount').textContent = '0';
    }
}
        
        // Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¹Ø¯ Ø¯Ø§Ù„Ø© loadStats
function updateStats() {
    // Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ loadStats Ù„ÙƒÙ† Ø¨Ø¯ÙˆÙ† async/await
    if (journeys.length === 0) {
        document.getElementById('avgEngagement').textContent = '0%';
        document.getElementById('practicesCompletion').textContent = '0%';
        return;
    }

    let totalEngagement = 0;
    let totalPractices = 0;
    let completedPractices = 0;

    journeys.forEach(journey => {
        totalEngagement += journey.engagementScore || 85;
        
        if (journey.assignedTools) {
            journey.assignedTools.forEach(tool => {
                totalPractices += 7; // Weekly practices
                completedPractices += tool.completedCount || 5;
            });
        }
    });

    // Update UI
    const avgEngagement = journeys.length > 0 ? 
        Math.round(totalEngagement / journeys.length) : 0;
    document.getElementById('avgEngagement').textContent = avgEngagement + '%';

    const practicesRate = totalPractices > 0 ? 
        Math.round((completedPractices / totalPractices) * 100) : 0;
    document.getElementById('practicesCompletion').textContent = practicesRate + '%';
}

        // Load activities
        async function loadActivities() {
            const feed = document.getElementById('activityFeed');
            
            // Mock activities for demo
            activities = [
                {
                    type: 'practice',
                    client: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    action: 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ø«Ù„Ø« Ø§Ù„Ù‚Ù„Ø¨ÙŠ',
                    time: 'Ø§Ù„Ø¢Ù†',
                    avatar: 'Ø£'
                },
                {
                    type: 'session',
                    client: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯',
                    action: 'Ø¨Ø¯Ø£Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
                    time: 'Ù…Ù†Ø° 15 Ø¯Ù‚ÙŠÙ‚Ø©',
                    avatar: 'Ø³'
                },
                {
                    type: 'message',
                    client: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    action: 'Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                    time: 'Ù…Ù†Ø° 30 Ø¯Ù‚ÙŠÙ‚Ø©',
                    avatar: 'Ù…'
                },
                {
                    type: 'practice',
                    client: 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†',
                    action: 'Ù„Ù… ØªÙƒÙ…Ù„ Ø¯ÙØªØ± Ø§Ù„Ø§Ù…ØªÙ†Ø§Ù†',
                    time: 'Ù…Ù†Ø° Ø³Ø§Ø¹Ø©',
                    avatar: 'Ù',
                    needsAttention: true
                }
            ];

            displayActivities();
        }

        // Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙÙŠ central-dashboard.html Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø§Ù„Ø¢Ù†ØŒ Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø©
async function loadRealData() {
    try {
        // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        const upcomingBookings = await db.collection('bookings')
            .where('status', '==', 'pending')
            .orderBy('appointmentDate', 'asc')
            .limit(5)
            .get();

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
        const upcomingContainer = document.getElementById('upcomingSessions');
        let upcomingHTML = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
        
        if (!upcomingBookings.empty) {
            upcomingBookings.forEach(doc => {
                const booking = doc.data();
                const date = booking.appointmentDate?.toDate ? 
                    booking.appointmentDate.toDate() : new Date(booking.appointmentDate);
                
                upcomingHTML += `
                    <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <strong>${booking.name}</strong>
                            <span style="color: #666; font-size: 0.9rem;">${formatTime(date)}</span>
                        </div>
                        <div style="font-size: 0.85rem; color: #666;">
                            ${getProgramName(booking.program)} - ${booking.sessionType === 'online' ? 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†' : 'Ø­Ø¶ÙˆØ±ÙŠ'}
                        </div>
                    </div>
                `;
            });
        } else {
            upcomingHTML += '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù‚Ø§Ø¯Ù…Ø©</p>';
        }
        
        upcomingHTML += '</div>';
        upcomingContainer.innerHTML = upcomingHTML;

        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        const recentMessages = await db.collection('messages')
            .orderBy('timestamp', 'desc')
            .limit(10)
            .get();

        const realActivities = [];
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
        recentMessages.forEach(doc => {
            const message = doc.data();
            const journey = journeys.find(j => j.id === message.journeyId);
            if (journey) {
                realActivities.push({
                    type: 'message',
                    client: journey.clientName,
                    action: 'Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                    time: getRelativeTime(message.timestamp),
                    avatar: journey.clientName.charAt(0)
                });
            }
        });

        // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        const realAlerts = [];
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
        journeys.forEach(journey => {
            const lastActivity = journey.lastUpdated?.toDate ? journey.lastUpdated.toDate() : new Date();
            const daysSinceActivity = Math.floor((new Date() - lastActivity) / (1000 * 60 * 60 * 24));
            
            if (daysSinceActivity > 3) {
                realAlerts.push({
                    type: 'warning',
                    icon: 'âš ï¸',
                    title: 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù†Ø´Ø·',
                    desc: `${journey.clientName} Ù„Ù… ÙŠØªÙØ§Ø¹Ù„ Ù…Ù†Ø° ${daysSinceActivity} Ø£ÙŠØ§Ù…`,
                    action: 'Ù…ØªØ§Ø¨Ø¹Ø©',
                    onClick: () => window.location.href = `admin-journey-management.html?journey=${journey.id}`
                });
            }
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
            if (journey.completedSessions === 0 && journey.totalSessions > 0) {
                realAlerts.push({
                    type: 'info',
                    icon: 'ğŸ“…',
                    title: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                    desc: `${journey.clientName} Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙ‡ Ø¨Ø¹Ø¯`,
                    action: 'Ø¬Ø¯ÙˆÙ„Ø©',
                    onClick: () => window.location.href = `admin-journey-management.html?journey=${journey.id}&tab=sessions`
                });
            }
        });

        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        if (realAlerts.length > 0) {
            displayRealAlerts(realAlerts);
        }

        // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
        if (realActivities.length > 0) {
            activities = realActivities;
            displayActivities();
        }

    } catch (error) {
        console.error('Error loading real data:', error);
    }
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
function displayRealAlerts(alerts) {
    const alertsList = document.getElementById('alertsList');
    let html = '';
    
    alerts.forEach(alert => {
        html += `
            <div class="alert-item ${alert.type}">
                <div class="alert-icon">${alert.icon}</div>
                <div class="alert-content">
                    <div class="alert-title">${alert.title}</div>
                    <div class="alert-desc">${alert.desc}</div>
                </div>
                <button class="alert-action" onclick="${alert.onClick}">${alert.action}</button>
            </div>
        `;
    });
    
    alertsList.innerHTML = html;
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ÙˆÙ‚Øª Ø§Ù„Ù†Ø³Ø¨ÙŠ
function getRelativeTime(timestamp) {
    if (!timestamp) return 'Ø§Ù„Ø¢Ù†';
    
    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
    const now = new Date();
    const diff = now - date;
    
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);
    
    if (minutes < 1) return 'Ø§Ù„Ø¢Ù†';
    if (minutes < 60) return `Ù…Ù†Ø° ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
    if (hours < 24) return `Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©`;
    return `Ù…Ù†Ø° ${days} ÙŠÙˆÙ…`;
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
function formatTime(date) {
    return date.toLocaleString('ar-EG', {
        weekday: 'long',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}
        
        // Display activities
        function displayActivities(filter = 'all') {
            const feed = document.getElementById('activityFeed');
            
            const filteredActivities = filter === 'all' ? activities : 
                activities.filter(a => a.type === filter.slice(0, -1));

            let html = '';
            filteredActivities.forEach(activity => {
                html += `
                    <div class="activity-item" onclick="openJourney('${activity.client}')">
                        <div class="activity-avatar">${activity.avatar}</div>
                        <div class="activity-content">
                            <div class="activity-header">
                                <div class="activity-title">${activity.client}</div>
                                <div class="activity-time">${activity.time}</div>
                            </div>
                            <div class="activity-description">${activity.action}</div>
                            ${activity.needsAttention ? `
                                <div class="activity-actions">
                                    <span class="activity-action" onclick="sendReminder(event, '${activity.client}')">Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ±</span>
                                    <span class="activity-action" onclick="viewDetails(event, '${activity.client}')">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            feed.innerHTML = html || '<p style="text-align: center; color: #999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø· Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
        }

        // Load alerts
        function loadAlerts() {
            const alertsList = document.getElementById('alertsList');
            
            // Generate smart alerts based on data
            alerts = [
                {
                    type: 'danger',
                    icon: 'ğŸš¨',
                    title: 'Ø§Ù†Ø®ÙØ§Ø¶ Ù…Ø´Ø§Ø±ÙƒØ©',
                    desc: '3 Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù… ÙŠØªÙØ§Ø¹Ù„ÙˆØ§ Ù…Ù†Ø° 3 Ø£ÙŠØ§Ù…',
                    action: 'Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©'
                },
                {
                    type: 'warning',
                    icon: 'âš ï¸',
                    title: 'Ø¬Ù„Ø³Ø§Øª ÙØ§Ø¦ØªØ©',
                    desc: 'Ø¹Ù…ÙŠÙ„ ÙˆØ§Ø­Ø¯ Ù„Ù… ÙŠØ­Ø¶Ø± Ø¢Ø®Ø± Ø¬Ù„Ø³Ø©',
                    action: 'Ù…ØªØ§Ø¨Ø¹Ø©'
                },
                {
                    type: 'info',
                    icon: 'ğŸ’¡',
                    title: 'ÙØ±ØµØ© Ù„Ù„ØªÙ‚Ø¯Ù…',
                    desc: '5 Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø§Ù‡Ø²ÙˆÙ† Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©',
                    action: 'Ø¹Ø±Ø¶'
                }
            ];

            let html = '';
            alerts.forEach(alert => {
                html += `
                    <div class="alert-item ${alert.type}">
                        <div class="alert-icon">${alert.icon}</div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-desc">${alert.desc}</div>
                        </div>
                        <button class="alert-action" onclick="handleAlert('${alert.type}')">${alert.action}</button>
                    </div>
                `;
            });

            alertsList.innerHTML = html;
        }

        // Load upcoming sessions
        async function loadUpcomingSessions() {
            const container = document.getElementById('upcomingSessions');
            
            // Mock data for demo
            const sessions = [
                {
                    client: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    time: '5:00 Ù…',
                    type: 'online',
                    phase: 'Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©'
                },
                {
                    client: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯',
                    time: '7:00 Ù…',
                    type: 'online',
                    phase: 'Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰'
                }
            ];

            let html = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
            sessions.forEach(session => {
                html += `
                    <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; cursor: pointer;"
                         onclick="openJourney('${session.client}')">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <strong>${session.client}</strong>
                            <span style="color: #666; font-size: 0.9rem;">${session.time}</span>
                        </div>
                        <div style="font-size: 0.85rem; color: #666;">
                            ${session.phase} - ${session.type === 'online' ? 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†' : 'Ø­Ø¶ÙˆØ±ÙŠ'}
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // Update Kanban board
        function updateKanbanBoard() {
            const board = document.getElementById('kanbanBoard');
            
            if (currentView !== 'kanban') {
                // Implement other views
                return;
            }

            // Group journeys by program
            const grouped = {
                clarity: [],
                discovery: [],
                transformation: []
            };

            journeys.forEach(journey => {
                if (grouped[journey.program]) {
                    grouped[journey.program].push(journey);
                }
            });

            let html = '';
            
            // Clarity column
            html += `
                <div class="kanban-column">
                    <div class="column-header">
                        <div class="column-title">
                            <span style="color: var(--clarity-color);">â—</span>
                            <span>Ø¬Ù„Ø³Ø© Ø§Ù„ÙˆØ¶ÙˆØ­</span>
                        </div>
                        <span class="column-count">${grouped.clarity.length}</span>
                    </div>
                    <div class="kanban-cards">
                        ${grouped.clarity.map(j => createJourneyCard(j, 'clarity')).join('')}
                    </div>
                </div>
            `;

            // Discovery column
            html += `
                <div class="kanban-column">
                    <div class="column-header">
                        <div class="column-title">
                            <span style="color: var(--discovery-color);">â—</span>
                            <span>Ø±Ø­Ù„Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</span>
                        </div>
                        <span class="column-count">${grouped.discovery.length}</span>
                    </div>
                    <div class="kanban-cards">
                        ${grouped.discovery.map(j => createJourneyCard(j, 'discovery')).join('')}
                    </div>
                </div>
            `;

            // Transformation column
            html += `
                <div class="kanban-column">
                    <div class="column-header">
                        <div class="column-title">
                            <span style="color: var(--transformation-color);">â—</span>
                            <span>Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­ÙˆÙ„</span>
                        </div>
                        <span class="column-count">${grouped.transformation.length}</span>
                    </div>
                    <div class="kanban-cards">
                        ${grouped.transformation.map(j => createJourneyCard(j, 'transformation')).join('')}
                    </div>
                </div>
            `;

            board.innerHTML = html;
        }

        // Create journey card
        function createJourneyCard(journey, type) {
            const phase = journey.currentPhase || 1;
            const totalPhases = getProgramPhases(journey.program);
            
            return `
                <div class="journey-card ${type}" onclick="openJourneyDetails('${journey.id}')">
                    <div class="journey-header">
                        <div class="client-name">${journey.clientName}</div>
                        <div class="journey-phase">Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${phase}/${totalPhases}</div>
                    </div>
                    <div class="journey-stats">
                        <div class="journey-stat">
                            <span>ğŸ“…</span>
                            <span>${journey.completedSessions || 0} Ø¬Ù„Ø³Ø©</span>
                        </div>
                        <div class="journey-stat">
                            <span>ğŸ“ˆ</span>
                            <span>${journey.progress || 0}%</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Activity filter
        function filterActivity(type) {
            currentFilter = type;
            
            // Update button states
            document.querySelectorAll('.activity-filters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayActivities(type);
        }

        // Switch view
        function switchView(view) {
            currentView = view;
            
            // Update button states
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateKanbanBoard();
        }

        // Date range update
        function updateDateRange() {
            dateRange = document.getElementById('dateRange').value;
            loadDashboardData();
        }

        // Open journey details
        function openJourneyDetails(journeyId) {
            window.location.href = `admin-journey-management.html?journey=${journeyId}`;
        }

// Open journey by client name
function openJourney(clientName) {
    event.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    event.stopPropagation(); // Ù…Ù†Ø¹ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø­Ø¯Ø«
    
    const journey = journeys.find(j => j.clientName === clientName);
    if (journey) {
        openJourneyDetails(journey.id);
    } else {
        showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø­Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'warning');
    }
}

        // Send reminder
        function sendReminder(event, clientName) {
            event.stopPropagation();
            showNotification(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ± Ù„Ù€ ${clientName}`, 'success');
        }

        // View details
        function viewDetails(event, clientName) {
            event.stopPropagation();
            openJourney(clientName);
        }

        // Handle alert
        function handleAlert(type) {
            switch(type) {
                case 'danger':
                    // Show list of inactive clients
                    showNotification('Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†', 'info');
                    break;
                case 'warning':
                    // Show missed sessions
                    showNotification('Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„ÙØ§Ø¦ØªØ©', 'info');
                    break;
                case 'info':
                    // Show clients ready for next phase
                    showNotification('Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠÙ† Ù„Ù„ØªÙ‚Ø¯Ù…', 'info');
                    break;
            }
        }

        // FAB menu toggle
        function toggleFabMenu() {
            document.getElementById('fabMenu').classList.toggle('show');
        }

        // Quick actions
        function quickAction(action) {
            toggleFabMenu();
            
            switch(action) {
                case 'broadcast':
                    showBroadcastModal();
                    break;
                case 'report':
                    generateQuickReport();
                    break;
                case 'challenge':
                    createGroupChallenge();
                    break;
                case 'meeting':
                    scheduleGroupMeeting();
                    break;
            }
        }

        // Show broadcast modal
        function showBroadcastModal() {
            showNotification('Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© - Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
        }

        // Generate quick report
        function generateQuickReport() {
            showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...', 'info');
            // Here you would generate and download a report
        }

        // Create group challenge
        function createGroupChallenge() {
            showNotification('Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ø¯ÙŠ Ø¬Ù…Ø§Ø¹ÙŠ - Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
        }

        // Schedule group meeting
        function scheduleGroupMeeting() {
            showNotification('Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ù„Ø³Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© - Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
        }

        // Setup realtime updates
// Ø£Ø¶Ù Ù‡Ø°Ø§ ÙÙŠ setupRealtimeUpdates
function setupRealtimeUpdates() {
    // Listen for journey updates
    db.collection('journeys')
        .where('status', '==', 'active')
        .onSnapshot(snapshot => {
            loadDashboardData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø£ÙŠ ØªØºÙŠÙŠØ±
        });
    
    // Listen for new bookings
    db.collection('bookings')
        .where('status', '==', 'pending')
        .onSnapshot(snapshot => {
            loadUpcomingSessions();
            document.getElementById('upcomingSessionsCount').textContent = snapshot.size;
        });
    
    // Listen for new messages
    db.collection('messages')
        .orderBy('timestamp', 'desc')
        .limit(1)
        .onSnapshot(snapshot => {
            snapshot.docChanges().forEach(change => {
                if (change.type === 'added') {
                    loadRealData(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                }
            });
        });
}

        // Activity simulation for demo
        function startActivitySimulation() {
            // Simulate new activities every 30 seconds
            setInterval(() => {
                const newActivity = generateRandomActivity();
                activities.unshift(newActivity);
                if (activities.length > 10) activities.pop();
                displayActivities(currentFilter);
                
                // Show notification for important activities
                if (newActivity.needsAttention) {
                    showNotification(`${newActivity.client}: ${newActivity.action}`, 'warning');
                }
            }, 30000);
        }

        // Generate random activity
        function generateRandomActivity() {
            const clients = ['Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†', 'Ø®Ø§Ù„Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…'];
            const actions = {
                practice: ['Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ø«Ù„Ø« Ø§Ù„Ù‚Ù„Ø¨ÙŠ', 'Ù…Ø§Ø±Ø³ Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„ØµØ¨Ø§Ø­ÙŠ', 'Ø³Ø¬Ù„ ÙÙŠ Ø¯ÙØªØ± Ø§Ù„Ø§Ù…ØªÙ†Ø§Ù†'],
                session: ['Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ù„Ø³Ø©', 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©', 'Ø­Ø¬Ø² Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©'],
                message: ['Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø©', 'Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„', 'Ø´Ø§Ø±Ùƒ ØªÙ‚Ø¯Ù…Ù‡']
            };
            
            const types = Object.keys(actions);
            const type = types[Math.floor(Math.random() * types.length)];
            const client = clients[Math.floor(Math.random() * clients.length)];
            const action = actions[type][Math.floor(Math.random() * actions[type].length)];
            
            return {
                type,
                client,
                action,
                time: 'Ø§Ù„Ø¢Ù†',
                avatar: client.charAt(0),
                needsAttention: Math.random() > 0.8
            };
        }

        // Utility functions
        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('show', show);
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            notification.innerHTML = `
                <span class="notification-icon">${icons[type]}</span>
                <div class="notification-content">
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                sessionStorage.clear();
                window.location.href = 'admin-dashboard.html';
            }
        }

        function getProgramPhases(program) {
            const phases = {
                clarity: 1,
                discovery: 3,
                transformation: 3
            };
            return phases[program] || 1;
        }

        // Initialize quick stats
        function initializeQuickStats() {
            const container = document.getElementById('quickStats');
            
            const stats = [
                { label: 'Ø£ÙƒØ«Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø§Ø·Ø§Ù‹', value: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', icon: 'ğŸŒŸ' },
                { label: 'Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„ Ø¥ÙƒÙ…Ø§Ù„', value: '95%', icon: 'ğŸ†' },
                { label: 'Ø£Ø·ÙˆÙ„ Ø³Ù„Ø³Ù„Ø© Ù…Ù…Ø§Ø±Ø³Ø©', value: '21 ÙŠÙˆÙ…', icon: 'ğŸ”¥' }
            ];

            let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
            stats.forEach(stat => {
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.5rem;">${stat.icon}</span>
                            <span style="color: #666; font-size: 0.9rem;">${stat.label}</span>
                        </div>
                        <strong style="color: var(--primary);">${stat.value}</strong>
                    </div>
                `;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // Initialize on load
        initializeQuickStats();

        // Handle clicks outside FAB
        document.addEventListener('click', (e) => {
            const fabContainer = document.querySelector('.fab-container');
            const fabMenu = document.getElementById('fabMenu');
            
            if (!fabContainer.contains(e.target) && fabMenu.classList.contains('show')) {
                fabMenu.classList.remove('show');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Alt + D for dashboard refresh
            if (e.altKey && e.key === 'd') {
                e.preventDefault();
                loadDashboardData();
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
            }
            
            // Alt + B for broadcast
            if (e.altKey && e.key === 'b') {
                e.preventDefault();
                showBroadcastModal();
            }
            
            // Alt + R for report
            if (e.altKey && e.key === 'r') {
                e.preventDefault();
                generateQuickReport();
            }
        });

        // Auto-refresh every 5 minutes
        setInterval(() => {
            loadDashboardData();
        }, 5 * 60 * 1000);

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth < 1200) {
                // Adjust layout for smaller screens
                currentView = 'table';
                updateKanbanBoard();
            }
        });

        // Export functions for charts
        function initializeCharts() {
            // Engagement trend chart
            const engagementCtx = document.getElementById('engagementChart');
            if (engagementCtx) {
                new Chart(engagementCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'],
                        datasets: [{
                            label: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©',
                            data: [85, 87, 83, 89, 92, 88, 87],
                            borderColor: '#2C5530',
                            backgroundColor: 'rgba(44, 85, 48, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y + '%';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Program distribution chart
            const programCtx = document.getElementById('programChart');
            if (programCtx) {
                const programCounts = {
                    clarity: journeys.filter(j => j.program === 'clarity').length,
                    discovery: journeys.filter(j => j.program === 'discovery').length,
                    transformation: journeys.filter(j => j.program === 'transformation').length
                };

                new Chart(programCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Ø¬Ù„Ø³Ø© Ø§Ù„ÙˆØ¶ÙˆØ­', 'Ø±Ø­Ù„Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù', 'Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­ÙˆÙ„'],
                        datasets: [{
                            data: [programCounts.clarity, programCounts.discovery, programCounts.transformation],
                            backgroundColor: ['#3498db', '#e74c3c', '#f39c12'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Activity heatmap
            const heatmapCtx = document.getElementById('activityHeatmap');
            if (heatmapCtx) {
                // Generate heatmap data
                const hours = Array.from({length: 24}, (_, i) => i);
                const days = ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];
                
                const heatmapData = [];
                days.forEach((day, dayIndex) => {
                    hours.forEach(hour => {
                        const intensity = Math.random() * 100;
                        heatmapData.push({
                            x: hour,
                            y: dayIndex,
                            v: Math.round(intensity)
                        });
                    });
                });

                new Chart(heatmapCtx.getContext('2d'), {
                    type: 'bubble',
                    data: {
                        datasets: [{
                            label: 'Ù†Ø´Ø§Ø· Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                            data: heatmapData,
                            backgroundColor: function(context) {
                                const value = context.parsed.v;
                                const alpha = value / 100;
                                return `rgba(44, 85, 48, ${alpha})`;
                            },
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                min: 0,
                                max: 23,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        return value + ':00';
                                    }
                                }
                            },
                            y: {
                                type: 'linear',
                                min: -0.5,
                                max: 6.5,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        return days[value] || '';
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Ø§Ù„Ù†Ø´Ø§Ø·: ${context.parsed.v}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Advanced filtering
        function advancedFilter(criteria) {
            let filtered = [...journeys];
            
            if (criteria.program) {
                filtered = filtered.filter(j => j.program === criteria.program);
            }
            
            if (criteria.engagementMin) {
                filtered = filtered.filter(j => (j.engagementScore || 0) >= criteria.engagementMin);
            }
            
            if (criteria.phase) {
                filtered = filtered.filter(j => j.currentPhase === criteria.phase);
            }
            
            return filtered;
        }

        // Bulk actions
        async function bulkAction(action, journeyIds) {
            showLoading(true);
            
            try {
                const batch = db.batch();
                
                switch(action) {
                    case 'sendMessage':
                        // Send bulk message
                        journeyIds.forEach(id => {
                            const messageRef = db.collection('messages').doc();
                            batch.set(messageRef, {
                                journeyId: id,
                                content: 'Ø±Ø³Ø§Ù„Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©',
                                sender: 'coach',
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        });
                        break;
                        
                    case 'assignTool':
                        // Assign tool to multiple journeys
                        journeyIds.forEach(id => {
                            const journeyRef = db.collection('journeys').doc(id);
                            batch.update(journeyRef, {
                                assignedTools: firebase.firestore.FieldValue.arrayUnion({
                                    toolId: 'new_tool',
                                    assignedDate: new Date()
                                })
                            });
                        });
                        break;
                        
                    case 'scheduleSession':
                        // Schedule sessions for multiple clients
                        journeyIds.forEach(id => {
                            const sessionRef = db.collection('bookings').doc();
                            batch.set(sessionRef, {
                                journeyId: id,
                                appointmentDate: new Date(),
                                status: 'scheduled'
                            });
                        });
                        break;
                }
                
                await batch.commit();
                showNotification(`ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ù„Ù‰ ${journeyIds.length} Ø±Ø­Ù„Ø©`, 'success');
                loadDashboardData();
                
            } catch (error) {
                console.error('Error in bulk action:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Export dashboard data
        function exportDashboardData(format = 'csv') {
            const data = {
                summary: {
                    totalJourneys: journeys.length,
                    avgEngagement: document.getElementById('avgEngagement').textContent,
                    upcomingSessions: document.getElementById('upcomingSessionsCount').textContent,
                    practicesCompletion: document.getElementById('practicesCompletion').textContent
                },
                journeys: journeys.map(j => ({
                    clientName: j.clientName,
                    program: getProgramName(j.program),
                    phase: j.currentPhase,
                    progress: j.progress,
                    engagement: j.engagementScore
                })),
                alerts: alerts,
                activities: activities
            };

            if (format === 'csv') {
                // Convert to CSV
                let csv = 'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„,Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬,Ø§Ù„Ù…Ø±Ø­Ù„Ø©,Ø§Ù„ØªÙ‚Ø¯Ù…,Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©\n';
                data.journeys.forEach(j => {
                    csv += `${j.clientName},${j.program},${j.phase},${j.progress}%,${j.engagement}%\n`;
                });
                
                downloadFile(csv, 'dashboard-export.csv', 'text/csv');
            } else if (format === 'json') {
                downloadFile(JSON.stringify(data, null, 2), 'dashboard-export.json', 'application/json');
            }
        }

        // Download file utility
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Smart suggestions
        function generateSuggestions() {
            const suggestions = [];
            
            // Low engagement clients
            const lowEngagement = journeys.filter(j => (j.engagementScore || 0) < 70);
            if (lowEngagement.length > 0) {
                suggestions.push({
                    type: 'engagement',
                    priority: 'high',
                    title: 'Ø¹Ù…Ù„Ø§Ø¡ ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ø§Ù‡ØªÙ…Ø§Ù… Ø®Ø§Øµ',
                    description: `${lowEngagement.length} Ø¹Ù…ÙŠÙ„ Ù„Ø¯ÙŠÙ‡Ù… Ù…Ø¹Ø¯Ù„ Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù†Ø®ÙØ¶`,
                    action: () => {
                        const ids = lowEngagement.map(j => j.id);
                        bulkAction('sendMessage', ids);
                    }
                });
            }
            
            // Ready for next phase
            const readyForNext = journeys.filter(j => {
                const phaseProgress = calculatePhaseProgress(j);
                return phaseProgress >= 80;
            });
            
            if (readyForNext.length > 0) {
                suggestions.push({
                    type: 'progress',
                    priority: 'medium',
                    title: 'Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø§Ù‡Ø²ÙˆÙ† Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©',
                    description: `${readyForNext.length} Ø¹Ù…ÙŠÙ„ Ø£ÙƒÙ…Ù„ÙˆØ§ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©`,
                    action: () => {
                        readyForNext.forEach(j => {
                            openJourneyDetails(j.id);
                        });
                    }
                });
            }
            
            // No sessions this week
            const noSessions = journeys.filter(j => {
                const lastSession = j.lastSessionDate?.toDate ? j.lastSessionDate.toDate() : null;
                if (!lastSession) return true;
                
                const daysSince = (new Date() - lastSession) / (1000 * 60 * 60 * 24);
                return daysSince > 7;
            });
            
            if (noSessions.length > 0) {
                suggestions.push({
                    type: 'sessions',
                    priority: 'high',
                    title: 'Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø¯ÙˆÙ† Ø¬Ù„Ø³Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹',
                    description: `${noSessions.length} Ø¹Ù…ÙŠÙ„ Ù„Ù… ÙŠØ­Ø¶Ø±ÙˆØ§ Ø¬Ù„Ø³Ø§Øª Ù…Ø¤Ø®Ø±Ø§Ù‹`,
                    action: () => {
                        const ids = noSessions.map(j => j.id);
                        bulkAction('scheduleSession', ids);
                    }
                });
            }
            
            return suggestions;
        }

        // Calculate phase progress
        function calculatePhaseProgress(journey) {
            const totalSessions = getTotalSessions(journey.program);
            const completedSessions = journey.completedSessions || 0;
            const currentPhase = journey.currentPhase || 1;
            const totalPhases = getProgramPhases(journey.program);
            
            const sessionsPerPhase = Math.ceil(totalSessions / totalPhases);
            const phaseStartSession = (currentPhase - 1) * sessionsPerPhase;
            const phaseEndSession = currentPhase * sessionsPerPhase;
            
            const sessionsInPhase = Math.min(completedSessions - phaseStartSession, sessionsPerPhase);
            return Math.round((sessionsInPhase / sessionsPerPhase) * 100);
        }

        // Get total sessions for program
        function getTotalSessions(program) {
            const sessions = {
                clarity: 1,
                discovery: 3,
                transformation: 6
            };
            return sessions[program] || 1;
        }

        // Get program name
        function getProgramName(program) {
            const names = {
                clarity: 'Ø¬Ù„Ø³Ø© Ø§Ù„ÙˆØ¶ÙˆØ­',
                discovery: 'Ø±Ø­Ù„Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù',
                transformation: 'Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­ÙˆÙ„'
            };
            return names[program] || program;
        }

        // Initialize suggestions panel
        function initializeSuggestions() {
            const suggestions = generateSuggestions();
            
            if (suggestions.length > 0) {
                // Create suggestions panel
                const panel = document.createElement('div');
                panel.className = 'alert-card';
                panel.style.marginTop = '1rem';
                
                let html = `
                    <div class="section-header">
                        <h3 class="section-title">
                            <span>ğŸ’¡</span>
                            <span>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø°ÙƒÙŠØ©</span>
                        </h3>
                    </div>
                    <div class="alert-list">
                `;
                
                suggestions.forEach(suggestion => {
                    html += `
                        <div class="alert-item ${suggestion.priority === 'high' ? 'warning' : 'info'}">
                            <div class="alert-icon">ğŸ’¡</div>
                            <div class="alert-content">
                                <div class="alert-title">${suggestion.title}</div>
                                <div class="alert-desc">${suggestion.description}</div>
                            </div>
                            <button class="alert-action" onclick="handleSuggestion('${suggestion.type}')">
                                ØªÙ†ÙÙŠØ°
                            </button>
                        </div>
                    `;
                });
                
                html += '</div>';
                panel.innerHTML = html;
                
                // Add to alerts panel
                document.querySelector('.alerts-panel').appendChild(panel);
            }
        }

        // Handle suggestion action
        window.handleSuggestion = function(type) {
            const suggestions = generateSuggestions();
            const suggestion = suggestions.find(s => s.type === type);
            if (suggestion && suggestion.action) {
                suggestion.action();
            }
        };

        // Performance monitoring
        function monitorPerformance() {
            const performanceData = {
                loadTime: performance.timing.loadEventEnd - performance.timing.navigationStart,
                journeyCount: journeys.length,
                memoryUsage: performance.memory ? performance.memory.usedJSHeapSize / 1048576 : 0
            };
            
            console.log('Dashboard Performance:', performanceData);
            
            // Send to analytics if needed
            if (window.gtag) {
                window.gtag('event', 'dashboard_performance', performanceData);
            }
        }

        // Initialize performance monitoring
        window.addEventListener('load', () => {
            setTimeout(monitorPerformance, 1000);
        });

        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Dashboard Error:', e);
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
        });

        // Initialize suggestions after data loads
        setTimeout(initializeSuggestions, 2000);

        // Public API for integration
        window.DashboardAPI = {
            refreshData: loadDashboardData,
            filterJourneys: advancedFilter,
            exportData: exportDashboardData,
            bulkAction: bulkAction,
            showNotification: showNotification
        };
    </script>
</body>
</html>
