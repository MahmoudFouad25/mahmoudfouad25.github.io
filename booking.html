<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رحلة اكتشاف الذات - التقييم العميق</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: linear-gradient(135deg, #F5F2E8 0%, #E8E5D5 100%);
            color: #1A1A1A;
            line-height: 1.8;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Progress Bar */
        .progress-container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .progress-bar {
            background: #E5E5E5;
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #2C5530, #8B9467);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            text-align: center;
            color: #666;
            font-size: 14px;
        }
        
        /* Question Container */
        .question-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .question-section {
            display: none;
        }
        
        .question-section.active {
            display: block;
        }
        
        .section-intro {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(44, 85, 48, 0.05) 0%, rgba(139, 148, 103, 0.05) 100%);
            border-radius: 15px;
        }
        
        .section-intro h2 {
            color: #2C5530;
            margin-bottom: 15px;
            font-size: 28px;
        }
        
        .section-intro p {
            color: #666;
            font-size: 18px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Question Styles */
        .question {
            margin-bottom: 35px;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }
        
        .question.revealed {
            opacity: 1;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }
        
        .question-number {
            display: inline-block;
            background: #2C5530;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .question-text {
            font-size: 20px;
            color: #2C5530;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        /* Option Styles */
        .options {
            display: grid;
            gap: 15px;
        }
        
        .option {
            background: #F8F8F8;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .option:hover {
            background: #F0F0F0;
            transform: translateX(-5px);
            border-color: #8B9467;
        }
        
        .option.selected {
            background: linear-gradient(135deg, rgba(44, 85, 48, 0.1) 0%, rgba(139, 148, 103, 0.1) 100%);
            border-color: #2C5530;
        }
        
        .option.selected::before {
            content: '✓';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: #2C5530;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .option-text {
            display: block;
            margin-right: 40px;
        }
        
        .option-main {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .option-sub {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        
        /* Sub-questions */
        .sub-question {
            margin-top: 20px;
            padding: 20px;
            background: rgba(44, 85, 48, 0.05);
            border-radius: 10px;
            border-right: 4px solid #2C5530;
            display: none;
        }
        
        .sub-question.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Text Input Styles */
        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #E5E5E5;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }
        
        .text-input:focus {
            outline: none;
            border-color: #2C5530;
            background: #FAFAFA;
        }
        
        .char-count {
            text-align: left;
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }
        
        /* Scale Input */
        .scale-container {
            margin: 20px 0;
        }
        
        .scale-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #666;
        }
        
        .scale-input {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #E5E5E5;
            outline: none;
        }
        
        .scale-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #2C5530;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scale-input::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #1e3a21;
        }
        
        .scale-value {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #2C5530;
            margin-top: 10px;
        }
        
        /* Checkbox Styles */
        .checkbox-group {
            display: grid;
            gap: 12px;
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #F8F8F8;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .checkbox-option:hover {
            background: #F0F0F0;
        }
        
        .checkbox-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-left: 15px;
            cursor: pointer;
        }
        
        .checkbox-option.checked {
            background: rgba(44, 85, 48, 0.1);
            border: 1px solid #2C5530;
        }
        
        /* Navigation Buttons */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #E5E5E5;
        }
        
        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .btn-secondary {
            background: white;
            color: #2C5530;
            border: 2px solid #2C5530;
        }
        
        .btn-secondary:hover {
            background: #2C5530;
            color: white;
        }
        
        .btn-primary {
            background: #2C5530;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1e3a21;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 85, 48, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Results Section */
        .results-container {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
            position: relative;
            overflow: hidden;
        }
        
        /* Loading */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2C5530;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #2C5530;
            font-size: 18px;
        }
        
        /* Final Message */
        .final-message {
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #F5F2E8 0%, #E8E5D5 100%);
            border-radius: 20px;
            margin-top: 30px;
        }
        
        .final-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .final-title {
            font-size: 32px;
            color: #2C5530;
            margin-bottom: 20px;
        }
        
        .final-text {
            font-size: 18px;
            color: #666;
            line-height: 1.8;
            max-width: 600px;
            margin: 0 auto 30px;
        }
        
        .whatsapp-btn {
            display: inline-block;
            background: #25D366;
            color: white;
            padding: 15px 40px;
            border-radius: 30px;
            text-decoration: none;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .whatsapp-btn:hover {
            background: #1EBE56;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .question-container {
                padding: 20px;
            }
            
            .question-text {
                font-size: 18px;
            }
            
            .option {
                padding: 15px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">البداية</div>
        </div>
        
        <!-- Main Form Container -->
        <div class="question-container" id="questionContainer">
            
            <!-- Welcome Section -->
            <div class="question-section active" id="section-0">
                <div class="section-intro">
                    <h2>مرحباً بك في رحلة اكتشاف الذات 🌟</h2>
                    <p>قبل أن نبدأ، خذ نفساً عميقاً...</p>
                    <p>هذه ليست مجرد استمارة، بل محادثة مع نفسك</p>
                    <p>كل سؤال مصمم ليساعدك على الوضوح</p>
                </div>
                
                <div class="navigation">
                    <span></span>
                    <button class="btn btn-primary" onclick="startAssessment()">ابدأ الرحلة</button>
                </div>
            </div>
            
            <!-- Section 1: Starting Point -->
            <div class="question-section" id="section-1">
                <div class="section-intro">
                    <h2>نقطة البداية</h2>
                    <p>دعنا نفهم ما الذي جلبك إلى هنا</p>
                </div>
                
                <!-- Question 1 -->
                <div class="question revealed" id="q1">
                    <span class="question-number">1</span>
                    <h3 class="question-text">ما الذي يجعلك تبحث عن الدعم في هذه اللحظة من حياتك؟</h3>
                    <div class="options">
                        <div class="option" onclick="selectOption('q1', 'a', this)">
                            <span class="option-text">
                                <span class="option-main">أواجه تحدياً محدداً أريد حلاً له</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q1', 'b', this)">
                            <span class="option-text">
                                <span class="option-main">أشعر بأن شيئاً ما "ليس صحيحاً" في حياتي</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q1', 'c', this)">
                            <span class="option-text">
                                <span class="option-main">أريد أن أفهم نفسي بشكل أعمق</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q1', 'd', this)">
                            <span class="option-text">
                                <span class="option-main">مستعد لتحول جذري في حياتي</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Sub-questions -->
                    <div class="sub-question" id="q1-sub-a">
                        <h4>ما نوع التحدي الذي تواجهه؟</h4>
                        <div class="options">
                            <div class="option" onclick="selectSubOption('q1-sub-a', '1', this)">
                                <span class="option-text">التحدي في العمل/المهنة</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-a', '2', this)">
                                <span class="option-text">التحدي في العلاقات</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-a', '3', this)">
                                <span class="option-text">التحدي مع نفسي</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-a', '4', this)">
                                <span class="option-text">التحدي في اتخاذ قرار مهم</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sub-question" id="q1-sub-b">
                        <h4>كيف يتجلى هذا الشعور في حياتك؟</h4>
                        <div class="options">
                            <div class="option" onclick="selectSubOption('q1-sub-b', '1', this)">
                                <span class="option-text">شعور بالفراغ رغم الإنجازات</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-b', '2', this)">
                                <span class="option-text">تكرار نفس الأنماط المؤلمة</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-b', '3', this)">
                                <span class="option-text">فقدان الشغف والمعنى</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-b', '4', this)">
                                <span class="option-text">إحساس بأنني لست في مكاني الصحيح</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sub-question" id="q1-sub-c">
                        <h4>ما أكثر سؤال يشغل بالك عن نفسك؟</h4>
                        <div class="options">
                            <div class="option" onclick="selectSubOption('q1-sub-c', '1', this)">
                                <span class="option-text">لماذا أتصرف بالطريقة التي أتصرف بها؟</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-c', '2', this)">
                                <span class="option-text">من أنا حقاً خلف كل الأقنعة؟</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-c', '3', this)">
                                <span class="option-text">ما هو دوري الحقيقي في الحياة؟</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-c', '4', this)">
                                <span class="option-text">كيف أحقق إمكانياتي الكامنة؟</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sub-question" id="q1-sub-d">
                        <h4>ما الذي يدفعك نحو هذا التحول؟</h4>
                        <div class="options">
                            <div class="option" onclick="selectSubOption('q1-sub-d', '1', this)">
                                <span class="option-text">لدي رؤية واضحة وأحتاج دعماً للتنفيذ</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-d', '2', this)">
                                <span class="option-text">أعرف أنني أحتاج تغييراً جذرياً لكن لا أعرف كيف</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-d', '3', this)">
                                <span class="option-text">مررت بتجربة أيقظتني وأريد البناء عليها</span>
                            </div>
                            <div class="option" onclick="selectSubOption('q1-sub-d', '4', this)">
                                <span class="option-text">وصلت لمرحلة "كفى" وأريد حياة مختلفة</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Question 2 -->
                <div class="question" id="q2">
                    <span class="question-number">2</span>
                    <h3 class="question-text">عندما تواجه تحدياً في حياتك، ما أول ما تفكر فيه عادة؟</h3>
                    <div class="options">
                        <div class="option" onclick="selectOption('q2', 'a', this)">
                            <span class="option-text">
                                <span class="option-main">"كيف أحل هذه المشكلة بسرعة؟"</span>
                                <span class="option-sub">أركز على إيجاد حلول عملية فورية</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q2', 'b', this)">
                            <span class="option-text">
                                <span class="option-main">"لماذا يحدث لي هذا دائماً؟"</span>
                                <span class="option-sub">ألاحظ تكرار نفس النوع من التحديات</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q2', 'c', this)">
                            <span class="option-text">
                                <span class="option-main">"ما الرسالة التي تحملها هذه التجربة؟"</span>
                                <span class="option-sub">أبحث عن المعنى والحكمة</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q2', 'd', this)">
                            <span class="option-text">
                                <span class="option-main">"هذا امتحان/فرصة للنمو"</span>
                                <span class="option-sub">أرى التحديات كجزء من رحلة التطور</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Question 3 -->
                <div class="question" id="q3">
                    <span class="question-number">3</span>
                    <h3 class="question-text">أكمل هذه الجملة: "أكثر ما يؤلمني في حياتي الآن هو..."</h3>
                    <textarea class="text-input" id="q3-text" placeholder="اكتب بحرية... كل ما تكتبه سيبقى في سرية تامة" onkeyup="updateCharCount('q3-text', 500)"></textarea>
                    <div class="char-count" id="q3-text-count">0 / 500</div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousSection()">السابق</button>
                    <button class="btn btn-primary" onclick="nextSection()">التالي</button>
                </div>
            </div>
            
            <!-- Section 2: Patterns & Awareness -->
            <div class="question-section" id="section-2">
                <div class="section-intro">
                    <h2>الوعي بالأنماط</h2>
                    <p>لنستكشف معاً الخيوط الخفية في نسيج حياتك</p>
                </div>
                
                <!-- Question 4 -->
                <div class="question revealed" id="q4">
                    <span class="question-number">4</span>
                    <h3 class="question-text">فكر في آخر 3 تحديات كبرى واجهتها. هل تلاحظ نمطاً مشتركاً؟</h3>
                    <div class="options">
                        <div class="option" onclick="selectOption('q4', 'a', this)">
                            <span class="option-text">
                                <span class="option-main">لا، كل موقف مختلف تماماً</span>
                                <span class="option-sub">التحديات متنوعة ولا أرى رابطاً بينها</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q4', 'b', this)">
                            <span class="option-text">
                                <span class="option-main">نعم، ألاحظ بعض التشابه</span>
                                <span class="option-sub">هناك خيوط مشتركة أبدأ في رؤيتها</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q4', 'c', this)">
                            <span class="option-text">
                                <span class="option-main">نعم، هناك نمط واضح أراه</span>
                                <span class="option-sub">أعي تماماً الأنماط المتكررة في حياتي</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q4', 'd', this)">
                            <span class="option-text">
                                <span class="option-main">الآن بعد أن سألت، بدأت ألاحظ...</span>
                                <span class="option-sub">السؤال فتح عيني على شيء لم أنتبه له</span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="sub-question" id="q4-sub-b">
                        <h4>ما نوع التشابه الذي تلاحظه؟</h4>
                        <div class="checkbox-group">
                            <div class="checkbox-option" onclick="toggleCheckbox(this)">
                                <input type="checkbox" value="people">
                                <span>نفس نوع الأشخاص يسبب لي المشاكل</span>
                            </div>
                            <div class="checkbox-option" onclick="toggleCheckbox(this)">
                                <input type="checkbox" value="mistakes">
                                <span>أكرر نفس الأخطاء</span>
                            </div>
                            <div class="checkbox-option" onclick="toggleCheckbox(this)">
                                <input type="checkbox" value="situations">
                                <span>أجد نفسي في نفس المواقف</span>
                            </div>
                            <div class="checkbox-option" onclick="toggleCheckbox(this)">
                                <input type="checkbox" value="reactions">
                                <span>ردود أفعالي متشابهة</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Question 5 -->
                <div class="question" id="q5">
                    <span class="question-number">5</span>
                    <h3 class="question-text">ما مدى استعدادك لمواجهة حقائق قد تكون غير مريحة عن نفسك؟</h3>
                    <div class="options">
                        <div class="option" onclick="selectOption('q5', 'a', this)">
                            <span class="option-text">
                                <span class="option-main">مستعد تماماً - أريد الحقيقة مهما كانت</span>
                                <span class="option-sub">الوضوح أهم من الراحة بالنسبة لي</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q5', 'b', this)">
                            <span class="option-text">
                                <span class="option-main">مستعد بحذر - أريد التدرج</span>
                                <span class="option-sub">أفضل اكتشاف الحقائق خطوة بخطوة</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q5', 'c', this)">
                            <span class="option-text">
                                <span class="option-main">قلق لكن مستعد - أحتاج دعماً كبيراً</span>
                                <span class="option-sub">أريد التغيير رغم مخاوفي</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q5', 'd', this)">
                            <span class="option-text">
                                <span class="option-main">لست متأكداً - أريد البدء بهدوء</span>
                                <span class="option-sub">أحتاج لبناء الثقة أولاً</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Question 6 -->
                <div class="question" id="q6">
                    <span class="question-number">6</span>
                    <h3 class="question-text">عندما تتخيل نفسك بعد عام من الآن، ماذا تتمنى أن يكون قد تغير؟</h3>
                    <textarea class="text-input" id="q6-text" placeholder="صف الصورة التي تتمناها لنفسك..." onkeyup="updateCharCount('q6-text', 500)"></textarea>
                    <div class="char-count" id="q6-text-count">0 / 500</div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousSection()">السابق</button>
                    <button class="btn btn-primary" onclick="nextSection()">التالي</button>
                </div>
            </div>
            
            <!-- Section 3: Resources & Commitment -->
            <div class="question-section" id="section-3">
                <div class="section-intro">
                    <h2>الموارد والالتزام</h2>
                    <p>لنفهم ما لديك وما تحتاجه لرحلتك</p>
                </div>
                
                <!-- Question 7 -->
                <div class="question revealed" id="q7">
                    <span class="question-number">7</span>
                    <h3 class="question-text">كم من الوقت والطاقة يمكنك تخصيصه لرحلتك؟</h3>
                    <div class="options">
                        <div class="option" onclick="selectOption('q7', 'a', this)">
                            <span class="option-text">
                                <span class="option-main">محدود جداً - ساعة أسبوعياً أو أقل</span>
                                <span class="option-sub">وقتي ضيق لكنني مهتم</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q7', 'b', this)">
                            <span class="option-text">
                                <span class="option-main">متوسط - 2-3 ساعات أسبوعياً</span>
                                <span class="option-sub">يمكنني إيجاد وقت مناسب</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q7', 'c', this)">
                            <span class="option-text">
                                <span class="option-main">جيد - 3-5 ساعات أسبوعياً</span>
                                <span class="option-sub">مستعد لاستثمار وقت كافٍ</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q7', 'd', this)">
                            <span class="option-text">
                                <span class="option-main">ملتزم تماماً - أكثر من 5 ساعات</span>
                                <span class="option-sub">هذا أولوية قصوى في حياتي</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Question 8 -->
                <div class="question" id="q8">
                    <span class="question-number">8</span>
                    <h3 class="question-text">ما الذي يدعمك في حياتك الآن؟</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="family">
                            <span>عائلة داعمة</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="friends">
                            <span>أصدقاء واعون</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="spiritual">
                            <span>ممارسة روحية/دينية</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="learning">
                            <span>قراءة وتعلم ذاتي</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="physical">
                            <span>رياضة أو ممارسة جسدية</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="work">
                            <span>عمل أحبه</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="hobby">
                            <span>هواية أو شغف</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="none">
                            <span>لا شيء مما سبق</span>
                        </div>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousSection()">السابق</button>
                    <button class="btn btn-primary" onclick="nextSection()">التالي</button>
                </div>
            </div>
            
            <!-- Section 4: Deep Questions -->
            <div class="question-section" id="section-4">
                <div class="section-intro">
                    <h2>الأسئلة العميقة</h2>
                    <p>خذ وقتك... هذه أسئلة للتأمل والاستبصار</p>
                </div>
                
                <!-- Question 9 -->
                <div class="question revealed" id="q9">
                    <span class="question-number">9</span>
                    <h3 class="question-text">لو كان ألمك الحالي رسالة لك، ماذا تعتقد أنها تريد أن تقول؟</h3>
                    <textarea class="text-input" id="q9-text" placeholder="استمع لصوت الألم... ماذا يحاول أن يخبرك؟" onkeyup="updateCharCount('q9-text', 500)"></textarea>
                    <div class="char-count" id="q9-text-count">0 / 500</div>
                </div>
                
                <!-- Question 10 -->
                <div class="question" id="q10">
                    <span class="question-number">10</span>
                    <h3 class="question-text">ما أكثر شيء تخاف من اكتشافه عن نفسك؟</h3>
                    <div class="options">
                        <div class="option" onclick="selectOption('q10', 'a', this)">
                            <span class="option-text">
                                <span class="option-main">أنني لست بالقوة التي أظنها</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q10', 'b', this)">
                            <span class="option-text">
                                <span class="option-main">أنني السبب في معظم مشاكلي</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q10', 'c', this)">
                            <span class="option-text">
                                <span class="option-main">أنني أحتاج تغييراً جذرياً</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q10', 'd', this)">
                            <span class="option-text">
                                <span class="option-main">أنني بخير كما أنا ولا أحتاج كل هذا</span>
                            </span>
                        </div>
                        <div class="option" onclick="selectOption('q10', 'e', this)">
                            <span class="option-text">
                                <span class="option-main">أفضل عدم التفكير في هذا</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousSection()">السابق</button>
                    <button class="btn btn-primary" onclick="nextSection()">التالي</button>
                </div>
            </div>
            
            <!-- Section 5: Previous Experience -->
            <div class="question-section" id="section-5">
                <div class="section-intro">
                    <h2>التجارب السابقة</h2>
                    <p>لنبني على ما سبق ونتعلم منه</p>
                </div>
                
                <!-- Question 11 -->
                <div class="question revealed" id="q11">
                    <span class="question-number">11</span>
                    <h3 class="question-text">هل سبق لك تجربة أي من التالي؟</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="therapy">
                            <span>علاج نفسي تقليدي</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="coaching">
                            <span>كوتشينج حياة</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="workshops">
                            <span>ورش تطوير ذات</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="meditation">
                            <span>ممارسات تأملية/يوغا</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="reading">
                            <span>قراءات في علم النفس/التنمية</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="spiritual-journey">
                            <span>رحلة روحية/دينية عميقة</span>
                        </div>
                        <div class="checkbox-option" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="none-experience">
                            <span>لا شيء مما سبق</span>
                        </div>
                    </div>
                    
                    <div class="sub-question" id="q11-sub" style="display: none;">
                        <h4>ما أهم ما استفدته؟ وما الذي شعرت أنه ناقص؟</h4>
                        <textarea class="text-input" id="q11-text" placeholder="شارك تجربتك..." onkeyup="updateCharCount('q11-text', 300)"></textarea>
                        <div class="char-count" id="q11-text-count">0 / 300</div>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousSection()">السابق</button>
                    <button class="btn btn-primary" onclick="nextSection()">التالي</button>
                </div>
            </div>
            
            <!-- Section 6: Account & Contact Info -->
            <div class="question-section" id="section-6">
                <div class="section-intro">
                    <h2>معلومات التواصل</h2>
                    <p>لنتمكن من مرافقتك في رحلتك</p>
                </div>
                
                <!-- Basic Information -->
                <div class="question revealed" id="qBasicInfo">
                    <span class="question-number">📝</span>
                    <h3 class="question-text">معلوماتك الأساسية</h3>
                    
                    <div style="display: grid; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; color: #2C5530; font-weight: bold;">
                                الاسم (يمكنك استخدام اسم مستعار)
                            </label>
                            <input type="text" id="userName" class="text-input" style="min-height: 50px;" placeholder="الاسم الذي تحب أن نناديك به">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 10px; color: #2C5530; font-weight: bold;">
                                البريد الإلكتروني *
                            </label>
                            <input type="email" id="userEmail" class="text-input" style="min-height: 50px;" placeholder="example@email.com" required>
                            <small style="color: #666;">سنستخدمه لإنشاء حسابك الخاص</small>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 10px; color: #2C5530; font-weight: bold;">
                                رقم الواتساب *
                            </label>
                            <input type="tel" id="userPhone" class="text-input" style="min-height: 50px;" placeholder="01234567890" required>
                            <small style="color: #666;">للتواصل المباشر معك</small>
                        </div>
                    </div>
                </div>
                
                <!-- Account Creation -->
                <div class="question" id="qAccount">
                    <span class="question-number">🔐</span>
                    <h3 class="question-text">إنشاء حسابك الخاص</h3>
                    <p style="color: #666; margin-bottom: 20px;">سيتم إنشاء مساحة خاصة بك لمتابعة رحلتك وحفظ تقدمك</p>
                    
                    <div>
                        <label style="display: block; margin-bottom: 10px; color: #2C5530; font-weight: bold;">
                            كلمة المرور (6 أحرف على الأقل) *
                        </label>
                        <div style="position: relative;">
                            <input type="password" id="userPassword" class="text-input" style="min-height: 50px; padding-left: 50px;" placeholder="اختر كلمة مرور قوية" required>
                            <span onclick="togglePasswordVisibility()" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 20px;">
                                👁️
                            </span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <label style="display: block; margin-bottom: 10px; color: #2C5530; font-weight: bold;">
                            تأكيد كلمة المرور *
                        </label>
                        <input type="password" id="confirmPassword" class="text-input" style="min-height: 50px;" placeholder="أعد كتابة كلمة المرور" required>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #F0F8F0; border-radius: 10px;">
                        <p style="color: #2C5530; margin: 0;">
                            <strong>ملاحظة:</strong> يمكنك تسجيل الدخول لاحقاً باستخدام بريدك الإلكتروني وكلمة المرور لمتابعة رحلتك
                        </p>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousSection()">السابق</button>
                    <button class="btn btn-primary" onclick="nextSection()">التالي</button>
                </div>
            </div>
            
            <!-- Section 7: Final Touch -->
            <div class="question-section" id="section-7">
                <div class="section-intro">
                    <h2>اللمسة الأخيرة</h2>
                    <p>أنت على وشك إكمال الرحلة التقييمية</p>
                </div>
                
                <!-- Question 12 -->
                <div class="question revealed" id="q12">
                    <span class="question-number">12</span>
                    <h3 class="question-text">تخيل أننا بعد 6 شهور من الآن نحتفل بتحولك. ما الذي نحتفل به تحديداً؟</h3>
                    <textarea class="text-input" id="q12-text" placeholder="اسمح لنفسك بالحلم... ما الذي تحقق؟" onkeyup="updateCharCount('q12-text', 500)"></textarea>
                    <div class="char-count" id="q12-text-count">0 / 500</div>
                </div>
                
                <!-- Question 13 -->
                <div class="question" id="q13">
                    <span class="question-number">13</span>
                    <h3 class="question-text">على مقياس من 1-10:</h3>
                    
                    <div class="scale-container">
                        <h4>ما مدى إلحاح حاجتك للدعم الآن؟</h4>
                        <div class="scale-label">
                            <span>1 - غير ملح</span>
                            <span>10 - ملح جداً</span>
                        </div>
                        <input type="range" class="scale-input" id="urgency-scale" min="1" max="10" value="5" onchange="updateScaleValue('urgency')">
                        <div class="scale-value" id="urgency-value">5</div>
                    </div>
                    
                    <div class="scale-container">
                        <h4>ما مدى استعدادك للاستثمار في نفسك؟</h4>
                        <div class="scale-label">
                            <span>1 - غير مستعد</span>
                            <span>10 - مستعد تماماً</span>
                        </div>
                        <input type="range" class="scale-input" id="investment-scale" min="1" max="10" value="5" onchange="updateScaleValue('investment')">
                        <div class="scale-value" id="investment-value">5</div>
                    </div>
                    
                    <div class="scale-container">
                        <h4>ما مدى ثقتك في إمكانية التغيير؟</h4>
                        <div class="scale-label">
                            <span>1 - غير واثق</span>
                            <span>10 - واثق تماماً</span>
                        </div>
                        <input type="range" class="scale-input" id="confidence-scale" min="1" max="10" value="5" onchange="updateScaleValue('confidence')">
                        <div class="scale-value" id="confidence-value">5</div>
                    </div>
                </div>
                
                <!-- Question 14 -->
                <div class="question" id="q14">
                    <span class="question-number">14</span>
                    <h3 class="question-text">هل هناك شيء مهم تريد أن أعرفه عنك لم تسأل عنه الأسئلة؟</h3>
                    <textarea class="text-input" id="q14-text" placeholder="هذه مساحتك الحرة..." onkeyup="updateCharCount('q14-text', 500)"></textarea>
                    <div class="char-count" id="q14-text-count">0 / 500</div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousSection()">السابق</button>
                    <button class="btn btn-primary" onclick="submitAssessment()">إرسال وعرض النتائج</button>
                </div>
            </div>
        </div>
        
        <!-- Results Container -->
        <div class="results-container" id="resultsContainer">
            <!-- Dynamic results content will be inserted here -->
        </div>
        
        <!-- Loading -->
        <div class="loading-container" id="loadingContainer">
            <div class="loading-content">
                <div class="spinner"></div>
                <p class="loading-text">جاري تحليل إجاباتك بعناية...</p>
            </div>
        </div>
    </div>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <!-- Firebase Configuration -->
    <script>
        <script src="firebase-config.js"></script>
    </script>
    
    <script>
        // Global state
        let currentSection = 0;
        const totalSections = 8;
        let answers = {};
        let subAnswers = {};
        let userAccount = null;
        let assessmentData = null;
        
        // Initialize
        function startAssessment() {
            currentSection = 1;
            showSection(currentSection);
            updateProgress();
        }
        
        // Section navigation
        function showSection(sectionNum) {
            // Hide all sections
            document.querySelectorAll('.question-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show current section
            const section = document.getElementById(`section-${sectionNum}`);
            if (section) {
                section.classList.add('active');
                
                // Reveal questions with delay
                const questions = section.querySelectorAll('.question');
                questions.forEach((q, index) => {
                    if (!q.classList.contains('revealed')) {
                        setTimeout(() => {
                            q.classList.add('revealed');
                        }, index * 300);
                    }
                });
            }
            
            updateProgress();
        }
        
        function nextSection() {
            if (validateSection(currentSection)) {
                if (currentSection < totalSections - 1) {
                    currentSection++;
                    showSection(currentSection);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }
        
        function previousSection() {
            if (currentSection > 0) {
                currentSection--;
                showSection(currentSection);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // Progress update
        function updateProgress() {
            const progress = (currentSection / (totalSections - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            const progressTexts = [
                'البداية',
                'نقطة البداية',
                'الوعي بالأنماط',
                'الموارد والالتزام',
                'الأسئلة العميقة',
                'التجارب السابقة',
                'معلومات التواصل',
                'اللمسة الأخيرة'
            ];
            
            document.getElementById('progressText').textContent = progressTexts[currentSection];
        }
        
        // Option selection
        function selectOption(questionId, value, element) {
            // Store answer
            answers[questionId] = value;
            
            // Update UI
            const options = element.parentElement.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            // Handle sub-questions
            const subQuestions = document.querySelectorAll(`#${questionId}-sub-a, #${questionId}-sub-b, #${questionId}-sub-c, #${questionId}-sub-d`);
            subQuestions.forEach(sq => sq.classList.remove('active'));
            
            const targetSub = document.getElementById(`${questionId}-sub-${value}`);
            if (targetSub) {
                targetSub.classList.add('active');
            }
        }
        
        function selectSubOption(subQuestionId, value, element) {
            // Store sub-answer
            subAnswers[subQuestionId] = value;
            
            // Update UI
            const options = element.parentElement.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }
        
        // Checkbox handling
        function toggleCheckbox(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                element.classList.add('checked');
            } else {
                element.classList.remove('checked');
            }
            
            // Handle Q11 sub-question
            if (element.closest('#q11')) {
                const checkedBoxes = document.querySelectorAll('#q11 input[type="checkbox"]:checked');
                const hasExperience = Array.from(checkedBoxes).some(cb => cb.value !== 'none-experience');
                const subQuestion = document.getElementById('q11-sub');
                
                if (hasExperience && subQuestion) {
                    subQuestion.style.display = 'block';
                    subQuestion.classList.add('active');
                } else if (subQuestion) {
                    subQuestion.style.display = 'none';
                    subQuestion.classList.remove('active');
                }
            }
            
            // Store checkbox values
            const questionElement = element.closest('.question');
            if (questionElement) {
                const questionId = questionElement.id;
                const checkedValues = [];
                questionElement.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                    checkedValues.push(cb.value);
                });
                answers[questionId + '-checks'] = checkedValues;
            }
        }
        
        // Character count
        function updateCharCount(textareaId, maxChars) {
            const textarea = document.getElementById(textareaId);
            const countElement = document.getElementById(`${textareaId}-count`);
            const count = textarea.value.length;
            countElement.textContent = `${count} / ${maxChars}`;
            
            // Store text answers
            answers[textareaId] = textarea.value;
        }
        
        // Scale value update
        function updateScaleValue(scaleType) {
            const scale = document.getElementById(`${scaleType}-scale`);
            const valueDisplay = document.getElementById(`${scaleType}-value`);
            valueDisplay.textContent = scale.value;
            
            // Store scale answers
            answers[`${scaleType}-scale`] = scale.value;
        }
        
        // Password visibility toggle
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('userPassword');
            const icon = event.target;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                icon.textContent = '👁️';
            }
        }
        
        // Validation
        function validateSection(sectionNum) {
            let isValid = true;
            let errorMessage = '';
            
            switch(sectionNum) {
                        case 1:
                   if (!answers.q1) {
                       errorMessage = 'من فضلك أجب على السؤال الأول';
                       isValid = false;
                   } else if (!answers.q2) {
                       errorMessage = 'من فضلك أجب على السؤال الثاني';
                       isValid = false;
                   } else if (!answers['q3-text'] || answers['q3-text'].length < 10) {
                       errorMessage = 'من فضلك اكتب إجابة أطول قليلاً في السؤال الثالث';
                       isValid = false;
                   }
                   break;
                   
               case 2:
                   if (!answers.q4) {
                       errorMessage = 'من فضلك أجب على السؤال الرابع';
                       isValid = false;
                   } else if (!answers.q5) {
                       errorMessage = 'من فضلك أجب على السؤال الخامس';
                       isValid = false;
                   } else if (!answers['q6-text'] || answers['q6-text'].length < 10) {
                       errorMessage = 'من فضلك شارك رؤيتك في السؤال السادس';
                       isValid = false;
                   }
                   break;
                   
               case 3:
                   if (!answers.q7) {
                       errorMessage = 'من فضلك أجب على السؤال السابع';
                       isValid = false;
                   } else if (!answers['q8-checks'] || answers['q8-checks'].length === 0) {
                       errorMessage = 'من فضلك اختر ما يدعمك في حياتك';
                       isValid = false;
                   }
                   break;
                   
               case 4:
                   if (!answers['q9-text'] || answers['q9-text'].length < 10) {
                       errorMessage = 'من فضلك شاركنا ما تعتقد أن ألمك يريد أن يقوله';
                       isValid = false;
                   } else if (!answers.q10) {
                       errorMessage = 'من فضلك أجب على السؤال العاشر';
                       isValid = false;
                   }
                   break;
                   
               case 5:
                   if (!answers['q11-checks'] || answers['q11-checks'].length === 0) {
                       errorMessage = 'من فضلك اختر تجاربك السابقة';
                       isValid = false;
                   }
                   break;
                   
               case 6: // Account info validation
                   const email = document.getElementById('userEmail').value;
                   const phone = document.getElementById('userPhone').value;
                   const password = document.getElementById('userPassword').value;
                   const confirmPassword = document.getElementById('confirmPassword').value;
                   
                   if (!email || !validateEmail(email)) {
                       errorMessage = 'من فضلك أدخل بريد إلكتروني صحيح';
                       isValid = false;
                   } else if (!phone || !validatePhone(phone)) {
                       errorMessage = 'من فضلك أدخل رقم واتساب صحيح';
                       isValid = false;
                   } else if (!password || password.length < 6) {
                       errorMessage = 'كلمة المرور يجب أن تكون 6 أحرف على الأقل';
                       isValid = false;
                   } else if (password !== confirmPassword) {
                       errorMessage = 'كلمتا المرور غير متطابقتين';
                       isValid = false;
                   }
                   
                   // Store account info
                   if (isValid) {
                       answers.userName = document.getElementById('userName').value || 'عميل كريم';
                       answers.userEmail = email;
                       answers.userPhone = phone;
                       answers.userPassword = password;
                   }
                   break;
                   
               case 7:
                   if (!answers['q12-text'] || answers['q12-text'].length < 10) {
                       errorMessage = 'من فضلك شاركنا رؤيتك للمستقبل';
                       isValid = false;
                   }
                   break;
           }
           
           if (!isValid) {
               alert(errorMessage);
           }
           
           return isValid;
       }
       
       // Email validation
       function validateEmail(email) {
           return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
       }
       
       // Phone validation
       function validatePhone(phone) {
           const cleaned = phone.replace(/\D/g, '');
           return cleaned.length >= 10 && cleaned.length <= 11;
       }
       
       // Submit assessment
       async function submitAssessment() {
           // Show loading
           document.getElementById('loadingContainer').style.display = 'flex';
           
           try {
               // Create user account first
               const userCredential = await auth.createUserWithEmailAndPassword(
                   answers.userEmail, 
                   answers.userPassword
               );
               userAccount = userCredential.user;
               
               // Update display name
               await userAccount.updateProfile({
                   displayName: answers.userName
               });
               
               // Create user document in Firestore
               await db.collection('users').doc(userAccount.uid).set({
                   email: answers.userEmail,
                   name: answers.userName,
                   phone: answers.userPhone,
                   createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                   lastLogin: firebase.firestore.FieldValue.serverTimestamp()
               });
               
               // Analyze results
               const analysisResults = analyzeAnswers();
               
               // Save assessment results to Firestore
               const assessmentRef = await db.collection('assessments').add({
                   userId: userAccount.uid,
                   answers: answers,
                   subAnswers: subAnswers,
                   results: analysisResults,
                   completedAt: firebase.firestore.FieldValue.serverTimestamp()
               });
               
               // Create booking record
               const bookingNumber = 'BK' + Date.now().toString().slice(-8);
               await db.collection('bookings').add({
                   userId: userAccount.uid,
                   assessmentId: assessmentRef.id,
                   bookingNumber: bookingNumber,
                   userName: answers.userName,
                   userEmail: answers.userEmail,
                   userPhone: answers.userPhone,
                   recommendedJourney: analysisResults.recommendedJourney,
                   selectedJourney: analysisResults.selectedJourney || analysisResults.recommendedJourney,
                   status: 'assessment_completed',
                   createdAt: firebase.firestore.FieldValue.serverTimestamp()
               });
               
               // Store assessment data for later use
               assessmentData = {
                   bookingNumber: bookingNumber,
                   analysisResults: analysisResults,
                   userName: answers.userName,
                   userEmail: answers.userEmail,
                   userPhone: answers.userPhone
               };
               
               // Show results after a delay
               setTimeout(() => {
                   showResults(analysisResults);
               }, 2000);
               
           } catch (error) {
               console.error('Error:', error);
               document.getElementById('loadingContainer').style.display = 'none';
               
               if (error.code === 'auth/email-already-in-use') {
                   alert('هذا البريد الإلكتروني مسجل بالفعل. يمكنك تسجيل الدخول من صفحة الدخول.');
               } else {
                   alert('حدث خطأ. من فضلك حاول مرة أخرى.');
               }
           }
       }
       
       // Analyze answers - comprehensive scoring system
       function analyzeAnswers() {
           // Initialize scores
           let scores = {
               eshraq: 0,
               baseera: 0,
               sakeena: 0
           };
           
           // Detailed scoring based on answers
           // Q1 scoring - Main motivation
           if (answers.q1 === 'a') {
               scores.eshraq += 30;
               // Sub-question scoring
               if (subAnswers['q1-sub-a'] === '1') scores.eshraq += 10; // Work challenge
               if (subAnswers['q1-sub-a'] === '2') scores.eshraq += 8; // Relationship challenge
               if (subAnswers['q1-sub-a'] === '3') scores.baseera += 5; // Self challenge
               if (subAnswers['q1-sub-a'] === '4') scores.eshraq += 7; // Decision challenge
           }
           else if (answers.q1 === 'b') {
               scores.baseera += 25;
               // Sub-question scoring
               if (subAnswers['q1-sub-b'] === '1') scores.baseera += 10; // Emptiness despite achievements
               if (subAnswers['q1-sub-b'] === '2') scores.baseera += 15; // Repeating patterns
               if (subAnswers['q1-sub-b'] === '3') scores.baseera += 8; // Lost passion
               if (subAnswers['q1-sub-b'] === '4') scores.sakeena += 5; // Not in right place
           }
           else if (answers.q1 === 'c') {
               scores.baseera += 35;
               // Sub-question scoring
               if (subAnswers['q1-sub-c'] === '1') scores.baseera += 10; // Why I act this way
               if (subAnswers['q1-sub-c'] === '2') scores.sakeena += 5; // Who am I really
               if (subAnswers['q1-sub-c'] === '3') scores.sakeena += 8; // My real role
               if (subAnswers['q1-sub-c'] === '4') scores.baseera += 7; // Realize potential
           }
           else if (answers.q1 === 'd') {
               scores.sakeena += 35;
               // Sub-question scoring
               if (subAnswers['q1-sub-d'] === '1') scores.sakeena += 10; // Clear vision
               if (subAnswers['q1-sub-d'] === '2') scores.sakeena += 8; // Need radical change
               if (subAnswers['q1-sub-d'] === '3') scores.sakeena += 12; // Awakening experience
               if (subAnswers['q1-sub-d'] === '4') scores.sakeena += 15; // Reached "enough"
           }
           
           // Q2 scoring - Thinking pattern
           if (answers.q2 === 'a') scores.eshraq += 20;
           else if (answers.q2 === 'b') scores.baseera += 20;
           else if (answers.q2 === 'c') scores.sakeena += 15;
           else if (answers.q2 === 'd') scores.sakeena += 20;
           
           // Q4 scoring - Pattern awareness
           if (answers.q4 === 'a') scores.eshraq += 15;
           else if (answers.q4 === 'b' || answers.q4 === 'd') {
               scores.baseera += 20;
               // Check which patterns they noticed
               const patterns = answers['q4-checks'] || [];
               if (patterns.includes('people')) scores.baseera += 5;
               if (patterns.includes('mistakes')) scores.baseera += 5;
               if (patterns.includes('situations')) scores.baseera += 5;
               if (patterns.includes('reactions')) scores.baseera += 5;
           }
           else if (answers.q4 === 'c') scores.sakeena += 20;
           
           // Q5 scoring - Readiness for truth
           if (answers.q5 === 'a') scores.sakeena += 25;
           else if (answers.q5 === 'b') scores.baseera += 20;
           else if (answers.q5 === 'c') scores.baseera += 15;
           else if (answers.q5 === 'd') scores.eshraq += 15;
           
           // Q7 scoring - Time commitment
           if (answers.q7 === 'a') scores.eshraq += 20;
           else if (answers.q7 === 'b') scores.baseera += 15;
           else if (answers.q7 === 'c') scores.baseera += 20;
           else if (answers.q7 === 'd') scores.sakeena += 25;
           
           // Q8 scoring - Support system
           const supportCount = (answers['q8-checks'] || []).length;
           if (supportCount === 0 || (answers['q8-checks'] || []).includes('none')) {
               scores.eshraq += 15; // Needs immediate support
           } else if (supportCount >= 4) {
               scores.sakeena += 10; // Has strong support for deep work
           } else {
               scores.baseera += 10; // Moderate support
           }
           
           // Q10 scoring - Fears
           if (answers.q10 === 'a' || answers.q10 === 'b') scores.baseera += 15;
           else if (answers.q10 === 'c') scores.sakeena += 20;
           else if (answers.q10 === 'd') scores.eshraq += 10;
           else if (answers.q10 === 'e') scores.eshraq += 15;
           
           // Q11 scoring - Previous experience
           const experiences = answers['q11-checks'] || [];
           if (experiences.includes('therapy') || experiences.includes('coaching')) {
               scores.baseera += 10;
               scores.sakeena += 5;
           }
           if (experiences.includes('spiritual-journey')) {
               scores.sakeena += 10;
           }
           if (experiences.includes('none-experience')) {
               scores.eshraq += 10;
           }
           
           // Scale scoring
           const urgency = parseInt(answers['urgency-scale'] || 5);
           const investment = parseInt(answers['investment-scale'] || 5);
           const confidence = parseInt(answers['confidence-scale'] || 5);
           
           if (urgency >= 8) scores.eshraq += 15;
           else if (urgency >= 6) scores.baseera += 10;
           else scores.sakeena += 5;
           
           if (investment >= 8) scores.sakeena += 20;
           else if (investment >= 6) scores.baseera += 15;
           else scores.eshraq += 10;
           
           if (confidence >= 8) scores.sakeena += 15;
           else if (confidence >= 6) scores.baseera += 10;
           else scores.eshraq += 10;
           
           // Text analysis
           const q3Text = (answers['q3-text'] || '').toLowerCase();
           const q6Text = (answers['q6-text'] || '').toLowerCase();
           const q9Text = (answers['q9-text'] || '').toLowerCase();
           const q12Text = (answers['q12-text'] || '').toLowerCase();
           
           // Keywords analysis
           const transformKeywords = ['تحول', 'جذري', 'تغيير شامل', 'حياة جديدة', 'نقلة', 'تحول عميق'];
           const understandingKeywords = ['فهم', 'أعرف', 'اكتشف', 'وعي', 'نمط', 'لماذا', 'أفهم نفسي'];
           const solutionKeywords = ['حل', 'مشكلة', 'تحدي', 'سريع', 'عملي', 'الآن', 'عاجل'];
           
           const allTexts = q3Text + ' ' + q6Text + ' ' + q9Text + ' ' + q12Text;
           
           transformKeywords.forEach(keyword => {
               if (allTexts.includes(keyword)) scores.sakeena += 3;
           });
           
           understandingKeywords.forEach(keyword => {
               if (allTexts.includes(keyword)) scores.baseera += 3;
           });
           
           solutionKeywords.forEach(keyword => {
               if (allTexts.includes(keyword)) scores.eshraq += 3;
           });
           
           // Determine primary journey type
           let journeyType = '';
           let recommendedJourney = '';
           
           // Calculate percentages
           const totalScore = scores.eshraq + scores.baseera + scores.sakeena;
           const eshraqPercent = (scores.eshraq / totalScore) * 100;
           const baseeraPercent = (scores.baseera / totalScore) * 100;
           const sakeenaPercent = (scores.sakeena / totalScore) * 100;
           
           // Determine if mixed journey is needed
           let isMixed = false;
           let mixedType = '';
           
           // Check for mixed cases with specific conditions
           if (Math.abs(eshraqPercent - baseeraPercent) < 15 && sakeenaPercent < 30) {
               isMixed = true;
               mixedType = 'eshraq-baseera';
               recommendedJourney = 'mixed-eshraq-baseera';
           } else if (Math.abs(baseeraPercent - sakeenaPercent) < 15 && eshraqPercent < 30) {
               isMixed = true;
               mixedType = 'baseera-sakeena';
               recommendedJourney = 'mixed-baseera-sakeena';
           } else {
               // Single journey recommendation
               if (scores.eshraq > scores.baseera && scores.eshraq > scores.sakeena) {
                   journeyType = 'eshraq';
                   recommendedJourney = 'eshraq';
               } else if (scores.baseera > scores.sakeena) {
                   journeyType = 'baseera';
                   recommendedJourney = 'baseera';
               } else {
                   journeyType = 'sakeena';
                   recommendedJourney = 'sakeena';
               }
           }
           
           // Create detailed profile based on answers
           const profile = createDetailedProfile();
           
           return {
               scores: scores,
               percentages: {
                   eshraq: eshraqPercent,
                   baseera: baseeraPercent,
                   sakeena: sakeenaPercent
               },
               journeyType: journeyType,
               recommendedJourney: recommendedJourney,
               isMixed: isMixed,
               mixedType: mixedType,
               profile: profile,
               userName: answers.userName,
               userEmail: answers.userEmail
           };
       }
       
       // Create detailed profile for personalized recommendations
       function createDetailedProfile() {
           const profile = {
               challengeType: '',
               awarenessLevel: '',
               timeAvailability: '',
               supportSystem: '',
               previousExperience: '',
               specificNeeds: [],
               keyPhrases: [],
               emotionalState: ''
           };
           
           // Challenge type
           if (answers.q1 === 'a' && subAnswers['q1-sub-a']) {
               const types = {
                   '1': 'work',
                   '2': 'relationships',
                   '3': 'self',
                   '4': 'decision'
               };
               profile.challengeType = types[subAnswers['q1-sub-a']] || 'general';
           }
           
           // Awareness level
           if (answers.q4 === 'c') profile.awarenessLevel = 'high';
           else if (answers.q4 === 'b' || answers.q4 === 'd') profile.awarenessLevel = 'medium';
           else profile.awarenessLevel = 'low';
           
           // Time availability
           profile.timeAvailability = answers.q7 || 'unknown';
           
           // Support system
           const supportCount = (answers['q8-checks'] || []).length;
           if (supportCount >= 4) profile.supportSystem = 'strong';
           else if (supportCount >= 2) profile.supportSystem = 'moderate';
           else profile.supportSystem = 'weak';
           
           // Previous experience
           const experiences = answers['q11-checks'] || [];
           if (experiences.length > 3) profile.previousExperience = 'extensive';
           else if (experiences.length > 0) profile.previousExperience = 'some';
           else profile.previousExperience = 'none';
           
           // Extract key phrases from text answers
           const texts = [
               answers['q3-text'] || '',
               answers['q6-text'] || '',
               answers['q9-text'] || '',
               answers['q12-text'] || ''
           ];
           
           texts.forEach(text => {
               if (text.length > 20) {
                   // Extract first meaningful phrase
                   const phrase = text.substring(0, 100).trim();
                   if (phrase) profile.keyPhrases.push(phrase);
               }
           });
           
           // Emotional state based on urgency and fears
           const urgency = parseInt(answers['urgency-scale'] || 5);
           if (urgency >= 8) profile.emotionalState = 'urgent';
           else if (urgency >= 5) profile.emotionalState = 'motivated';
           else profile.emotionalState = 'exploring';
           
           return profile;
       }
       
       // Show results with personalized recommendations
       function showResults(analysisResults) {
           document.getElementById('loadingContainer').style.display = 'none';
           document.getElementById('questionContainer').style.display = 'none';
           document.getElementById('resultsContainer').style.display = 'block';
           
           // Generate the appropriate recommendation HTML
           let recommendationHTML = '';
           
           if (analysisResults.isMixed) {
               recommendationHTML = generateMixedRecommendation(analysisResults);
           } else {
               if (analysisResults.journeyType === 'eshraq') {
                   recommendationHTML = generateEshraqRecommendation(analysisResults);
               } else if (analysisResults.journeyType === 'baseera') {
                   recommendationHTML = generateBaseeraRecommendation(analysisResults);
               } else {
                   recommendationHTML = generateSakeenaRecommendation(analysisResults);
               }
           }
           
           document.getElementById('resultsContainer').innerHTML = recommendationHTML;
           
           // Scroll to top
           window.scrollTo({ top: 0, behavior: 'smooth' });
       }
       
       // Generate Eshraq recommendation with variations
       function generateEshraqRecommendation(results) {
           const profile = results.profile;
           const challengeType = profile.challengeType;
           
           // Variations based on challenge type
           const variations = {
               work: {
                   icon: '💼',
                   greeting: 'أفهم تماماً ضغط العمل الذي تواجهه',
                   challenge: 'التحدي المهني',
                   focus: 'استعادة التوازن المهني والشخصي',
                   tools: 'إدارة ضغوط العمل',
                   outcome: 'خطة عملية لتحسين وضعك المهني'
               },
               relationships: {
                   icon: '❤️',
                   greeting: 'العلاقات جزء أساسي من حياتنا',
                   challenge: 'التحدي في العلاقات',
                   focus: 'بناء علاقات صحية ومتوازنة',
                   tools: 'التواصل الفعال وبناء الحدود',
                   outcome: 'أدوات لعلاقات أكثر انسجاماً'
               },
               self: {
                   icon: '🌱',
                   greeting: 'التحدي مع النفس هو الأعمق',
                   challenge: 'الصراع الداخلي',
                   focus: 'السلام مع الذات',
                   tools: 'التصالح مع النفس',
                   outcome: 'طريق واضح للسلام الداخلي'
               },
               decision: {
                   icon: '🎯',
                   greeting: 'القرارات المهمة تحتاج وضوحاً',
                   challenge: 'اتخاذ القرار الصحيح',
                   focus: 'الوضوح في اتخاذ القرار',
                   tools: 'اتخاذ القرارات بثقة',
                   outcome: 'قرار واضح ومدروس'
               },
               general: {
                   icon: '🌟',
                   greeting: 'كل تحدٍ يحمل في طياته فرصة',
                   challenge: 'التحدي الحالي',
                   focus: 'الحل العملي السريع',
                   tools: 'مواجهة التحديات',
                   outcome: 'حل فعّال وأدوات للمستقبل'
               }
           };
           
           const variant = variations[challengeType] || variations.general;
           const keyPhrase = profile.keyPhrases[0] || '';
           const urgencyLevel = profile.emotionalState === 'urgent' ? 'أفهم إلحاح الموقف' : 'أقدّر اهتمامك المبكر';
           
           return `
               <style>
                   .results-header {
                       text-align: center;
                       margin-bottom: 40px;
                       animation: fadeInDown 1s ease;
                   }
                   
                   @keyframes fadeInDown {
                       from {
                           opacity: 0;
                           transform: translateY(-30px);
                       }
                       to {
                           opacity: 1;
                           transform: translateY(0);
                       }
                   }
                   
                   .journey-icon {
                       font-size: 80px;
                       margin-bottom: 20px;
                       display: inline-block;
                       animation: pulse 2s infinite;
                   }
                   
                   @keyframes pulse {
                       0%, 100% { transform: scale(1); }
                       50% { transform: scale(1.1); }
                   }
                   
                   .results-title {
                       font-size: 32px;
                       color: #2C5530;
                       margin-bottom: 20px;
                   }
                   
                   .results-subtitle {
                       font-size: 20px;
                       color: #666;
                       max-width: 600px;
                       margin: 0 auto;
                   }
                   
                   .understanding-box {
                       background: white;
                       padding: 40px;
                       border-radius: 20px;
                       box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                       margin-bottom: 30px;
                       animation: fadeInUp 1s ease 0.3s both;
                   }
                   
                   @keyframes fadeInUp {
                       from {
                           opacity: 0;
                           transform: translateY(30px);
                       }
                       to {
                           opacity: 1;
                           transform: translateY(0);
                       }
                   }
                   
                   .understanding-title {
                       font-size: 24px;
                       color: #2C5530;
                       margin-bottom: 20px;
                       display: flex;
                       align-items: center;
                       gap: 15px;
                   }
                   
                   .understanding-content {
                       font-size: 18px;
                       line-height: 1.8;
                       color: #333;
                   }
                   
                   .highlight {
                       background: linear-gradient(to bottom, transparent 60%, rgba(212, 175, 55, 0.3) 60%);
                       padding: 0 4px;
                       font-weight: 500;
                   }
                   
                   .quote-box {
                       background: #F8F7F4;
                       padding: 25px;
                       border-radius: 15px;
                       margin: 25px 0;
                       border-right: 4px solid #D4AF37;
                       font-style: italic;
                   }
                   
                   .recommendation-box {
                       background: linear-gradient(135deg, #FFF 0%, #FAFAF8 100%);
                       padding: 40px;
                       border-radius: 20px;
                       box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                       margin-bottom: 30px;
                       text-align: center;
                       border: 2px solid rgba(212, 175, 55, 0.2);
                       animation: fadeInUp 1s ease 0.6s both;
                   }
                   
                   .recommendation-label {
                       font-size: 18px;
                       color: #8B9467;
                       margin-bottom: 15px;
                       font-weight: 500;
                       text-transform: uppercase;
                       letter-spacing: 2px;
                   }
                   
                   .recommendation-title {
                       font-size: 36px;
                       color: #2C5530;
                       margin-bottom: 15px;
                       font-weight: 400;
                   }
                   
                   .recommendation-subtitle {
                       font-size: 20px;
                       color: #666;
                       font-weight: 300;
                   }
                   
                   .journey-details {
                       background: #F0F8F0;
                       padding: 40px;
                       border-radius: 20px;
                       margin-bottom: 30px;
                   }
                   
                   .details-grid {
                       display: grid;
                       grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                       gap: 30px;
                       margin-top: 30px;
                   }
                   
                   .detail-item {
                       text-align: center;
                   }
                   
                   .detail-icon {
                       font-size: 40px;
                       margin-bottom: 15px;
                   }
                   
                   .detail-label {
                       font-size: 14px;
                       color: #666;
                       margin-bottom: 5px;
                   }
                   
                   .detail-value {
                       font-size: 18px;
                       color: #2C5530;
                       font-weight: 500;
                   }
                   
                   .choice-section {
                       background: white;
                       padding: 40px;
                       border-radius: 20px;
                       box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                       animation: fadeInUp 1s ease 0.9s both;
                   }
                   
                   .journey-options {
                       display: grid;
                       gap: 20px;
                       margin: 30px 0;
                   }
                   
                   .journey-option {
                       background: #F8F8F8;
                       padding: 30px;
                       border-radius: 20px;
                       cursor: pointer;
                       transition: all 0.3s ease;
                       border: 3px solid transparent;
                       position: relative;
                   }
                   
                   .journey-option:hover {
                       background: #F0F0F0;
                       transform: translateX(-5px);
                   }
                   
                   .journey-option.selected {
                       background: linear-gradient(135deg, rgba(44, 85, 48, 0.05) 0%, rgba(212, 175, 55, 0.05) 100%);
                       border-color: #2C5530;
                   }
                   
                   .journey-option.recommended {
                       border-color: #D4AF37;
                   }
                   
                   .journey-option.recommended::before {
                       content: 'موصى به';
                       position: absolute;
                       top: -12px;
                       left: 20px;
                       background: #D4AF37;
                       color: white;
                       padding: 5px 15px;
                       border-radius: 20px;
                       font-size: 14px;
                       font-weight: bold;
                   }
                   
                   .option-header {
                       display: flex;
                       align-items: center;
                       gap: 15px;
                       margin-bottom: 15px;
                   }
                   
                   .option-icon {
                       font-size: 30px;
                   }
                   
                   .option-title {
                       font-size: 22px;
                       color: #2C5530;
                       font-weight: 500;
                   }
                   
                   .option-description {
                       color: #666;
                       line-height: 1.8;
                       margin-bottom: 15px;
                   }
                   
                   .justification-section {
                       margin-top: 30px;
                       padding: 30px;
                       background: #FAFAFA;
                       border-radius: 20px;
                       display: none;
                   }
                   
                   .justification-section.active {
                       display: block;
                       animation: slideDown 0.3s ease;
                   }
                   
                   @keyframes slideDown {
                       from {
                           opacity: 0;
                           transform: translateY(-20px);
                       }
                       to {
                           opacity: 1;
                           transform: translateY(0);
                       }
                   }
                   
                   .btn {
                       padding: 18px 40px;
                       border: none;
                       border-radius: 30px;
                       font-size: 18px;
                       font-weight: 500;
                       cursor: pointer;
                       transition: all 0.3s ease;
                       font-family: inherit;
                       background: #2C5530;
                       color: white;
                   }
                   
                   .btn:hover {
                       background: #1e3a21;
                       transform: translateY(-2px);
                       box-shadow: 0 10px 25px rgba(44, 85, 48, 0.3);
                   }
                   
                   .btn:disabled {
                       opacity: 0.5;
                       cursor: not-allowed;
                       transform: none;
                   }
                   
                   .helper-message {
                       text-align: center;
                       margin-top: 30px;
                       padding: 20px;
                       background: #FFF8E1;
                       border-radius: 15px;
                       color: #8B6914;
                       font-size: 16px;
                   }
                   
                   @media (max-width: 768px) {
                       .understanding-box,
                       .recommendation-box,
                       .choice-section {
                           padding: 25px;
                       }
                       
                       .results-title {
                           font-size: 28px;
                       }
                       
                       .details-grid {
                           grid-template-columns: 1fr;
                       }
                   }
               </style>
               
               <div class="results-header">
                   <div class="journey-icon">${variant.icon}</div>
                   <h1 class="results-title">رحلة اكتشاف مخصصة لك</h1>
                   <p class="results-subtitle">${variant.greeting}، و${urgencyLevel}</p>
               </div>
               
               <div class="understanding-box">
                   <h2 class="understanding-title">
                       <span>🤝</span>
                       <span>ما فهمته من قصتك</span>
                   </h2>
                   
                   <div class="understanding-content">
                       <p>
                           من خلال إجاباتك، أرى أنك تواجه <span class="highlight">${variant.challenge}</span> 
                           ${profile.timeAvailability === 'a' ? 'مع وقت محدود جداً' : 'وتريد حلاً عملياً'}. 
                           ${profile.awarenessLevel === 'low' ? 
                               'ربما لم تلاحظ الأنماط بعد، وهذا طبيعي تماماً.' : 
                               'وأرى أيضاً وعيك بوجود شيء أعمق يحتاج للفهم.'
                           }
                       </p>
                       
                       ${keyPhrase ? `
                       <div class="quote-box">
                           <p>"${keyPhrase}..."</p>
                           <p style="margin-top: 15px; font-style: normal;">
                               هذه الكلمات تحمل الكثير من المشاعر. أشعر بـ${variant.challenge} الذي تمر به.
                           </p>
                       </div>
                       ` : ''}
                       
                       <p>
                           ${profile.supportSystem === 'weak' ? 
                               'لاحظت أيضاً أنك تواجه هذا التحدي بموارد دعم محدودة، وهذا يجعل الأمر أصعب.' :
                               'الجيد أن لديك بعض موارد الدعم في حياتك، وهذا سيساعدك في رحلتك.'
                           }
                           
                           ${profile.previousExperience === 'none' ?
                               ' وأرى أن هذه قد تكون أول تجربة لك في طلب الدعم المتخصص، وهذا يتطلب شجاعة.' :
                               ' وأقدّر خبراتك السابقة التي ستثري رحلتنا معاً.'
                           }
                       </p>
                   </div>
               </div>
               
               <div class="recommendation-box">
                   <p class="recommendation-label">بناءً على تحليل عميق لاحتياجاتك</p>
                   <h2 class="recommendation-title">ترشيحنا لك: رحلة الإشراقة</h2>
                   <p class="recommendation-subtitle">من ضيق المحنة إلى انشراح الحل</p>
               </div>
               
               <div class="journey-details">
                   <h3 class="understanding-title">
                       <span>✨</span>
                       <span>ما ستحصل عليه في رحلة الإشراقة</span>
                   </h3>
                   
                   <div class="details-grid">
                       <div class="detail-item">
                           <div class="detail-icon">🎯</div>
                           <div class="detail-label">التركيز</div>
                           <div class="detail-value">${variant.focus}</div>
                       </div>
                       
                       <div class="detail-item">
                           <div class="detail-icon">🛠️</div>
                           <div class="detail-label">الأدوات</div>
                           <div class="detail-value">${variant.tools}</div>
                       </div>
                       
                       <div class="detail-item">
                           <div class="detail-icon">📅</div>
                           <div class="detail-label">المدة</div>
                           <div class="detail-value">3-4 جلسات</div>
                       </div>
                       
                       <div class="detail-item">
                           <div class="detail-icon">🎁</div>
                           <div class="detail-label">النتيجة</div>
                           <div class="detail-value">${variant.outcome}</div>
                       </div>
                   </div>
               </div>
               
               <div class="choice-section">
                   <div style="text-align: center; margin-bottom: 30px;">
                       <h2 style="font-size: 28px; color: #2C5530; margin-bottom: 15px;">اختر المسار الذي يناسبك</h2>
                       <p style="font-size: 18px; color: #666;">يمكنك اختيار الرحلة التي تشعر أنها الأنسب لك الآن</p>
                   </div>
                   
                   <div class="journey-options">
                       <div class="journey-option recommended" onclick="selectJourney('eshraq', this)">
                           <div class="option-header">
                               <span class="option-icon">🌅</span>
                               <h3 class="option-title">رحلة الإشراقة</h3>
                           </div>
                           <p class="option-description">
                               الخيار الأمثل لحالتك. ${variant.outcome} في 3-4 جلسات مركزة. 
                               مناسبة لوقتك ${profile.timeAvailability === 'a' ? 'المحدود جداً' : 'المتاح'} 
                               ومصممة خصيصاً لـ${variant.challenge}.
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('baseera', this)">
                           <div class="option-header">
                               <span class="option-icon">👁️</span>
                               <h3 class="option-title">رحلة البصيرة</h3>
                           </div>
                           <p class="option-description">
                               إذا كنت تريد الغوص أعمق لفهم الأنماط. 8-12 جلسة لاستكشاف جذور التحديات.
                               ${profile.awarenessLevel === 'low' ? 
                                   'قد تكون خطوة كبيرة لكنها تستحق التفكير.' : 
                                   'خاصة وأنك بدأت تلاحظ بعض الأنماط.'
                               }
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('sakeena', this)">
                           <div class="option-header">
                               <span class="option-icon">🌟</span>
                               <h3 class="option-title">رحلة السكينة</h3>
                           </div>
                           <p class="option-description">
                               للتحول الجذري الشامل. 6-12 شهر من العمل العميق.
                               ${profile.timeAvailability === 'a' ? 
                                   'تتطلب التزاماً كبيراً قد لا يناسب وقتك الحالي.' : 
                                   'للباحثين عن تغيير جذري في الحياة.'
                               }
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('other', this)">
                           <div class="option-header">
                               <span class="option-icon">💭</span>
                               <h3 class="option-title">لست متأكداً</h3>
                           </div>
                           <p class="option-description">
                               إذا كنت تشعر أن احتياجاتك مختلفة، شاركنا تصورك.
                           </p>
                       </div>
                   </div>
                   
                   <div class="justification-section" id="justificationSection">
                       <label style="font-size: 18px; color: #2C5530; margin-bottom: 15px; display: block; font-weight: 500;" id="justificationLabel">
                           شاركنا: لماذا تشعر أن هذه الرحلة هي الأنسب لك؟
                       </label>
                       <textarea 
                           style="width: 100%; padding: 20px; border: 2px solid #E5E5E5; border-radius: 15px; font-size: 16px; resize: vertical; min-height: 120px; font-family: inherit;"
                           id="justificationInput"
                           placeholder="أخبرنا بما يدور في ذهنك..."
                       ></textarea>
                   </div>
                   
                   <div style="text-align: center; margin-top: 40px;">
                       <button class="btn" id="confirmButton" onclick="confirmChoice()" disabled>
                           تأكيد اختياري
                       </button>
                   </div>
                   
                   <div class="helper-message">
                       💡 لا تقلق، يمكنك دائماً تغيير مسارك لاحقاً. الأهم هو أن تبدأ من حيث أنت الآن.
                   </div>
               </div>
           `;
       }
       
       // Generate Baseera recommendation with variations
       function generateBaseeraRecommendation(results) {
           const profile = results.profile;
           const awarenessLevel = profile.awarenessLevel;
           const patterns = answers['q4-checks'] || [];
           
           // Variations based on awareness and patterns
           const awarenessMessages = {
               high: 'وعيك العميق بالأنماط يضعك في موقع قوة للتحول',
               medium: 'بداية وعيك بالأنماط علامة مشرقة على استعدادك',
               low: 'حتى وإن لم تكن الأنماط واضحة بعد، شعورك بالحاجة للفهم كافٍ'
           };
           
           const patternFocus = {
               people: 'أنماط العلاقات وديناميكيات التفاعل',
               mistakes: 'دورات التكرار وكيفية كسرها',
               situations: 'المواقف المتكررة ورسائلها الخفية',
               reactions: 'استجاباتك التلقائية وإعادة برمجتها'
           };
           
           let mainFocus = 'الأنماط العامة في حياتك';
           if (patterns.length > 0) {
               mainFocus = patternFocus[patterns[0]] || mainFocus;
           }
           
           const deepQuestions = {
               '1': 'لماذا أتصرف بالطريقة التي أتصرف بها؟',
               '2': 'من أنا حقاً خلف كل الأقنعة؟',
               '3': 'ما هو دوري الحقيقي في الحياة؟',
               '4': 'كيف أحقق إمكانياتي الكامنة؟'
           };
           
           const keyQuestion = deepQuestions[subAnswers['q1-sub-c']] || 'من أنا حقاً؟';
           const keyPhrase = profile.keyPhrases[1] || profile.keyPhrases[0] || '';
           
           return `
               <style>
                   ${getCommonStyles()}
                   
                   .pattern-cards {
                       display: grid;
                       grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                       gap: 20px;
                       margin: 30px 0;
                   }
                   
                   .pattern-card {
                       background: white;
                       padding: 25px;
                       border-radius: 15px;
                       box-shadow: 0 5px 15px rgba(0,0,0,0.05);
                       text-align: center;
                       transition: all 0.3s ease;
                   }
                   
                   .pattern-card:hover {
                       transform: translateY(-5px);
                       box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                   }
                   
                   .pattern-icon {
                       font-size: 40px;
                       margin-bottom: 15px;
                   }
                   
                   .pattern-title {
                       font-size: 18px;
                       color: #2C5530;
                       margin-bottom: 10px;
                       font-weight: 500;
                   }
                   
                   .pattern-description {
                       font-size: 14px;
                       color: #666;
                       line-height: 1.6;
                   }
                   
                   .journey-phases {
                       margin-top: 40px;
                   }
                   
                   .phase {
                       background: white;
                       padding: 35px;
                       border-radius: 20px;
                       margin-bottom: 25px;
                       box-shadow: 0 5px 20px rgba(0,0,0,0.05);
                       position: relative;
                       padding-right: 80px;
                       transition: all 0.3s ease;
                   }
                   
                   .phase:hover {
                       box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                   }
                   
                   .phase-number {
                       position: absolute;
                       right: 25px;
                       top: 35px;
                       width: 50px;
                       height: 50px;
                       background: linear-gradient(135deg, #8B9467 0%, #2C5530 100%);
                       color: white;
                       border-radius: 50%;
                       display: flex;
                       align-items: center;
                       justify-content: center;
                       font-size: 24px;
                       font-weight: bold;
                   }
                   
                   .phase-title {
                       font-size: 22px;
                       color: #2C5530;
                       margin-bottom: 15px;
                       font-weight: 500;
                   }
                   
                   .phase-content {
                       color: #555;
                       line-height: 1.8;
                   }
               </style>
               
               <div class="results-header">
                   <div class="journey-icon">👁️</div>
                   <h1 class="results-title">رحلة البصيرة العميقة</h1>
                   <p class="results-subtitle">من العمى عن الذات إلى الرؤية الواضحة</p>
               </div>
               
               <div class="understanding-box">
                   <h2 class="understanding-title">
                       <span>🔍</span>
                       <span>عمق ما اكتشفته في إجاباتك</span>
                   </h2>
                   
                   <div class="understanding-content">
                       <p>
                           إجاباتك تكشف عن <span class="highlight">بحث حقيقي عن الفهم</span>. 
                           ${awarenessMessages[awarenessLevel]}. 
                           السؤال الذي يشغل بالك: <span class="highlight">"${keyQuestion}"</span> 
                           يدل على نضج في التفكير وشجاعة في المواجهة.
                       </p>
                       
                       ${patterns.length > 0 ? `
                       <div class="quote-box">
                           <p>لاحظت أنك واعٍ بأنماط محددة:</p>
                           <ul style="margin-top: 10px; padding-right: 20px;">
                               ${patterns.map(p => `<li>${
                                   p === 'people' ? 'نفس نوع الأشخاص يسبب لك المشاكل' :
                                   p === 'mistakes' ? 'تكرار نفس الأخطاء' :
                                   p === 'situations' ? 'الوقوع في نفس المواقف' :
                                   'ردود أفعالك المتشابهة'
                               }</li>`).join('')}
                           </ul>
                           <p style="margin-top: 15px; font-style: normal;">
                               هذا الوعي نادر وثمين. معظم الناس يعيشون في دوائر مغلقة دون أن يدركوا.
                           </p>
                       </div>
                       ` : `
                       <div class="quote-box">
                           <p>حتى وإن لم تكن الأنماط واضحة تماماً بعد، مجرد شعورك بأن "شيئاً ما ليس صحيحاً" 
                           هو بداية الوعي. كثيرون يعيشون حياتهم دون أن يتوقفوا ليسألوا.</p>
                       </div>
                       `}
                       
                       ${keyPhrase ? `
                       <p style="margin-top: 20px;">
                           عندما كتبت: <span class="highlight">"${keyPhrase}..."</span> 
                           لمست فيها ${profile.emotionalState === 'urgent' ? 'إلحاحاً' : 'رغبة'} 
                           عميقة في التحرر من القيود غير المرئية.
                       </p>
                       ` : ''}
                   </div>
               </div>
               
               <div class="recommendation-box">
                   <p class="recommendation-label">مسار مصمم لعمق بحثك</p>
                   <h2 class="recommendation-title">ترشيحنا لك: رحلة البصيرة</h2>
                   <p class="recommendation-subtitle">8-12 جلسة لفهم عميق وتحرر حقيقي</p>
               </div>
               
               <div class="journey-details">
                   <h3 class="understanding-title">
                       <span>🔮</span>
                       <span>الأنماط التي سنستكشفها معاً</span>
                   </h3>
                   
                   <div class="pattern-cards">
                       <div class="pattern-card">
                           <div class="pattern-icon">🔄</div>
                           <h4 class="pattern-title">نمط التكرار</h4>
                           <p class="pattern-description">
                               ${patterns.includes('mistakes') || patterns.includes('situations') ?
                                   'سنفهم لماذا تتكرر نفس التحديات وكيف نكسر الدائرة' :
                                   'سنكشف الدوائر الخفية في حياتك وطرق الخروج منها'
                               }
                           </p>
                       </div>
                       
                       <div class="pattern-card">
                           <div class="pattern-icon">🎭</div>
                           <h4 class="pattern-title">نمط الأقنعة</h4>
                           <p class="pattern-description">
                               ${keyQuestion.includes('أقنعة') ?
                                   'سنكشف الأقنعة التي ترتديها ونلتقي بذاتك الحقيقية' :
                                   'سنفهم الأدوار التي تلعبها ولماذا'
                               }
                           </p>
                       </div>
                       
                       <div class="pattern-card">
                           <div class="pattern-icon">💡</div>
                           <h4 class="pattern-title">نمط الوعي</h4>
                           <p class="pattern-description">
                               سنطور قدرتك على رؤية نفسك بوضوح، 
                               ${awarenessLevel === 'high' ? 
                                   'وتعميق الوعي الذي بدأت تطوره' : 
                                   'وبناء وعي جديد بذاتك'
                               }
                           </p>
                       </div>
                       
                       <div class="pattern-card">
                           <div class="pattern-icon">🗝️</div>
                           <h4 class="pattern-title">نمط التحرر</h4>
                           <p class="pattern-description">
                               سنجد المفاتيح لفك القيود، خاصة في ${mainFocus}
                           </p>
                       </div>
                   </div>
               </div>
               
               <div class="journey-phases">
                   <h3 class="understanding-title">
                       <span>🛤️</span>
                       <span>مراحل رحلة البصيرة</span>
                   </h3>
                   
                   <div class="phase">
                       <div class="phase-number">1</div>
                       <h4 class="phase-title">مرحلة الكشف (4 جلسات)</h4>
                       <div class="phase-content">
                           <p>
                               نبدأ بـ${keyQuestion.includes('لماذا') ? 'فهم الـ"لماذا" وراء تصرفاتك' : 'استكشاف هويتك الحقيقية'}.
                               ${profile.previousExperience !== 'none' ? 
                                   'سنبني على خبراتك السابقة ونعمق الفهم.' : 
                                   'سنستخدم أدوات مجربة لكشف ما هو مخفي.'
                               }
                           </p>
                       </div>
                   </div>
                   
                   <div class="phase">
                       <div class="phase-number">2</div>
                       <h4 class="phase-title">مرحلة الفهم (4 جلسات)</h4>
                       <div class="phase-content">
                           <p>
                               ${patterns.length > 0 ? 
                                   `نغوص عميقاً في الأنماط التي لاحظتها، خاصة ${mainFocus}.` :
                                   'نكتشف الأنماط الخفية التي تحرك حياتك دون أن تدري.'
                               }
                               نفهم كيف تشكلت هذه الأنماط وما الغرض الذي تخدمه.
                           </p>
                       </div>
                   </div>
                   
                   <div class="phase">
                       <div class="phase-number">3</div>
                       <h4 class="phase-title">مرحلة التحرر (2-4 جلسات)</h4>
                       <div class="phase-content">
                           <p>
                               نطبق ما تعلمناه لخلق تغيير حقيقي. 
                               ${profile.supportSystem === 'strong' ? 
                                   'مع نظام الدعم القوي لديك، ستكون قادراً على تطبيق التغييرات بفعالية.' :
                                   'سنبني معاً نظام دعم يساعدك على الاستمرار.'
                               }
                           </p>
                       </div>
                   </div>
               </div>
               
               <div class="choice-section">
                   <div style="text-align: center; margin-bottom: 30px;">
                       <h2 style="font-size: 28px; color: #2C5530; margin-bottom: 15px;">اختر المسار الذي يناديك</h2>
                       <p style="font-size: 18px; color: #666;">كل رحلة لها جمالها... اختر ما يرن في قلبك</p>
                   </div>
                   
                   <div class="journey-options">
                       <div class="journey-option recommended" onclick="selectJourney('baseera', this)">
                           <div class="option-header">
                               <span class="option-icon">👁️</span>
                               <h3 class="option-title">رحلة البصيرة</h3>
                           </div>
                           <p class="option-description">
                               بناءً على ${keyQuestion ? `سؤالك "${keyQuestion}"` : 'رغبتك في الفهم العميق'} 
                               ${patterns.length > 0 ? 'ووعيك بالأنماط المتكررة' : 'وشعورك بأن هناك ما يحتاج للكشف'}, 
                               هذه الرحلة ستمنحك الإجابات التي تبحث عنها.
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('eshraq', this)">
                           <div class="option-header">
<span class="option-icon">🌅</span>
                               <h3 class="option-title">رحلة الإشراقة</h3>
                           </div>
                           <p class="option-description">
                               إذا كنت تفضل البدء بشيء أخف وأسرع. 3 جلسات فقط.
                               ${profile.timeAvailability === 'a' ? 
                                   'قد تناسب وقتك المحدود أكثر.' : 
                                   'لكن بصراحة، مستوى وعيك يستحق الاستثمار في البصيرة.'
                               }
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('sakeena', this)">
                           <div class="option-header">
                               <span class="option-icon">🌟</span>
                               <h3 class="option-title">رحلة السكينة</h3>
                           </div>
                           <p class="option-description">
                               للتحول الجذري الشامل. 6-12 شهر من العمل العميق.
                               ${awarenessLevel === 'high' ? 
                                   'وعيك العالي قد يؤهلك لهذه الرحلة العميقة.' : 
                                   'قد تكون خطوة كبيرة، لكن البصيرة ستجهزك لها.'
                               }
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('other', this)">
                           <div class="option-header">
                               <span class="option-icon">💭</span>
                               <h3 class="option-title">أحتاج شيئاً مختلفاً</h3>
                           </div>
                           <p class="option-description">
                               ربما تحتاج مزيجاً خاصاً أو لديك تصور مختلف. شاركنا ما يدور في ذهنك.
                           </p>
                       </div>
                   </div>
                   
                   <div class="justification-section" id="justificationSection">
                       <label style="font-size: 18px; color: #2C5530; margin-bottom: 15px; display: block; font-weight: 500;" id="justificationLabel">
                           شاركنا: ما الذي جذبك في هذا الاختيار؟
                       </label>
                       <textarea 
                           style="width: 100%; padding: 20px; border: 2px solid #E5E5E5; border-radius: 15px; font-size: 16px; resize: vertical; min-height: 120px; font-family: inherit;"
                           id="justificationInput"
                           placeholder="اكتب ما يدور في قلبك..."
                       ></textarea>
                   </div>
                   
                   <div style="text-align: center; margin-top: 40px;">
                       <button class="btn" id="confirmButton" onclick="confirmChoice()" disabled>
                           تأكيد اختياري
                       </button>
                   </div>
                   
                   <div class="helper-message">
                       🌱 تذكر: البذرة التي تُزرع اليوم ستصبح شجرة الغد. الأهم هو أن تبدأ.
                   </div>
               </div>
           `;
       }
       
       // Generate Sakeena recommendation with variations
       function generateSakeenaRecommendation(results) {
           const profile = results.profile;
           const transformDriver = subAnswers['q1-sub-d'] || '';
           const commitment = profile.timeAvailability === 'd' ? 'الكامل' : 'القوي';
           
           // Variations based on transformation driver
           const driverMessages = {
               '1': {
                   title: 'صاحب الرؤية الواضحة',
                   message: 'رؤيتك الواضحة تحتاج لخطة تنفيذ عميقة ودعم مستمر',
                   focus: 'تحويل الرؤية إلى واقع ملموس'
               },
               '2': {
                   title: 'الباحث عن التغيير الجذري',
                   message: 'إدراكك لحاجتك للتغيير الجذري هو نصف الطريق',
                   focus: 'بناء حياة جديدة من الأساس'
               },
               '3': {
                   title: 'صاحب التجربة المُحوِّلة',
                   message: 'التجربة التي أيقظتك هي هدية تستحق البناء عليها',
                   focus: 'تعميق وترسيخ اليقظة'
               },
               '4': {
                   title: 'من وصل نقطة التحول',
                   message: 'وصولك لنقطة "كفى" هو بداية الولادة الجديدة',
                   focus: 'الانتقال من الألم إلى النبالة'
               },
               'default': {
                   title: 'الساعي للتحول العميق',
                   message: 'استعدادك للتحول الجذري نادر وثمين',
                   focus: 'التحول الشامل على كل المستويات'
               }
           };
           
           const driver = driverMessages[transformDriver] || driverMessages.default;
           const keyPhrases = profile.keyPhrases;
           const visionText = answers['q12-text'] || '';
           
           return `
               <style>
                   ${getCommonStyles()}
                   
                   .transformation-banner {
                       background: linear-gradient(135deg, #2C5530 0%, #8B9467 100%);
                       color: white;
                       padding: 60px 40px;
                       border-radius: 30px;
                       text-align: center;
                       margin-bottom: 40px;
                       position: relative;
                       overflow: hidden;
                   }
                   
                   .transformation-banner::before {
                       content: '';
                       position: absolute;
                       top: -50%;
                       right: -10%;
                       width: 200%;
                       height: 200%;
                       background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
                       animation: float 20s ease-in-out infinite;
                   }
                   
                   @keyframes float {
                       0%, 100% { transform: translate(0, 0) rotate(0deg); }
                       50% { transform: translate(-20px, -20px) rotate(180deg); }
                   }
                   
                   .transformation-title {
                       font-size: 42px;
                       margin-bottom: 20px;
                       position: relative;
                       z-index: 1;
                   }
                   
                   .transformation-subtitle {
                       font-size: 24px;
                       opacity: 0.9;
                       position: relative;
                       z-index: 1;
                   }
                   
                   .journey-depth {
                       background: #F8F7F4;
                       padding: 40px;
                       border-radius: 25px;
                       margin-bottom: 30px;
                   }
                   
                   .depth-levels {
                       display: grid;
                       grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                       gap: 30px;
                       margin-top: 30px;
                   }
                   
                   .depth-level {
                       background: white;
                       padding: 30px;
                       border-radius: 20px;
                       box-shadow: 0 5px 20px rgba(0,0,0,0.05);
                       border-top: 5px solid;
                       transition: all 0.3s ease;
                   }
                   
                   .depth-level:nth-child(1) { border-color: #D4AF37; }
                   .depth-level:nth-child(2) { border-color: #8B9467; }
                   .depth-level:nth-child(3) { border-color: #2C5530; }
                   
                   .depth-level:hover {
                       transform: translateY(-5px);
                       box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                   }
                   
                   .level-icon {
                       font-size: 40px;
                       margin-bottom: 15px;
                   }
                   
                   .level-title {
                       font-size: 20px;
                       color: #2C5530;
                       margin-bottom: 15px;
                       font-weight: 500;
                   }
                   
                   .level-description {
                       color: #666;
                       line-height: 1.8;
                   }
                   
                   .transformation-timeline {
                       position: relative;
                       padding: 50px 0;
                       margin: 40px 0;
                   }
                   
                   .timeline-line {
                       position: absolute;
                       right: 50%;
                       top: 0;
                       bottom: 0;
                       width: 3px;
                       background: linear-gradient(to bottom, #D4AF37 0%, #8B9467 50%, #2C5530 100%);
                   }
                   
                   .timeline-item {
                       position: relative;
                       width: 45%;
                       padding: 30px;
                       background: white;
                       border-radius: 20px;
                       box-shadow: 0 5px 20px rgba(0,0,0,0.05);
                       margin-bottom: 40px;
                   }
                   
                   .timeline-item:nth-child(odd) {
                       margin-right: auto;
                       margin-left: 55%;
                   }
                   
                   .timeline-item:nth-child(even) {
                       margin-left: auto;
                       margin-right: 55%;
                   }
                   
                   .timeline-dot {
                       position: absolute;
                       width: 20px;
                       height: 20px;
                       background: white;
                       border: 4px solid #2C5530;
                       border-radius: 50%;
                       top: 40px;
                   }
                   
                   .timeline-item:nth-child(odd) .timeline-dot {
                       right: -62px;
                   }
                   
                   .timeline-item:nth-child(even) .timeline-dot {
                       left: -62px;
                   }
                   
                   .timeline-month {
                       font-size: 14px;
                       color: #8B9467;
                       margin-bottom: 10px;
                       font-weight: 500;
                   }
                   
                   .timeline-title {
                       font-size: 20px;
                       color: #2C5530;
                       margin-bottom: 15px;
                       font-weight: 500;
                   }
                   
                   .timeline-content {
                       color: #666;
                       line-height: 1.8;
                   }
                   
                   @media (max-width: 768px) {
                       .transformation-title {
                           font-size: 32px;
                       }
                       
                       .depth-levels {
                           grid-template-columns: 1fr;
                       }
                       
                       .timeline-line {
                           right: 20px;
                       }
                       
                       .timeline-item {
                           width: calc(100% - 50px);
                           margin-right: 50px !important;
                           margin-left: 0 !important;
                       }
                       
                       .timeline-dot {
                           right: -41px !important;
                           left: auto !important;
                       }
                   }
               </style>
               
               <div class="transformation-banner">
                   <h1 class="transformation-title">${driver.title}</h1>
                   <p class="transformation-subtitle">${driver.message}</p>
               </div>
               
               <div class="understanding-box">
                   <h2 class="understanding-title">
                       <span>🌟</span>
                       <span>قوة الاستعداد التي أراها فيك</span>
                   </h2>
                   
                   <div class="understanding-content">
                       <p>
                           إجاباتك تشع بطاقة إنسان <span class="highlight">وصل لنقطة حاسمة في حياته</span>. 
                           ${transformDriver === '4' ? 
                               'قولك "كفى" ليس مجرد كلمة، بل صرخة الروح التي تريد الحرية.' :
                               transformDriver === '3' ?
                               'التجربة التي مررت بها أيقظت فيك ما كان نائماً، والآن حان وقت البناء.' :
                               'هذا الاستعداد للتحول الجذري يأتي من مكان عميق جداً.'
                           }
                       </p>
                       
                       ${visionText ? `
                       <div class="quote-box">
                           <p>رؤيتك للمستقبل واضحة:</p>
                           <p style="margin-top: 10px;">"${visionText.substring(0, 150)}..."</p>
                           <p style="margin-top: 15px; font-style: normal;">
                               هذه ليست مجرد أمنية، بل <span class="highlight">خارطة طريق</span> 
                               لما تريد أن تصبح عليه.
                           </p>
                       </div>
                       ` : ''}
                       
                       <p>
                           ما يؤكد استعدادك:
                       </p>
                       <ul style="margin: 15px 0; padding-right: 30px; line-height: 2;">
                           <li>التزامك ${commitment} بالوقت والطاقة (${answers.q7 === 'd' ? 'أكثر من 5 ساعات أسبوعياً!' : 'رغم التحديات'})</li>
                           <li>استعدادك ${answers.q5 === 'a' ? 'الكامل' : 'القوي'} لمواجهة الحقائق</li>
                           <li>ثقتك ${answers['confidence-scale'] >= 8 ? 'العالية' : 'المتنامية'} في إمكانية التغيير</li>
                           ${profile.supportSystem === 'strong' ? '<li>نظام الدعم القوي الذي بنيته حولك</li>' : ''}
                       </ul>
                   </div>
               </div>
               
               <div class="recommendation-box">
                   <p class="recommendation-label">للأرواح الشجاعة الساعية للنبالة</p>
                   <h2 class="recommendation-title">ترشيحنا لك: رحلة السكينة</h2>
                   <p class="recommendation-subtitle">6-12 شهر من التحول الجذري نحو الحياة الطيبة</p>
               </div>
               
               <div class="journey-depth">
                   <h3 class="understanding-title">
                       <span>🏔️</span>
                       <span>أعماق التحول في رحلة السكينة</span>
                   </h3>
                   
                   <div class="depth-levels">
                       <div class="depth-level">
                           <div class="level-icon">🔥</div>
                           <h4 class="level-title">مستوى التطهير</h4>
                           <p class="level-description">
                               إزالة كل ما ليس أنت. 
                               ${driver.focus === 'الانتقال من الألم إلى النبالة' ?
                                   'تحويل الألم الذي وصلت له إلى قوة دافعة للتحول.' :
                                   'تنظيف عميق من الران المتراكم عبر السنين.'
                               }
                           </p>
                       </div>
                       
                       <div class="depth-level">
                           <div class="level-icon">🌱</div>
                           <h4 class="level-title">مستوى البناء</h4>
                           <p class="level-description">
                               بناء الإنسان الجديد من الداخل. 
                               ${transformDriver === '1' ?
                                   'تحويل رؤيتك الواضحة إلى بنية حياة متكاملة.' :
                                   'وضع أسس جديدة قوية لحياتك المستقبلية.'
                               }
                           </p>
                       </div>
                       
                       <div class="depth-level">
                           <div class="level-icon">✨</div>
                           <h4 class="level-title">مستوى الإشعاع</h4>
                           <p class="level-description">
                               العيش من مركز النبالة والعطاء. 
                               ${profile.previousExperience === 'extensive' ?
                                   'كل خبراتك السابقة ستتكامل في هذا المستوى.' :
                                   'اكتشاف قدرتك على التأثير الإيجابي في العالم.'
                               }
                           </p>
                       </div>
                   </div>
               </div>
               
               <div class="transformation-timeline">
                   <div class="timeline-line"></div>
                   
                   <div class="timeline-item">
                       <div class="timeline-dot"></div>
                       <div class="timeline-month">الشهر 1-2</div>
                       <h4 class="timeline-title">مواجهة الحقيقة</h4>
                       <p class="timeline-content">
                           ${transformDriver === '4' ?
                               'نبدأ من نقطة "كفى" ونحولها لنقطة انطلاق' :
                               'نكشف الحُجُب ونواجه ما كان مخفياً'
                           }
                       </p>
                   </div>
                   
                   <div class="timeline-item">
                       <div class="timeline-dot"></div>
                       <div class="timeline-month">الشهر 3-4</div>
                       <h4 class="timeline-title">إعادة التأسيس</h4>
                       <p class="timeline-content">
                           نبني أسساً جديدة قوية. ${driver.focus}
                       </p>
                   </div>
                   
                   <div class="timeline-item">
                       <div class="timeline-dot"></div>
                       <div class="timeline-month">الشهر 5-6</div>
                       <h4 class="timeline-title">التجسيد والممارسة</h4>
                       <p class="timeline-content">
                           تحويل الفهم إلى ممارسة يومية وعادات راسخة
                       </p>
                   </div>
                   
                   <div class="timeline-item">
                       <div class="timeline-dot"></div>
                       <div class="timeline-month">ما بعد 6 شهور</div>
                       <h4 class="timeline-title">العيش من المركز</h4>
                       <p class="timeline-content">
                           ${visionText.includes('سلام') || visionText.includes('سكين') ?
                               'تحقيق السلام الداخلي الذي تطمح إليه' :
                               'العيش من مركز القوة والنبالة'
                           }
                       </p>
                   </div>
               </div>
               
               <div class="choice-section">
                   <div style="text-align: center; margin-bottom: 30px;">
                       <h2 style="font-size: 28px; color: #2C5530; margin-bottom: 15px;">تأكيد المسار</h2>
                       <p style="font-size: 18px; color: #666;">اختر ما يتناسب مع استعدادك الحالي</p>
                   </div>
                   
                   <div class="journey-options">
                       <div class="journey-option recommended" onclick="selectJourney('sakeena', this)">
                           <div class="option-header">
                               <span class="option-icon">🌟</span>
                               <h3 class="option-title">رحلة السكينة</h3>
                           </div>
                           <p class="option-description">
                               ${driver.title}، هذه رحلتك. 
                               ${transformDriver === '1' ? 'رؤيتك الواضحة تستحق خطة تنفيذ عميقة.' :
                                 transformDriver === '3' ? 'التجربة التي أيقظتك تستحق البناء عليها.' :
                                 'استعدادك للتحول الجذري واضح ونادر.'}
                               6-12 شهر من العمل العميق المُحوِّل.
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('baseera', this)">
                           <div class="option-header">
                               <span class="option-icon">👁️</span>
                               <h3 class="option-title">البدء بالبصيرة أولاً</h3>
                           </div>
                           <p class="option-description">
                               إذا كنت تفضل التدرج، يمكنك البدء برحلة البصيرة (8-12 جلسة) 
                               لفهم نفسك أولاً، ثم الانتقال للسكينة.
                               ${profile.previousExperience === 'none' ? 
                                   'قد يكون هذا مناسباً كأول تجربة عميقة لك.' : 
                                   'خيار حكيم للبناء التدريجي.'
                               }
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('eshraq', this)">
                           <div class="option-header">
                               <span class="option-icon">🌅</span>
                               <h3 class="option-title">رحلة الإشراقة</h3>
                           </div>
                           <p class="option-description">
                               للبدء بخطوات صغيرة. 3 جلسات فقط.
                               ${transformDriver === '4' ? 
                                   'لكن صراحة، من وصل نقطة "كفى" يحتاج أكثر من حلول سريعة.' : 
                                   'قد لا تلبي طموحك للتحول الجذري.'
                               }
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('other', this)">
                           <div class="option-header">
                               <span class="option-icon">💭</span>
                               <h3 class="option-title">لدي تصور آخر</h3>
                           </div>
                           <p class="option-description">
                               ربما تحتاج شيئاً مختلفاً. شاركنا تصورك.
                           </p>
                       </div>
                   </div>
                   
                   <div class="justification-section" id="justificationSection">
                       <label style="font-size: 18px; color: #2C5530; margin-bottom: 15px; display: block; font-weight: 500;" id="justificationLabel">
                           شاركنا: ما الذي يجعلك تختار هذا المسار؟
                       </label>
                       <textarea 
                           style="width: 100%; padding: 20px; border: 2px solid #E5E5E5; border-radius: 15px; font-size: 16px; resize: vertical; min-height: 120px; font-family: inherit;"
                           id="justificationInput"
                           placeholder="اكتب ما تشعر به..."
                       ></textarea>
                   </div>
                   
                   <div style="text-align: center; margin-top: 40px;">
                       <button class="btn" id="confirmButton" onclick="confirmChoice()" disabled>
                           تأكيد اختياري
                       </button>
                   </div>
                   
                   <div class="helper-message">
                       🌿 أياً كان اختيارك، المهم أن تبدأ. الطريق يتضح بالمشي، والنور يأتي مع الخطوة الأولى.
                   </div>
               </div>
           `;
       }
       
       // Generate Mixed recommendation (Eshraq-Baseera or Baseera-Sakeena)
       function generateMixedRecommendation(results) {
           const mixedType = results.mixedType;
           const profile = results.profile;
           
           if (mixedType === 'eshraq-baseera') {
               return generateEshraqBaseeraMixed(results);
           } else {
               return generateBaseeraSakeenaMixed(results);
           }
       }
       
       // Mixed Eshraq-Baseera recommendation
       function generateEshraqBaseeraMixed(results) {
           const profile = results.profile;
           const challengeType = profile.challengeType;
           const awarenessLevel = profile.awarenessLevel;
           const urgency = profile.emotionalState === 'urgent';
           
           return `
               <style>
                   ${getCommonStyles()}
                   
                   .dual-path-container {
                       background: linear-gradient(135deg, #FFF8E8 0%, #F0F8F0 100%);
                       padding: 50px 40px;
                       border-radius: 30px;
                       margin-bottom: 40px;
                       position: relative;
                       overflow: hidden;
                   }
                   
                   .dual-path-container::before {
                       content: '🌅 ↔ 👁️';
                       position: absolute;
                       top: 20px;
                       right: 50%;
                       transform: translateX(50%);
                       font-size: 40px;
                       opacity: 0.2;
                   }
                   
                   .dual-needs {
                       display: grid;
                       grid-template-columns: 1fr auto 1fr;
                       gap: 30px;
                       align-items: center;
                       margin: 40px 0;
                   }
                   
                   .need-box {
                       background: white;
                       padding: 30px;
                       border-radius: 20px;
                       box-shadow: 0 5px 20px rgba(0,0,0,0.05);
                       text-align: center;
                   }
                   
                   .need-box h4 {
                       color: #2C5530;
                       margin-bottom: 15px;
                       font-size: 20px;
                   }
                   
                   .need-box ul {
                       list-style: none;
                       padding: 0;
                       color: #666;
                       line-height: 2;
                   }
                   
                   .connector {
                       font-size: 40px;
                       color: #D4AF37;
                   }
                   
                   .path-stages {
                       display: flex;
                       align-items: center;
                       justify-content: space-between;
                       margin: 50px 0;
                       position: relative;
                   }
                   
                   .path-line {
                       position: absolute;
                       top: 50%;
                       right: 10%;
                       left: 10%;
                       height: 3px;
                       background: linear-gradient(to left, #8B9467 0%, #D4AF37 100%);
                       z-index: 0;
                   }
                   
                   .stage-box {
                       background: white;
                       padding: 30px;
                       border-radius: 20px;
                       box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                       text-align: center;
                       position: relative;
                       z-index: 1;
                       flex: 1;
                       margin: 0 10px;
                   }
                   
                   .stage-box.primary {
                       border: 3px solid #D4AF37;
                       transform: scale(1.05);
                   }
                   
                   .stage-icon {
                       font-size: 50px;
                       margin-bottom: 15px;
                   }
                   
                   .stage-title {
                       font-size: 22px;
                       color: #2C5530;
                       margin-bottom: 10px;
                   }
                   
                   .stage-duration {
                       color: #8B9467;
                       font-size: 16px;
                       margin-bottom: 15px;
                   }
                   
                   .stage-description {
                       color: #666;
                       line-height: 1.8;
                   }
                   
                   @media (max-width: 768px) {
                       .dual-needs {
                           grid-template-columns: 1fr;
                       }
                       
                       .connector {
                           transform: rotate(90deg);
                       }
                       
                       .path-stages {
                           flex-direction: column;
                           gap: 30px;
                       }
                       
                       .path-line {
                           display: none;
                       }
                       
                       .stage-box {
                           margin: 0;
                       }
                   }
               </style>
               
               <div class="results-header">
                   <div class="journey-icon">🌅👁️</div>
                   <h1 class="results-title">رحلة ذات وجهين... قلب واحد</h1>
                   <p class="results-subtitle">حالتك الفريدة تستدعي مساراً خاصاً يجمع بين الحكمة العملية والبصيرة العميقة</p>
               </div>
               
               <div class="understanding-box">
                   <h2 class="understanding-title">
                       <span>🤲</span>
                       <span>الثنائية الجميلة في قصتك</span>
                   </h2>
                   
                   <div class="understanding-content">
                       <p>
                           أمامي حالة مثيرة للاهتمام. من جهة، لديك 
                           <span class="highlight">${challengeType === 'work' ? 'تحدٍ ملح في العمل' : 
                                                    challengeType === 'relationships' ? 'تحدٍ في العلاقات' :
                                                    challengeType === 'decision' ? 'قرار مهم يحتاج اتخاذه' :
                                                    'تحدٍ يحتاج حلاً عاجلاً'}</span> 
                           ${urgency ? 'يضغط عليك بقوة' : 'يحتاج انتباهاً'}. 
                           ${profile.timeAvailability === 'a' ? 'ووقتك محدود جداً - ساعة واحدة أسبوعياً فقط.' : ''}
                       </p>
                       
                       <p>
                           ومن جهة أخرى، أرى في إجاباتك 
                           <span class="highlight-green">وعياً ${awarenessLevel === 'high' ? 'عميقاً' : 'ناشئاً'} بوجود أنماط أعمق</span>. 
                           ${answers.q4 === 'b' || answers.q4 === 'd' ? 
                               'عندما قلت أنك تلاحظ تشابهاً في التحديات، هذا يخبرني أن جزءاً منك يعرف أن الحل الحقيقي أعمق.' :
                               'حتى وإن لم تكن الأنماط واضحة تماماً، شعورك يخبرك أن هناك ما هو أعمق.'
                           }
                       </p>
                   </div>
               </div>
               
               <div class="dual-path-container">
                   <h3 class="understanding-title" style="text-align: center; margin-bottom: 40px;">
                       <span>⚖️</span>
                       <span>أنت تقف عند مفترق طرق مثير</span>
                   </h3>
                   
                   <div class="dual-needs">
                       <div class="need-box">
                           <h4>الحاجة العاجلة</h4>
                           <ul>
                               <li>${challengeType === 'work' ? 'ضغط العمل الحالي' :
                                     challengeType === 'relationships' ? 'توتر العلاقات' :
                                     challengeType === 'decision' ? 'ضغط اتخاذ القرار' :
                                     'التحدي الملح'}</li>
                               <li>${urgency ? 'الحاجة لحل سريع' : 'الرغبة في حل عملي'}</li>
                               <li>${profile.timeAvailability === 'a' ? 'الوقت المحدود جداً' : 'الحاجة للكفاءة'}</li>
                           </ul>
                       </div>
                       
                       <div class="connector">⟷</div>
                       
                       <div class="need-box">
                           <h4>الحكمة الناشئة</h4>
                           <ul>
                               <li>إدراك الأنماط المتكررة</li>
                               <li>الرغبة في الفهم العميق</li>
                               <li>البحث عن تغيير حقيقي</li>
                           </ul>
                       </div>
                   </div>
                   
                   <p style="text-align: center; font-size: 20px; color: #2C5530; margin-top: 30px;">
                       وهنا يكمن الجمال: <span class="highlight">لست مضطراً للاختيار بين الاثنين!</span>
                   </p>
               </div>
               
               <div class="recommendation-box">
                   <p class="recommendation-label">مسار مصمم خصيصاً لحالتك الفريدة</p>
                   <h2 class="recommendation-title">ترشيحنا: المسار المتدرج</h2>
                   <p class="recommendation-subtitle">من إشراقة الحل السريع إلى بصيرة الفهم العميق</p>
               </div>
               
               <div class="journey-details">
                   <h3 class="understanding-title">
                       <span>🛤️</span>
                       <span>رحلتك المتدرجة - خطوة بخطوة</span>
                   </h3>
                   
                   <div class="path-stages">
                       <div class="path-line"></div>
                       
                       <div class="stage-box primary">
                           <div class="stage-icon">🌅</div>
                           <h4 class="stage-title">المحطة الأولى</h4>
                           <p class="stage-duration">3-4 أسابيع</p>
                           <p class="stage-description">
                               نطفئ النار المشتعلة في ${challengeType === 'work' ? 'العمل' : 
                                                         challengeType === 'relationships' ? 'العلاقات' :
                                                         'حياتك'}. 
                               حلول عملية فورية مع بذور الوعي.
                           </p>
                       </div>
                       
                       <div class="stage-box">
                           <div class="stage-icon">🌉</div>
                           <h4 class="stage-title">محطة التقييم</h4>
                           <p class="stage-duration">أسبوع</p>
                           <p class="stage-description">
                               نقف معاً لنرى: هل تحسن الوضع؟ 
                               هل أنت مستعد للعمق؟ 
                               القرار بيدك.
                           </p>
                       </div>
                       
                       <div class="stage-box">
                           <div class="stage-icon">👁️</div>
                           <h4 class="stage-title">المحطة الثانية</h4>
                           <p class="stage-duration">2-3 أشهر</p>
                           <p class="stage-description">
                               ${awarenessLevel === 'high' ? 
                                   'نعمق الوعي الذي بدأت تطوره' : 
                                   'نكتشف الأنماط ونفهم الجذور'}
                           </p>
                       </div>
                   </div>
               </div>
               
               <div style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px;">
                   <h3 class="understanding-title">
                       <span>💎</span>
                       <span>لماذا هذا المسار مثالي لك؟</span>
                   </h3>
                   
                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-top: 30px;">
                       <div style="text-align: center;">
                           <div style="font-size: 40px; margin-bottom: 15px;">⚖️</div>
                           <h4 style="color: #2C5530; margin-bottom: 10px;">يحترم الواقعين</h4>
                           <p style="color: #666; font-size: 14px;">
                               يتعامل مع ${urgency ? 'ضغطك الحالي بجدية' : 'تحديك العملي'}، 
                               وفي نفس الوقت يحترم رغبتك في الفهم العميق
                           </p>
                       </div>
                       
                       <div style="text-align: center;">
                           <div style="font-size: 40px; margin-bottom: 15px;">🎓</div>
                           <h4 style="color: #2C5530; margin-bottom: 10px;">تعلُّم تدريجي</h4>
                           <p style="color: #666; font-size: 14px;">
                               تختبر قوة الوعي أولاً في حل ${challengeType === 'work' ? 'مشكلة العمل' : 'تحديك'} الحقيقية، 
                               مما يحفزك للمرحلة الأعمق
                           </p>
                       </div>
                       
                       <div style="text-align: center;">
                           <div style="font-size: 40px; margin-bottom: 15px;">⏰</div>
                           <h4 style="color: #2C5530; margin-bottom: 10px;">مرن مع وقتك</h4>
                           <p style="color: #666; font-size: 14px;">
                               نبدأ بالتزام قصير ${profile.timeAvailability === 'a' ? '(يناسب ساعتك الأسبوعية)' : '(3-4 جلسات)'}, 
                               ثم تقرر أنت إن كنت مستعداً للمزيد
                           </p>
                       </div>
                       
                       <div style="text-align: center;">
                           <div style="font-size: 40px; margin-bottom: 15px;">🔗</div>
                           <h4 style="color: #2C5530; margin-bottom: 10px;">تكامل طبيعي</h4>
                           <p style="color: #666; font-size: 14px;">
                               ما تتعلمه في المرحلة الأولى يصبح أساساً للمرحلة الثانية - 
                               لا شيء يضيع
                           </p>
                       </div>
                   </div>
               </div>
               
               <div class="choice-section">
                   <div style="text-align: center; margin-bottom: 30px;">
                       <h2 style="font-size: 28px; color: #2C5530; margin-bottom: 15px;">حان وقت الاختيار</h2>
                       <p style="font-size: 18px; color: #666;">أي مسار يكلم قلبك؟</p>
                   </div>
                   
                   <div class="journey-options">
                       <div class="journey-option recommended" onclick="selectJourney('mixed-eshraq-baseera', this)">
                           <div class="option-header">
                               <span class="option-icon">🌅👁️</span>
                               <h3 class="option-title">المسار المتدرج (إشراقة ← بصيرة)</h3>
                           </div>
                           <p class="option-description">
                               المسار الذي صممناه خصيصاً لك. يبدأ بحل ${challengeType === 'work' ? 'تحدي العمل' : 
                                                                           challengeType === 'relationships' ? 'تحدي العلاقات' :
                                                                           'تحديك العاجل'} في 3-4 جلسات، 
                               ثم ينتقل بسلاسة لاستكشاف الأنماط العميقة. 
                               ${profile.timeAvailability === 'a' ? 'يحترم وقتك المحدود جداً' : 'يبني الثقة تدريجياً'}.
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('eshraq', this)">
                           <div class="option-header">
                               <span class="option-icon">🌅</span>
                               <h3 class="option-title">رحلة الإشراقة فقط</h3>
                           </div>
                           <p class="option-description">
                               إذا كنت تريد التركيز فقط على الحل العاجل دون الالتزام بالمرحلة الثانية. 
                               3 جلسات مركزة لحل التحدي الحالي.
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('baseera', this)">
                           <div class="option-header">
                               <span class="option-icon">👁️</span>
                               <h3 class="option-title">رحلة البصيرة مباشرة</h3>
                           </div>
                           <p class="option-description">
                               إذا كنت تشعر أنك تستطيع إدارة التحدي الحالي بنفسك وتريد القفز مباشرة للعمق. 
                               8-12 جلسة لفهم الأنماط والتحرر منها.
                           </p>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('other', this)">
                           <div class="option-header">
                               <span class="option-icon">💭</span>
                               <h3 class="option-title">لدي تصور آخر</h3>
                           </div>
                           <p class="option-description">
                               ربما ترى احتياجاتك بشكل مختلف. شاركنا تصورك.
                           </p>
                       </div>
                   </div>
                   
                   <div class="justification-section" id="justificationSection">
                       <label style="font-size: 18px; color: #2C5530; margin-bottom: 15px; display: block; font-weight: 500;" id="justificationLabel">
                           شاركنا: ما الذي يجعلك تميل لهذا الاختيار؟
                       </label>
                       <textarea 
                           style="width: 100%; padding: 20px; border: 2px solid #E5E5E5; border-radius: 15px; font-size: 16px; resize: vertical; min-height: 120px; font-family: inherit;"
                           id="justificationInput"
                           placeholder="اكتب ما تشعر به..."
                       ></textarea>
                   </div>
                   
                   <div style="text-align: center; margin-top: 40px;">
                       <button class="btn" id="confirmButton" onclick="confirmChoice()" disabled>
                           تأكيد اختياري
                       </button>
                   </div>
                   
                   <div class="helper-message">
                       🌿 أياً كان اختيارك، المهم أن تبدأ. الطريق يتضح بالمشي، والنور يأتي مع الخطوة الأولى.
                   </div>
               </div>
           `;
       }
       
       // Mixed Baseera-Sakeena recommendation
       function generateBaseeraSakeenaMixed(results) {
           const profile = results.profile;
           const awarenessLevel = profile.awarenessLevel;
           const deepQuestions = subAnswers['q1-sub-c'] || '';
           const transformDriver = subAnswers['q1-sub-d'] || '';
           
           return `
               <style>
                   ${getCommonStyles()}
                   
                   .spectrum-container {
                       background: linear-gradient(135deg, #F0F8FF 0%, #F0FFF0 100%);
                       padding: 50px 40px;
                       border-radius: 30px;
                       margin-bottom: 40px;
                       text-align: center;
                   }
                   
                   .spectrum-line {
                       height: 8px;
                       background: linear-gradient(to left, #2C5530 0%, #8B9467 50%, #D4AF37 100%);
                       border-radius: 4px;
                       margin: 40px auto;
                       max-width: 600px;
                       position: relative;
                   }
                   
                   .spectrum-marker {
                       position: absolute;
                       top: -8px;
                       left: 45%;
                       width: 24px;
                       height: 24px;
                       background: white;
                       border: 4px solid #8B9467;
                       border-radius: 50%;
                       box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                   }
                   
                   .depth-comparison {
                       display: grid;
                       grid-template-columns: 1fr 1fr;
                       gap: 30px;
                       margin: 40px 0;
                   }
                   
                   .depth-option {
                       background: white;
                       padding: 40px;
                       border-radius: 25px;
                       box-shadow: 0 10px 30px rgba(0,0,0,0.05);
                       transition: all 0.3s ease;
                       cursor: pointer;
                       position: relative;
                   }
                   
                   .depth-option:hover {
                       transform: translateY(-5px);
                       box-shadow: 0 15px 40px rgba(0,0,0,0.1);
                   }
                   
                   .depth-option.baseera {
                       border-top: 5px solid #8B9467;
                   }
                   
                   .depth-option.sakeena {
                       border-top: 5px solid #2C5530;
                   }
                   
                   .depth-icon {
                       font-size: 60px;
                       margin-bottom: 20px;
                   }
                   
                   .depth-title {
                       font-size: 24px;
                       color: #2C5530;
                       margin-bottom: 15px;
                   }
                   
                   .depth-description {
                       color: #666;
                       line-height: 1.8;
                       margin-bottom: 20px;
                   }
                   
                   .depth-features {
                       text-align: right;
                       border-top: 1px solid #EEE;
                       padding-top: 20px;
                   }
                   
                   .depth-features li {
                       margin-bottom: 10px;
                       padding-right: 25px;
                       position: relative;
                       list-style: none;
                   }
                   
                   .depth-features li::before {
                       content: '✓';
                       position: absolute;
                       right: 0;
                       color: #8B9467;
                       font-weight: bold;
                   }
                   
                   @media (max-width: 768px) {
                       .depth-comparison {
                           grid-template-columns: 1fr;
                       }
                   }
               </style>
               
               <div class="results-header">
                   <div class="journey-icon">👁️🌟</div>
                   <h1 class="results-title">على أعتاب التحول العميق</h1>
                   <p class="results-subtitle">استعدادك يضعك بين البصيرة والسكينة</p>
               </div>
               
               <div class="understanding-box">
                   <h2 class="understanding-title">
                       <span>🎭</span>
                       <span>العمق النادر في بحثك</span>
                   </h2>
                   
                   <div class="understanding-content">
                       <p>
                           إجاباتك تضعك في موقع فريد. من ناحية، لديك 
                           <span class="highlight">أسئلة عميقة تبحث عن إجابات</span>
                           ${deepQuestions === '1' ? ' - "لماذا أتصرف بالطريقة التي أتصرف بها؟"' :
                             deepQuestions === '2' ? ' - "من أنا حقاً خلف كل الأقنعة؟"' :
                             deepQuestions === '3' ? ' - "ما هو دوري الحقيقي في الحياة؟"' :
                             ''}. 
                           هذا يشير لـ<span class="highlight">حاجة حقيقية للفهم</span>.
                       </p>
                       
                       <p>
                           ومن ناحية أخرى، ${transformDriver ? 
                               `عندما قلت أنك ${
                                   transformDriver === '3' ? '"مررت بتجربة أيقظتك"' :
                                   transformDriver === '4' ? '"وصلت لمرحلة كفى"' :
                                   '"تريد تحولاً جذرياً"'
                               }، ` : 
                               'إجاباتك الأخرى تشير إلى أنك '
                           }
                           <span class="highlight-green">قد تكون مستعداً لما هو أعمق من مجرد الفهم</span> - 
                           ربما للتحول الكامل.
                       </p>
                   </div>
               </div>
               
               <div class="spectrum-container">
                   <h3 class="understanding-title" style="margin-bottom: 30px;">
                       <span>📊</span>
                       <span>أين تقف على طيف التحول؟</span>
                   </h3>
                   
                   <p style="font-size: 18px; color: #666; margin-bottom: 30px;">
                       بناءً على تحليل إجاباتك، أنت في منطقة وسطى مثيرة - 
                       ${awarenessLevel === 'high' ? 'وعيك العالي' : 'وعيك المتنامي'} 
                       مع ${answers['investment-scale'] >= 8 ? 'استعدادك القوي للاستثمار' : 'رغبتك في النمو'} 
                       يضعانك بين مسارين عميقين.
                   </p>
                   
                   <div class="spectrum-line">
                       <div class="spectrum-marker"></div>
                   </div>
                   
                   <div style="display: flex; justify-content: space-between; max-width: 600px; margin: 0 auto; color: #666;">
                       <span>الفهم</span>
                       <span style="font-weight: bold; color: #8B9467;">أنت هنا</span>
                       <span>التحول</span>
                   </div>
               </div>
               
               <div class="recommendation-box">
                   <p class="recommendation-label">خيارات للأرواح الطموحة</p>
                   <h2 class="recommendation-title">ترشيحنا: اختر عمق رحلتك</h2>
                   <p class="recommendation-subtitle">كلا المسارين يناسب مستواك - الاختيار يعتمد على استعدادك</p>
               </div>
               
               <div class="journey-details">
                   <h3 class="understanding-title" style="text-align: center; margin-bottom: 40px;">
                       <span>⚖️</span>
                       <span>مسارك العميقان - قارن واختر</span>
                   </h3>
                   
                   <div class="depth-comparison">
                       <div class="depth-option baseera">
                           <div class="depth-icon">👁️</div>
                           <h4 class="depth-title">البدء بالبصيرة</h4>
                           <p class="depth-description">
                               ${deepQuestions ? 
                                   `مثالي لاستكشاف سؤالك "${
                                       deepQuestions === '1' ? 'لماذا أتصرف بالطريقة التي أتصرف بها؟' :
                                       deepQuestions === '2' ? 'من أنا حقاً خلف كل الأقنعة؟' :
                                       deepQuestions === '3' ? 'ما هو دوري الحقيقي في الحياة؟' :
                                       'من أنا حقاً؟'
                                   }"` :
                                   'مثالي لمن يريد فهماً عميقاً قبل التحول الجذري'
                               }
                           </p>
                           <ul class="depth-features">
                               <li>8-12 جلسة على 2-3 أشهر</li>
                               <li>فهم عميق لنمطك وأنماطك</li>
                               <li>أدوات مخصصة لطبيعتك</li>
                               <li>أساس قوي للتحول المستقبلي</li>
                               <li>يمكن الانتقال للسكينة لاحقاً</li>
                           </ul>
                       </div>
                       
                       <div class="depth-option sakeena">
                           <div class="depth-icon">🌟</div>
                           <h4 class="depth-title">القفز للسكينة</h4>
                           <p class="depth-description">
                               ${transformDriver === '3' || transformDriver === '4' ?
                                   'مناسب لك خاصة وأنك ' + (transformDriver === '3' ? 'مررت بتجربة محولة' : 'وصلت نقطة "كفى"') :
                                   'للشجعان المستعدين للغوص العميق مباشرة'
                               }
                           </p>
                           <ul class="depth-features">
                               <li>6-12 شهر من العمل المكثف</li>
                               <li>تحول جذري شامل</li>
                               <li>عمل على كل مستويات الوجود</li>
                               <li>مرافقة مكثفة ودعم مستمر</li>
                               <li>يتضمن كل ما في البصيرة وأكثر</li>
                           </ul>
                       </div>
                   </div>
               </div>
               
               <div style="background: #FFF8F0; padding: 40px; border-radius: 25px; margin-bottom: 30px;">
                   <h3 class="understanding-title" style="text-align: center;">
                       <span>🤔</span>
                       <span>كيف تختار؟</span>
                   </h3>
                   
                   <div style="margin-top: 30px; font-size: 18px; line-height: 2; color: #333;">
                       <p><strong>اختر البصيرة إذا:</strong></p>
                       <ul style="margin: 15px 0 30px 0; padding-right: 30px;">
                           <li>تفضل البناء التدريجي للفهم</li>
                           <li>تريد التأكد من الأساسات أولاً</li>
                           <li>وقتك ${profile.timeAvailability === 'b' || profile.timeAvailability === 'c' ? 'يسمح بالتزام متوسط' : 'محدود نسبياً'}</li>
                           <li>تحب أن تفهم قبل أن تقفز</li>
                       </ul>
                       
                       <p><strong>اختر السكينة إذا:</strong></p>
                       <ul style="margin: 15px 0; padding-right: 30px;">
                           <li>${transformDriver === '3' ? 'التجربة التي أيقظتك تدفعك للتحول الآن' :
                                transformDriver === '4' ? 'وصولك لنقطة "كفى" يحتاج استجابة جذرية' :
                                'تشعر بجاهزية كاملة للتحول'}</li>
                           <li>لديك ${profile.timeAvailability === 'd' ? 'الوقت والطاقة الكافيين' : 'استعداد لتخصيص الوقت اللازم'}</li>
                           <li>تثق في قدرتك على التعامل مع العمق</li>
<li>ترى التحديات كفرص للنمو الروحي</li>
                       </ul>
                   </div>
               </div>
               
               <div class="choice-section">
                   <div style="text-align: center; margin-bottom: 30px;">
                       <h2 style="font-size: 28px; color: #2C5530; margin-bottom: 15px;">اختر المسار الذي يناديك</h2>
                       <p style="font-size: 18px; color: #666;">قلبك يعرف الطريق... استمع له</p>
                   </div>
                   
                   <div class="journey-options">
                       <div class="journey-option recommended" onclick="selectJourney('mixed-baseera-sakeena', this)">
                           <div class="option-header">
                               <span class="option-icon">👁️🌟</span>
                               <h3 class="option-title">المسار المتدرج (بصيرة ← سكينة)</h3>
                           </div>
                           <p class="option-description">
                               مسار حكيم يبدأ بالفهم العميق (8-12 جلسة) ثم ينتقل للتحول الجذري.
                               ${awarenessLevel === 'high' ? 
                                   'مثالي لمستوى وعيك العالي مع إعطائك وقتاً للتأسيس.' :
                                   'يمنحك الوقت لبناء الأساس قبل القفزة الكبرى.'}
                           </p>
                           <div class="option-features">
                               <span class="feature-tag">بداية: 8-12 جلسة</span>
                               <span class="feature-tag">ثم: 6 شهور+</span>
                               <span class="feature-tag">تدرج آمن</span>
                           </div>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('baseera', this)">
                           <div class="option-header">
                               <span class="option-icon">👁️</span>
                               <h3 class="option-title">رحلة البصيرة فقط</h3>
                           </div>
                           <p class="option-description">
                               ${deepQuestions ? 
                                   `للتركيز على سؤالك "${getDeepQuestionText(deepQuestions)}" والفهم العميق.` :
                                   'للفهم العميق دون الالتزام بالتحول الجذري حالياً.'}
                               يمكنك دائماً الانتقال للسكينة لاحقاً.
                           </p>
                           <div class="option-features">
                               <span class="feature-tag">8-12 جلسة</span>
                               <span class="feature-tag">3 شهور</span>
                               <span class="feature-tag">فهم عميق</span>
                           </div>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('sakeena', this)">
                           <div class="option-header">
                               <span class="option-icon">🌟</span>
                               <h3 class="option-title">رحلة السكينة مباشرة</h3>
                           </div>
                           <p class="option-description">
                               ${transformDriver === '3' || transformDriver === '4' ?
                                   'قفزة جريئة تناسب من ' + (transformDriver === '3' ? 'مر بتجربة محولة.' : 'وصل نقطة "كفى".') :
                                   'للشجعان المستعدين للغوص العميق مباشرة.'}
                           </p>
                           <div class="option-features">
                               <span class="feature-tag">6-12 شهر</span>
                               <span class="feature-tag">تحول جذري</span>
                               <span class="feature-tag">التزام كامل</span>
                           </div>
                       </div>
                       
                       <div class="journey-option" onclick="selectJourney('other', this)">
                           <div class="option-header">
                               <span class="option-icon">💭</span>
                               <h3 class="option-title">لدي رؤية مختلفة</h3>
                           </div>
                           <p class="option-description">
                               ربما تحتاج شيئاً آخر تماماً. شاركنا رؤيتك.
                           </p>
                       </div>
                   </div>
                   
                   <div class="justification-section" id="justificationSection">
                       <label style="font-size: 18px; color: #2C5530; margin-bottom: 15px; display: block; font-weight: 500;" id="justificationLabel">
                           شاركنا: ما الذي يجذبك في هذا الاختيار؟
                       </label>
                       <textarea 
                           style="width: 100%; padding: 20px; border: 2px solid #E5E5E5; border-radius: 15px; font-size: 16px; resize: vertical; min-height: 120px; font-family: inherit;"
                           id="justificationInput"
                           placeholder="اكتب ما يدور في قلبك..."
                       ></textarea>
                   </div>
                   
                   <div style="text-align: center; margin-top: 40px;">
                       <button class="btn" id="confirmButton" onclick="confirmChoice()" disabled>
                           تأكيد اختياري
                       </button>
                   </div>
                   
                   <div class="helper-message">
                       الطريق الأطول قد يكون الأقصر... والأعمق قد يكون الأسهل. ثق بحدسك.
                   </div>
               </div>
           `;
       }

       return {
           scores: scores,
           percentages: {
               eshraq: eshraqPercent,
               baseera: baseeraPercent,
               sakeena: sakeenaPercent
           },
           journeyType: journeyType,
           recommendedJourney: recommendedJourney,
           isMixed: isMixed,
           mixedType: mixedType,
           profile: profile,
           userName: answers.userName,
           userEmail: answers.userEmail,
           selectedJourney: answers.selectedJourney || recommendedJourney,
           justification: answers.justification || ''
       };
   }

   // Helper functions for profile creation
   function createDetailedProfile() {
       const profile = {
           challengeType: '',
           awarenessLevel: '',
           timeAvailability: '',
           supportSystem: '',
           previousExperience: '',
           specificNeeds: [],
           keyPhrases: [],
           emotionalState: ''
       };

       // Challenge type from Q1 sub-answers
       if (answers.q1 === 'a' && subAnswers['q1-sub-a']) {
           const types = {
               '1': 'work',
               '2': 'relationships', 
               '3': 'self',
               '4': 'decision'
           };
           profile.challengeType = types[subAnswers['q1-sub-a']] || 'general';
       }

       // Awareness level from Q4
       if (answers.q4 === 'c') profile.awarenessLevel = 'high';
       else if (answers.q4 === 'b' || answers.q4 === 'd') profile.awarenessLevel = 'medium';
       else profile.awarenessLevel = 'low';

       // Time availability from Q7
       profile.timeAvailability = answers.q7 || 'unknown';

       // Support system from Q8
       const supportCount = (answers['q8-checks'] || []).length;
       if (supportCount >= 4) profile.supportSystem = 'strong';
       else if (supportCount >= 2) profile.supportSystem = 'moderate';
       else profile.supportSystem = 'weak';

       // Previous experience from Q11
       const experiences = answers['q11-checks'] || [];
       if (experiences.length > 3) profile.previousExperience = 'extensive';
       else if (experiences.length > 0) profile.previousExperience = 'some';
       else profile.previousExperience = 'none';

       // Extract key phrases from text answers
       const texts = [
           answers['q3-text'] || '',
           answers['q6-text'] || '',
           answers['q9-text'] || '',
           answers['q12-text'] || ''
       ];
       texts.forEach(text => {
           if (text.length > 20) {
               const phrase = text.substring(0, 100).trim();
               if (phrase) profile.keyPhrases.push(phrase);
           }
       });

       // Emotional state based on urgency
       const urgency = parseInt(answers['urgency-scale'] || 5);
       if (urgency >= 8) profile.emotionalState = 'urgent';
       else if (urgency >= 5) profile.emotionalState = 'motivated';
       else profile.emotionalState = 'exploring';

       return profile;
   }

   // Helper function to get deep question text
   function getDeepQuestionText(questionNumber) {
       const questions = {
           '1': 'لماذا أتصرف بالطريقة التي أتصرف بها؟',
           '2': 'من أنا حقاً خلف كل الأقنعة؟',
           '3': 'ما هو دوري الحقيقي في الحياة؟',
           '4': 'كيف أحقق إمكانياتي الكامنة؟'
       };
       return questions[questionNumber] || '';
   }

   // Journey selection handler
   function selectJourney(journey, element) {
       document.querySelectorAll('.journey-option').forEach(option => {
           option.classList.remove('selected');
       });
       
       element.classList.add('selected');
       selectedJourney = journey;
       
       const justificationSection = document.getElementById('justificationSection');
       const justificationLabel = document.getElementById('justificationLabel');
       const justificationInput = document.getElementById('justificationInput');
       
       justificationSection.classList.add('active');
       justificationInput.value = '';
       
       // Customize justification question based on selection
       const questions = {
           'eshraq': 'رائع! يبدو أن رحلة الإشراقة تناسبك. ما الذي جذبك فيها تحديداً؟',
           'baseera': 'جميل! رحلة البصيرة تتحدث إلى روحك. ما الذي ترجو اكتشافه عن نفسك؟',
           'sakeena': 'طموح رائع! رحلة السكينة تحول جذري. ما الذي يجعلك تشعر أنك مستعد لهذا العمق؟',
           'mixed-eshraq-baseera': 'ممتاز! المسار المتدرج يبدو مناسباً. ما أكثر ما أعجبك في فكرة البدء بالحل العملي ثم التعمق؟',
           'mixed-baseera-sakeena': 'اختيار حكيم! البناء التدريجي نحو التحول. ما الذي يجعلك تفضل هذا التدرج؟',
           'other': 'أحب الأرواح التي تبحث عن طريقها الخاص. أخبرني، ما الذي تحتاجه بالضبط؟'
       };
       
       justificationLabel.textContent = questions[journey] || 'شاركنا: لماذا تشعر أن هذا الاختيار هو الأنسب لك؟';
       
       // Enable confirm button after writing
       justificationInput.addEventListener('input', function() {
           const confirmButton = document.getElementById('confirmButton');
           confirmButton.disabled = this.value.trim().length <= 10;
       });
   }

   // Confirm choice handler
   async function confirmChoice() {
       const justification = document.getElementById('justificationInput').value;
       answers.selectedJourney = selectedJourney;
       answers.justification = justification;
       
       // Show loading
       document.getElementById('loadingContainer').style.display = 'flex';
       
       try {
           // Create user account with password
           const userCredential = await auth.createUserWithEmailAndPassword(
               answers.userEmail,
               answers.userPassword
           );
           const userId = userCredential.user.uid;
           
           // Update display name
           await userCredential.user.updateProfile({
               displayName: answers.userName || 'عميل كريم'
           });
           
           // Get final analysis
           const analysis = analyzeAnswers();
           
           // Save user data
           await db.collection('users').doc(userId).set({
               email: answers.userEmail,
               name: answers.userName,
               phone: answers.userPhone,
               createdAt: firebase.firestore.FieldValue.serverTimestamp(),
               lastLogin: firebase.firestore.FieldValue.serverTimestamp()
           });
           
           // Save assessment data
           const assessmentRef = await db.collection('assessments').add({
               userId: userId,
               answers: answers,
               subAnswers: subAnswers,
               results: analysis,
               completedAt: firebase.firestore.FieldValue.serverTimestamp()
           });
           
           // Create booking record
           const bookingNumber = 'BK' + Date.now().toString().slice(-8);
           await db.collection('bookings').add({
               userId: userId,
               assessmentId: assessmentRef.id,
               bookingNumber: bookingNumber,
               userName: answers.userName,
               userEmail: answers.userEmail,
               userPhone: answers.userPhone,
               recommendedJourney: analysis.recommendedJourney,
               selectedJourney: selectedJourney,
               justification: justification,
               status: 'pending_review',
               createdAt: firebase.firestore.FieldValue.serverTimestamp()
           });
           
           // Store data for final message
           assessmentData = {
               bookingNumber: bookingNumber,
               analysisResults: analysis,
               userName: answers.userName,
               userEmail: answers.userEmail,
               userPhone: answers.userPhone,
               recommendedJourney: analysis.recommendedJourney,
               selectedJourney: selectedJourney,
               justification: justification
           };
           
           // Show final message
           setTimeout(() => {
               showFinalMessage();
           }, 2000);
           
       } catch (error) {
           console.error('Error:', error);
           document.getElementById('loadingContainer').style.display = 'none';
           
           if (error.code === 'auth/email-already-in-use') {
               alert('هذا البريد الإلكتروني مسجل بالفعل. يمكنك تسجيل الدخول من صفحة الدخول.');
           } else {
               alert('حدث خطأ. من فضلك حاول مرة أخرى.');
           }
       }
   }

   // Show final message
   function showFinalMessage() {
       document.getElementById('loadingContainer').style.display = 'none';
       document.getElementById('questionContainer').style.display = 'none';
       document.getElementById('resultsContainer').style.display = 'none';
       
       const journeyNames = {
           'eshraq': 'الإشراقة',
           'baseera': 'البصيرة',
           'sakeena': 'السكينة',
           'mixed-eshraq-baseera': 'المسار المتدرج (إشراقة ← بصيرة)',
           'mixed-baseera-sakeena': 'المسار المتدرج (بصيرة ← سكينة)'
       };
       
       const selectedJourneyName = journeyNames[assessmentData.selectedJourney] || assessmentData.selectedJourney;
       const recommendedJourneyName = journeyNames[assessmentData.recommendedJourney] || assessmentData.recommendedJourney;
       const matchedChoice = assessmentData.selectedJourney === assessmentData.recommendedJourney;
       
       const finalMessageHTML = `
           <style>
               .final-container {
                   max-width: 800px;
                   margin: 0 auto;
                   padding: 40px 20px;
                   text-align: center;
               }
               
               .success-animation {
                   font-size: 100px;
                   margin-bottom: 30px;
                   animation: successPulse 2s ease-in-out infinite;
               }
               
               @keyframes successPulse {
                   0%, 100% { transform: scale(1); opacity: 1; }
                   50% { transform: scale(1.1); opacity: 0.8; }
               }
               
               .final-title {
                   font-size: 36px;
                   color: #2C5530;
                   margin-bottom: 20px;
                   font-weight: 300;
               }
               
               .final-message {
                   background: white;
                   padding: 50px 40px;
                   border-radius: 30px;
                   box-shadow: 0 15px 40px rgba(0,0,0,0.1);
                   margin-bottom: 30px;
               }
               
               .booking-info {
                   background: #F8F7F4;
                   padding: 30px;
                   border-radius: 20px;
                   margin: 30px 0;
                   border-right: 5px solid #D4AF37;
               }
               
               .booking-number {
                   font-size: 28px;
                   color: #2C5530;
                   font-weight: bold;
                   margin: 10px 0;
               }
               
               .journey-selection {
                   background: linear-gradient(135deg, rgba(44, 85, 48, 0.05) 0%, rgba(212, 175, 55, 0.05) 100%);
                   padding: 25px;
                   border-radius: 15px;
                   margin: 20px 0;
               }
               
               .journey-label {
                   font-size: 16px;
                   color: #666;
                   margin-bottom: 5px;
               }
               
               .journey-name {
                   font-size: 24px;
                   color: #2C5530;
                   font-weight: 500;
               }
               
               .match-indicator {
                   display: inline-block;
                   margin-right: 10px;
                   padding: 5px 15px;
                   border-radius: 20px;
                   font-size: 14px;
                   font-weight: bold;
               }
               
               .match-indicator.matched {
                   background: #E8F5E9;
                   color: #2E7D32;
               }
               
               .match-indicator.different {
                   background: #FFF3E0;
                   color: #E65100;
               }
               
               .next-steps {
                   background: #F0F8F0;
                   padding: 30px;
                   border-radius: 20px;
                   margin: 30px 0;
                   text-align: right;
               }
               
               .step-item {
                   display: flex;
                   align-items: center;
                   margin-bottom: 15px;
                   font-size: 18px;
                   color: #555;
               }
               
               .step-number {
                   background: #2C5530;
                   color: white;
                   width: 30px;
                   height: 30px;
                   border-radius: 50%;
                   display: flex;
                   align-items: center;
                   justify-content: center;
                   margin-left: 15px;
                   font-weight: bold;
               }
               
               .whatsapp-button {
                   display: inline-block;
                   background: #25D366;
                   color: white;
                   padding: 20px 50px;
                   border-radius: 50px;
                   text-decoration: none;
                   font-size: 20px;
                   font-weight: bold;
                   margin-top: 30px;
                   transition: all 0.3s ease;
                   box-shadow: 0 5px 20px rgba(37, 211, 102, 0.3);
               }
               
               .whatsapp-button:hover {
                   background: #1EBE56;
                   transform: translateY(-3px);
                   box-shadow: 0 10px 30px rgba(37, 211, 102, 0.4);
               }
               
               .whatsapp-icon {
                   font-size: 24px;
                   margin-left: 10px;
                   vertical-align: middle;
               }
               
               .privacy-note {
                   font-size: 14px;
                   color: #999;
                   margin-top: 20px;
                   font-style: italic;
               }
           </style>
           
           <div class="final-container">
               <div class="success-animation">✨</div>
               <h1 class="final-title">تم تسجيل اختيارك بنجاح!</h1>
               
               <div class="final-message">
                   <p style="font-size: 20px; color: #666; margin-bottom: 30px;">
                       ${assessmentData.userName}، شكراً لك على الوقت والصدق في مشاركة قصتك معنا
                   </p>
                   
                   <div class="booking-info">
                       <p class="journey-label">رقم الحجز الخاص بك:</p>
                       <p class="booking-number">${assessmentData.bookingNumber}</p>
                       <p style="color: #666; margin-top: 10px;">احتفظ بهذا الرقم للمتابعة</p>
                   </div>
                   
                   <div class="journey-selection">
                       <p class="journey-label">الرحلة التي اخترتها:</p>
                       <p class="journey-name">
                           ${matchedChoice ? 
                               '<span class="match-indicator matched">✓ توافق مع ترشيحنا</span>' :
                               '<span class="match-indicator different">⚡ اختيار مختلف</span>'
                           }
                           رحلة ${selectedJourneyName}
                       </p>
                       ${!matchedChoice ? 
                           `<p style="margin-top: 15px; color: #666; font-size: 16px;">
                               (ترشيحنا كان: رحلة ${recommendedJourneyName})
                           </p>` : ''
                       }
                   </div>
                   
                   <div class="next-steps">
                       <h3 style="color: #2C5530; margin-bottom: 20px;">الخطوات التالية:</h3>
                       <div class="step-item">
                           <span class="step-number">1</span>
                           <span>سنراجع طلبك خلال أسبوع عمل</span>
                       </div>
                       <div class="step-item">
                           <span class="step-number">2</span>
                           <span>سنرسل لك رسالة تأكيد على الواتساب</span>
                       </div>
                       <div class="step-item">
                           <span class="step-number">3</span>
                           <span>ستحصل على بيانات الدخول لمساحتك الخاصة</span>
                       </div>
                       <div class="step-item">
                           <span class="step-number">4</span>
                           <span>سنحدد معاً موعد الجلسة الأولى</span>
                       </div>
                   </div>
                   
                   <p style="font-size: 18px; color: #2C5530; margin: 30px 0;">
                       للتأكيد النهائي، اضغط على الزر أدناه لإرسال رسالة واتساب
                   </p>
                   
                   <a href="#" class="whatsapp-button" onclick="sendWhatsAppMessage(); return false;">
                       <span>أكد حجزك عبر الواتساب</span>
                       <span class="whatsapp-icon">📱</span>
                   </a>
                   
                   <p class="privacy-note">
                       * جميع بياناتك محفوظة بسرية تامة ولن تُستخدم إلا لأغراض رحلتك معنا
                   </p>
               </div>
           </div>
       `;
       
       document.getElementById('resultsContainer').innerHTML = finalMessageHTML;
       document.getElementById('resultsContainer').style.display = 'block';
       
       window.scrollTo({ top: 0, behavior: 'smooth' });
   }

   // Send WhatsApp message
   function sendWhatsAppMessage() {
       const journeyNames = {
           'eshraq': 'الإشراقة',
           'baseera': 'البصيرة',
           'sakeena': 'السكينة',
           'mixed-eshraq-baseera': 'المسار المتدرج (إشراقة ← بصيرة)',
           'mixed-baseera-sakeena': 'المسار المتدرج (بصيرة ← سكينة)'
       };
       
       const selectedJourneyName = journeyNames[assessmentData.selectedJourney] || assessmentData.selectedJourney;
       const recommendedJourneyName = journeyNames[assessmentData.recommendedJourney] || assessmentData.recommendedJourney;
       
       // Admin message
       const adminMessage = `🌟 حجز جديد من التقييم الشامل

📋 البيانات الأساسية:
- رقم الحجز: ${assessmentData.bookingNumber}
- الاسم: ${assessmentData.userName}
- البريد: ${assessmentData.userEmail}
- الهاتف: ${assessmentData.userPhone}

🎯 الترشيح والاختيار:
- الرحلة الموصى بها: ${recommendedJourneyName}
- الرحلة المختارة: ${selectedJourneyName}
- التطابق: ${assessmentData.selectedJourney === assessmentData.recommendedJourney ? '✅ نعم' : '❌ لا'}

📊 نتائج التحليل:
- إشراقة: ${Math.round(assessmentData.analysisResults.percentages.eshraq)}%
- بصيرة: ${Math.round(assessmentData.analysisResults.percentages.baseera)}%
- سكينة: ${Math.round(assessmentData.analysisResults.percentages.sakeena)}%

💬 تبرير الاختيار:
"${assessmentData.justification}"

🔗 رابط الأدمن:
https://yourwebsite.com/admin.html`;

       const whatsappUrl = `https://wa.me/201224938330?text=${encodeURIComponent(adminMessage)}`;
       window.open(whatsappUrl, '_blank');
   }

   // Event listeners
   document.addEventListener('DOMContentLoaded', function() {
       // Start assessment
       document.getElementById('startBtn')?.addEventListener('click', startAssessment);
       
       // Navigation buttons
       document.querySelectorAll('.btn-secondary').forEach(btn => {
           btn.addEventListener('click', previousSection);
       });
       
       document.querySelectorAll('.btn-primary:not(#submitBtn)').forEach(btn => {
           btn.addEventListener('click', nextSection);
       });
       
       // Submit button
       document.getElementById('submitBtn')?.addEventListener('click', submitAssessment);
       
       // Option clicks
       document.querySelectorAll('.option').forEach(option => {
           option.addEventListener('click', function(e) {
               if (e.target.tagName !== 'INPUT') {
                   const input = this.querySelector('input');
                   if (input) {
                       input.click();
                   }
               }
           });
       });
       
       // Initialize scale displays
       updateScaleValue('urgency');
       updateScaleValue('investment');
       updateScaleValue('confidence');
       
       // Password visibility toggle
       document.getElementById('togglePassword')?.addEventListener('click', function() {
           const passwordInput = document.getElementById('userPassword');
           const icon = this;
           
           if (passwordInput.type === 'password') {
               passwordInput.type = 'text';
               icon.textContent = '👁️‍🗨️';
           } else {
               passwordInput.type = 'password';
               icon.textContent = '👁️';
           }
       });
   });

   </script>
</body>
</html>
